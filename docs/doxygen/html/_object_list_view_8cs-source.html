<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Crossfade: C:/Users/philwo/Documents/Visual Studio 2005/Projects/Crossfade/crossfade/crossfade/ObjectListView.cs Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.2 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Packages</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li class="current"><a href="files.html"><span>Files</span></a></li>
  </ul>
</div>
<h1>C:/Users/philwo/Documents/Visual Studio 2005/Projects/Crossfade/crossfade/crossfade/ObjectListView.cs</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ObjectListView - A listview to show various aspects of a collection of objects</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * User: Phillip Piper</span>
<a name="l00005"></a>00005 <span class="comment"> * Date: 9/10/2006 11:15 AM</span>
<a name="l00006"></a>00006 <span class="comment"> *</span>
<a name="l00007"></a>00007 <span class="comment"> * Change log:</span>
<a name="l00008"></a>00008 <span class="comment"> * 2007-04-12  JPP  - Allow owner drawn on steriods!</span>
<a name="l00009"></a>00009 <span class="comment"> *                  - Column headers now display sort indicators</span>
<a name="l00010"></a>00010 <span class="comment"> *                  - ImageGetter delegates can now return ints, strings or Images </span>
<a name="l00011"></a>00011 <span class="comment"> *                    (Images are only visible if the list is owner drawn)</span>
<a name="l00012"></a>00012 <span class="comment"> *                  - Added OLVColumn.MakeGroupies to help with group partitioning</span>
<a name="l00013"></a>00013 <span class="comment"> *                  - All normal listview views are now supported</span>
<a name="l00014"></a>00014 <span class="comment"> *                  - Allow dotted aspect names, e.g. Owner.Workgroup.Name (thanks to OlafD)</span>
<a name="l00015"></a>00015 <span class="comment"> *                  - Added SelectedObject and SelectedObjects properties</span>
<a name="l00016"></a>00016 <span class="comment"> * 2007-03-01  JPP  - Added DataListView</span>
<a name="l00017"></a>00017 <span class="comment"> *                  - Added VirtualObjectListView</span>
<a name="l00018"></a>00018 <span class="comment"> *                                      - Added Freeze/Unfreeze capabilities</span>
<a name="l00019"></a>00019 <span class="comment"> *                  - Allowed sort handler to be installed</span>
<a name="l00020"></a>00020 <span class="comment"> *                  - Simplified sort comparisons: handles 95% of cases with only 6 lines of code!</span>
<a name="l00021"></a>00021 <span class="comment"> *                  - Fixed bug with alternative line colors on unsorted lists (thanks to cmarlow)</span>
<a name="l00022"></a>00022 <span class="comment"> * 2007-01-13  JPP  - Fixed bug with lastSortOrder (thanks to Kwan Fu Sit)</span>
<a name="l00023"></a>00023 <span class="comment"> *                  - Non-OLVColumns are no longer allowed</span>
<a name="l00024"></a>00024 <span class="comment"> * 2007-01-04  JPP  - Clear sorter before rebuilding list. 10x faster! (thanks to aaberg)</span>
<a name="l00025"></a>00025 <span class="comment"> *                  - Include GetField in GetAspectByName() so field values can be Invoked too.</span>
<a name="l00026"></a>00026 <span class="comment"> *                                      - Fixed subtle bug in RefreshItem() that erased background colors.</span>
<a name="l00027"></a>00027 <span class="comment"> * 2006-11-01  JPP  - Added alternate line colouring</span>
<a name="l00028"></a>00028 <span class="comment"> * 2006-10-20  JPP  - Refactored all sorting comparisons and made it extendable. See ComparerManager.</span>
<a name="l00029"></a>00029 <span class="comment"> *                  - Improved IDE integration</span>
<a name="l00030"></a>00030 <span class="comment"> *                  - Made control DoubleBuffered</span>
<a name="l00031"></a>00031 <span class="comment"> *                  - Added object selection methods</span>
<a name="l00032"></a>00032 <span class="comment"> * 2006-10-13  JPP  Implemented grouping and column sorting</span>
<a name="l00033"></a>00033 <span class="comment"> * 2006-10-09  JPP  Initial version</span>
<a name="l00034"></a>00034 <span class="comment"> * </span>
<a name="l00035"></a>00035 <span class="comment"> * CONDITIONS OF USE</span>
<a name="l00036"></a>00036 <span class="comment"> * This code may be freely used for non-commerical purposes. Commerical use requires a one-time</span>
<a name="l00037"></a>00037 <span class="comment"> * license fee obtainable from phillip_piper@bigfoot.com. This code must be kept intact, </span>
<a name="l00038"></a>00038 <span class="comment"> * complete with this header and conditions of use.</span>
<a name="l00039"></a>00039 <span class="comment"> * </span>
<a name="l00040"></a>00040 <span class="comment"> * Copyright (C) 2006-2007 Phillip Piper</span>
<a name="l00041"></a>00041 <span class="comment"> */</span>
<a name="l00042"></a>00042 
<a name="l00043"></a>00043 <span class="keyword">using</span> System;
<a name="l00044"></a>00044 <span class="keyword">using</span> System.Collections;
<a name="l00045"></a>00045 <span class="keyword">using</span> System.Collections.Generic;
<a name="l00046"></a>00046 <span class="keyword">using</span> System.ComponentModel;
<a name="l00047"></a>00047 <span class="keyword">using</span> System.Data;
<a name="l00048"></a>00048 <span class="keyword">using</span> System.Drawing;
<a name="l00049"></a>00049 <span class="keyword">using</span> System.Drawing.Design;
<a name="l00050"></a>00050 <span class="keyword">using</span> System.Drawing.Drawing2D;
<a name="l00051"></a>00051 <span class="keyword">using</span> System.Globalization;
<a name="l00052"></a>00052 <span class="keyword">using</span> System.IO;
<a name="l00053"></a>00053 <span class="keyword">using</span> System.Reflection;
<a name="l00054"></a>00054 <span class="keyword">using</span> System.Runtime.InteropServices;
<a name="l00055"></a>00055 <span class="keyword">using</span> System.Windows.Forms;
<a name="l00056"></a>00056 <span class="keyword">using</span> System.Diagnostics;
<a name="l00057"></a>00057 
<a name="l00058"></a><a class="code" href="namespace_bright_ideas_software.html">00058</a> <span class="keyword">namespace </span>BrightIdeasSoftware
<a name="l00059"></a>00059 {
<a name="l00087"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html">00087</a>     <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html" title="An object list displays 'aspects' of a collection of objects in a multi-column list...">ObjectListView</a> : ListView, ISupportInitialize
<a name="l00088"></a>00088         {
<a name="l00092"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#1a8b636565a63d5d5735afba9123a426">00092</a>                 <span class="keyword">public</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#1a8b636565a63d5d5735afba9123a426" title="Create an ObjectListView.">ObjectListView</a>()
<a name="l00093"></a>00093                         : base()
<a name="l00094"></a>00094                 {
<a name="l00095"></a>00095                         <span class="keyword">this</span>.ColumnClick += <span class="keyword">new</span> ColumnClickEventHandler(<span class="keyword">this</span>.<a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#dc888c0f4e3bc5f572c903bded0d66d1" title="Event handler for the column click event.">HandleColumnClick</a>);
<a name="l00096"></a>00096 
<a name="l00097"></a>00097                         <span class="keyword">this</span>.View = <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#7a53c04bb51af50234d687c01df2dc5e" title="Get/set the style of view that this listview is using.">View</a>.Details;
<a name="l00098"></a>00098                         <span class="keyword">this</span>.DoubleBuffered = <span class="keyword">true</span>; <span class="comment">// kill nasty flickers. hiss... me hates 'em</span>
<a name="l00099"></a>00099                     <span class="keyword">this</span>.AlternateRowBackColor = Color.Empty;
<a name="l00100"></a>00100                 }
<a name="l00101"></a>00101 
<a name="l00102"></a>00102 <span class="preprocessor">                #region Public properties</span>
<a name="l00103"></a>00103 <span class="preprocessor"></span>
<a name="l00110"></a>00110         [Category(<span class="stringliteral">"Behavior"</span>),
<a name="l00111"></a>00111          Description(<span class="stringliteral">"Should the list view show images on subitems?"</span>),
<a name="l00112"></a>00112          DefaultValue(<span class="keyword">false</span>)]
<a name="l00113"></a>00113         <span class="keyword">public</span> <span class="keywordtype">bool</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#6c764ee6853bee5553f8a71457653ed3" title="Should the list view show images on subitems?">ShowImagesOnSubItems</a>
<a name="l00114"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#6c764ee6853bee5553f8a71457653ed3">00114</a>         {
<a name="l00115"></a>00115             <span class="keyword">get</span> { <span class="keywordflow">return</span> showImagesOnSubItems; }
<a name="l00116"></a>00116             <span class="keyword">set</span> { showImagesOnSubItems = value; }
<a name="l00117"></a>00117         }
<a name="l00118"></a>00118 
<a name="l00125"></a>00125                 [Category(<span class="stringliteral">"Behavior"</span>),
<a name="l00126"></a>00126                  Description(<span class="stringliteral">"Will group titles be suffixed with a count of the items in the group?"</span>),
<a name="l00127"></a>00127                  DefaultValue(<span class="keyword">false</span>)]
<a name="l00128"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#e328f3bfc1676ec4771a4dcd033c3bc4">00128</a>                 <span class="keyword">public</span> <span class="keywordtype">bool</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#e328f3bfc1676ec4771a4dcd033c3bc4" title="This property controls whether group labels will be suffixed with a count of items...">ShowItemCountOnGroups</a> {
<a name="l00129"></a>00129                         <span class="keyword">get</span> { <span class="keywordflow">return</span> showItemCountOnGroups; }
<a name="l00130"></a>00130                         <span class="keyword">set</span> { showItemCountOnGroups = value; }
<a name="l00131"></a>00131                 }
<a name="l00132"></a>00132 
<a name="l00144"></a>00144                 [Category(<span class="stringliteral">"Behavior"</span>),
<a name="l00145"></a>00145                  Description(<span class="stringliteral">"The format to use when suffixing item counts to group titles"</span>),
<a name="l00146"></a>00146                  DefaultValue(null)]
<a name="l00147"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#1670dec51ddb76b996dd27faec2bb1c8">00147</a>                 <span class="keyword">public</span> <span class="keywordtype">string</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#1670dec51ddb76b996dd27faec2bb1c8" title="When a group title has an item count, how should the lable be formatted?">GroupWithItemCountFormat</a> {
<a name="l00148"></a>00148                         <span class="keyword">get</span> { <span class="keywordflow">return</span> groupWithItemCountFormat; }
<a name="l00149"></a>00149                         <span class="keyword">set</span> { groupWithItemCountFormat = value; }
<a name="l00150"></a>00150                 }
<a name="l00151"></a>00151 
<a name="l00158"></a>00158                 [Category(<span class="stringliteral">"Appearance"</span>),
<a name="l00159"></a>00159                  Description(<span class="stringliteral">"Should the list view use a different backcolor to alternate rows?"</span>),
<a name="l00160"></a>00160                  DefaultValue(<span class="keyword">false</span>)]
<a name="l00161"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#c4d0e05d0bbc6f4d1b2740e87a9d2279">00161</a>                 <span class="keyword">public</span> <span class="keywordtype">bool</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#c4d0e05d0bbc6f4d1b2740e87a9d2279" title="Should the list give a different background color to every second row?">UseAlternatingBackColors</a> {
<a name="l00162"></a>00162                         <span class="keyword">get</span> { <span class="keywordflow">return</span> useAlternatingBackColors; }
<a name="l00163"></a>00163                         <span class="keyword">set</span> { useAlternatingBackColors = value; }
<a name="l00164"></a>00164                 }
<a name="l00165"></a>00165 
<a name="l00169"></a>00169                 [Category(<span class="stringliteral">"Appearance"</span>),
<a name="l00170"></a>00170                  Description(<span class="stringliteral">"If using alternate colors, what color should alterate rows be?"</span>)
<a name="l00171"></a>00171                  <span class="comment">//DefaultValue(Color.Empty) // I should be able to do this!</span>
<a name="l00172"></a>00172                 ]
<a name="l00173"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#94ac039b28a2ba75e6d9dbb894a6826f">00173</a>                 <span class="keyword">public</span> Color <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#94ac039b28a2ba75e6d9dbb894a6826f" title="If every second row has a background different to the control, what color should...">AlternateRowBackColor</a> {
<a name="l00174"></a>00174                         <span class="keyword">get</span> { <span class="keywordflow">return</span> alternateRowBackColor; }
<a name="l00175"></a>00175                         <span class="keyword">set</span> { alternateRowBackColor = value; }
<a name="l00176"></a>00176                 }
<a name="l00177"></a>00177 
<a name="l00181"></a>00181                 [Browsable(<span class="keyword">false</span>)]
<a name="l00182"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#2bffb9b24dac70d72b09a1c990ec9941">00182</a>                 <span class="keyword">public</span> Color <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#2bffb9b24dac70d72b09a1c990ec9941" title="Return the alternate row background color that has been set, or the default color...">AlternateRowBackColorOrDefault</a> {
<a name="l00183"></a>00183                         <span class="keyword">get</span> {
<a name="l00184"></a>00184                                 <span class="keywordflow">if</span> (alternateRowBackColor == Color.Empty)
<a name="l00185"></a>00185                                         <span class="keywordflow">return</span> Color.LemonChiffon;
<a name="l00186"></a>00186 <span class="comment">//                                      return Color.AliceBlue; // very slight</span>
<a name="l00187"></a>00187                                 <span class="keywordflow">else</span>
<a name="l00188"></a>00188                                         <span class="keywordflow">return</span> alternateRowBackColor;
<a name="l00189"></a>00189                         }
<a name="l00190"></a>00190                 }
<a name="l00191"></a>00191 
<a name="l00195"></a>00195         [Browsable(<span class="keyword">false</span>),
<a name="l00196"></a>00196          DesignerSerializationVisibility(DesignerSerializationVisibility.Hidden)]
<a name="l00197"></a>00197         <span class="keyword">public</span> <a class="code" href="namespace_bright_ideas_software.html#352a0b9e936f8e478c6dfd97a988b718" title="These delegates are used to sort the listview in some custom fashion.">SortDelegate</a> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#5af83177fc87268ab185650ef7c13b3f" title="This delegate can be used to sort the table in a custom fasion.">CustomSorter</a>
<a name="l00198"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#5af83177fc87268ab185650ef7c13b3f">00198</a>         {
<a name="l00199"></a>00199             <span class="keyword">get</span> { <span class="keywordflow">return</span> customSorter; }
<a name="l00200"></a>00200             <span class="keyword">set</span> { customSorter = value; }
<a name="l00201"></a>00201         }
<a name="l00202"></a>00202 
<a name="l00203"></a>00203 
<a name="l00212"></a>00212         [Browsable(<span class="keyword">false</span>),
<a name="l00213"></a>00213          DesignerSerializationVisibility(DesignerSerializationVisibility.Hidden)]
<a name="l00214"></a>00214         <span class="keyword">public</span> <span class="keywordtype">bool</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#a602949c7e0c2425623a2d519e08b8ee" title="Get or set whether or not the listview is frozen. When the listview is frozen, it...">Frozen</a>
<a name="l00215"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#a602949c7e0c2425623a2d519e08b8ee">00215</a>         {
<a name="l00216"></a>00216             <span class="keyword">get</span> { <span class="keywordflow">return</span> freezeCount &gt; 0; }
<a name="l00217"></a>00217             <span class="keyword">set</span> {
<a name="l00218"></a>00218                 <span class="keywordflow">if</span> (value)
<a name="l00219"></a>00219                     <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#4c99078511431d5c3756e737d32df7ad" title="Freeze the listview so that it no longer updates itself.">Freeze</a>();
<a name="l00220"></a>00220                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (freezeCount &gt; 0) {
<a name="l00221"></a>00221                     freezeCount = 1;
<a name="l00222"></a>00222                     <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#a2b609dbf7d39a05049f2cda9c9257ef" title="Unfreeze the listview. If this call is the outermost Unfreeze(), the contents of...">Unfreeze</a>();
<a name="l00223"></a>00223                 }
<a name="l00224"></a>00224             }
<a name="l00225"></a>00225         }
<a name="l00226"></a>00226         <span class="keyword">private</span> <span class="keywordtype">int</span> freezeCount;
<a name="l00227"></a>00227 
<a name="l00233"></a>00233         [Browsable(<span class="keyword">false</span>),
<a name="l00234"></a>00234          DesignerSerializationVisibility(DesignerSerializationVisibility.Hidden)]
<a name="l00235"></a>00235         <span class="keyword">public</span> List&lt;OLVColumn&gt; <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#b57caab9ab33a60d23fb6709aa1f617b" title="Get/set the list of columns that should be used when the list switches to tile view...">ColumnsForTileView</a>
<a name="l00236"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#b57caab9ab33a60d23fb6709aa1f617b">00236</a>         {
<a name="l00237"></a>00237             <span class="keyword">get</span>
<a name="l00238"></a>00238             {
<a name="l00239"></a>00239                 <span class="keywordflow">if</span> (<span class="keyword">this</span>.columnsForTileView.Count == 0) {
<a name="l00240"></a>00240                     <span class="keywordflow">foreach</span> (ColumnHeader column <span class="keywordflow">in</span> <span class="keyword">this</span>.<a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#e3f66b968ce5c1b2312f93ccece030e5" title="Return Columns for this list. We hide the original so we can associate a specialised...">Columns</a>) {
<a name="l00241"></a>00241                         <span class="keywordflow">if</span> (column.Index == 0 || ((<a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html" title="An OLVColumn knows which aspect of an object it should present.">OLVColumn</a>)column).IsTileViewColumn)
<a name="l00242"></a>00242                             <span class="keyword">this</span>.columnsForTileView.Add((<a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html" title="An OLVColumn knows which aspect of an object it should present.">OLVColumn</a>)column);
<a name="l00243"></a>00243                     }
<a name="l00244"></a>00244                 }
<a name="l00245"></a>00245                 <span class="keywordflow">return</span> columnsForTileView;
<a name="l00246"></a>00246             }
<a name="l00247"></a>00247             <span class="keyword">set</span> { columnsForTileView = value; }
<a name="l00248"></a>00248         }
<a name="l00249"></a>00249         <span class="keyword">private</span> List&lt;OLVColumn&gt; columnsForTileView = <span class="keyword">new</span> List&lt;OLVColumn&gt;();
<a name="l00250"></a>00250 
<a name="l00255"></a>00255         [Browsable(<span class="keyword">false</span>),
<a name="l00256"></a>00256          DesignerSerializationVisibility(DesignerSerializationVisibility.Hidden)]
<a name="l00257"></a>00257         <span class="keyword">public</span> Object <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#a87d82d8ce1077be080698fd88cf5088" title="Get the model object from the currently selected row. If no row is selected, or more...">SelectedObject</a>
<a name="l00258"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#a87d82d8ce1077be080698fd88cf5088">00258</a>         {
<a name="l00259"></a>00259             <span class="keyword">get</span> { <span class="keywordflow">return</span> <span class="keyword">this</span>.GetSelectedObject(); }
<a name="l00260"></a>00260             <span class="keyword">set</span> { <span class="keyword">this</span>.SelectObject(value); }
<a name="l00261"></a>00261         }
<a name="l00262"></a>00262 
<a name="l00267"></a>00267         [Browsable(<span class="keyword">false</span>),
<a name="l00268"></a>00268          DesignerSerializationVisibility(DesignerSerializationVisibility.Hidden)]
<a name="l00269"></a>00269         <span class="keyword">public</span> ArrayList <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#d24b5928822a3b8a122667ca97a9b7f6" title="Get the model objects from the currently selected rows. If no row is selected, the...">SelectedObjects</a>
<a name="l00270"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#d24b5928822a3b8a122667ca97a9b7f6">00270</a>         {
<a name="l00271"></a>00271             <span class="keyword">get</span> { <span class="keywordflow">return</span> <span class="keyword">this</span>.GetSelectedObjects(); }
<a name="l00272"></a>00272             <span class="keyword">set</span> { <span class="keyword">this</span>.SelectObjects(value); }
<a name="l00273"></a>00273         }
<a name="l00274"></a>00274 
<a name="l00280"></a>00280         <span class="keyword">new</span> <span class="keyword">public</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#7a53c04bb51af50234d687c01df2dc5e" title="Get/set the style of view that this listview is using.">View</a> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#7a53c04bb51af50234d687c01df2dc5e" title="Get/set the style of view that this listview is using.">View</a>
<a name="l00281"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#7a53c04bb51af50234d687c01df2dc5e">00281</a>         {
<a name="l00282"></a>00282             <span class="keyword">get</span>
<a name="l00283"></a>00283             {
<a name="l00284"></a>00284                 <span class="keywordflow">return</span> base.View;
<a name="l00285"></a>00285             }
<a name="l00286"></a>00286             <span class="keyword">set</span>
<a name="l00287"></a>00287             {
<a name="l00288"></a>00288                 <span class="keywordflow">if</span> (base.View == value)
<a name="l00289"></a>00289                     <span class="keywordflow">return</span>;
<a name="l00290"></a>00290 
<a name="l00291"></a>00291                 <span class="keywordflow">if</span> (<span class="keyword">this</span>.<a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#a602949c7e0c2425623a2d519e08b8ee" title="Get or set whether or not the listview is frozen. When the listview is frozen, it...">Frozen</a>) {
<a name="l00292"></a>00292                     base.View = value;
<a name="l00293"></a>00293                     <span class="keywordflow">return</span>;
<a name="l00294"></a>00294                 }
<a name="l00295"></a>00295 
<a name="l00296"></a>00296                 <span class="comment">// If we are leaving a details view, remember the columns we had</span>
<a name="l00297"></a>00297                 <span class="keywordflow">if</span> (base.View == <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#7a53c04bb51af50234d687c01df2dc5e" title="Get/set the style of view that this listview is using.">View</a>.Details &amp;&amp; <span class="keyword">this</span>.Columns.Count &gt; 0) {
<a name="l00298"></a>00298                     <span class="keyword">this</span>.columnsToRestore = <span class="keyword">new</span> List&lt;OLVColumn&gt;();
<a name="l00299"></a>00299                     <span class="keywordflow">foreach</span> (ColumnHeader column <span class="keywordflow">in</span> <span class="keyword">this</span>.<a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#e3f66b968ce5c1b2312f93ccece030e5" title="Return Columns for this list. We hide the original so we can associate a specialised...">Columns</a>)
<a name="l00300"></a>00300                         <span class="keyword">this</span>.columnsToRestore.Add((<a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html" title="An OLVColumn knows which aspect of an object it should present.">OLVColumn</a>)column);
<a name="l00301"></a>00301                 }
<a name="l00302"></a>00302 
<a name="l00303"></a>00303                 <span class="keyword">this</span>.Freeze();
<a name="l00304"></a>00304 
<a name="l00305"></a>00305                 <span class="comment">// If we are switching to tile view, install our tile columns and set a reasonable default tile size</span>
<a name="l00306"></a>00306                 <span class="keywordflow">if</span> (value == <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#7a53c04bb51af50234d687c01df2dc5e" title="Get/set the style of view that this listview is using.">View</a>.Tile) {
<a name="l00307"></a>00307                     <span class="keywordflow">if</span> (<span class="keyword">this</span>.<a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#b57caab9ab33a60d23fb6709aa1f617b" title="Get/set the list of columns that should be used when the list switches to tile view...">ColumnsForTileView</a>.Count &gt; 0) {
<a name="l00308"></a>00308                         <span class="keyword">this</span>.Columns.Clear();
<a name="l00309"></a>00309                         <span class="keyword">this</span>.Columns.AddRange(<span class="keyword">this</span>.<a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#b57caab9ab33a60d23fb6709aa1f617b" title="Get/set the list of columns that should be used when the list switches to tile view...">ColumnsForTileView</a>.ToArray());
<a name="l00310"></a>00310                     }
<a name="l00311"></a>00311                     <span class="keywordflow">if</span> (<span class="keyword">this</span>.<a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#e3f66b968ce5c1b2312f93ccece030e5" title="Return Columns for this list. We hide the original so we can associate a specialised...">Columns</a>.Count &gt; 0 &amp;&amp; <span class="keyword">this</span>.TileSize.Width == 0 &amp;&amp; <span class="keyword">this</span>.TileSize.Height == 0) {
<a name="l00312"></a>00312                         <span class="keywordtype">int</span> imageHeight = (<span class="keyword">this</span>.LargeImageList == null ? 16 : <span class="keyword">this</span>.LargeImageList.ImageSize.Height);
<a name="l00313"></a>00313                         <span class="keywordtype">int</span> dataHeight = (<span class="keyword">this</span>.Font.Height + 1) * <span class="keyword">this</span>.<a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#e3f66b968ce5c1b2312f93ccece030e5" title="Return Columns for this list. We hide the original so we can associate a specialised...">Columns</a>.Count;
<a name="l00314"></a>00314                         <span class="keyword">this</span>.TileSize = <span class="keyword">new</span> Size(200, ((imageHeight &gt; dataHeight) ? imageHeight : dataHeight));
<a name="l00315"></a>00315                     }
<a name="l00316"></a>00316                     <span class="comment">// We changed the columns, so we have to rebuild the list contents</span>
<a name="l00317"></a>00317                     <span class="keyword">this</span>.BuildList();
<a name="l00318"></a>00318                 }
<a name="l00319"></a>00319 
<a name="l00320"></a>00320                 <span class="comment">// If we're switching back to the details view from the tile view,</span>
<a name="l00321"></a>00321                 <span class="comment">// put the original columns back.</span>
<a name="l00322"></a>00322                 <span class="keywordflow">if</span> (value == <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#7a53c04bb51af50234d687c01df2dc5e" title="Get/set the style of view that this listview is using.">View</a>.Details &amp;&amp; <span class="keyword">this</span>.columnsToRestore != null) {
<a name="l00323"></a>00323                     <span class="keyword">this</span>.Columns.Clear();
<a name="l00324"></a>00324                     <span class="keyword">this</span>.Columns.AddRange(<span class="keyword">this</span>.columnsToRestore.ToArray());
<a name="l00325"></a>00325                     <span class="keyword">this</span>.columnsToRestore = null;
<a name="l00326"></a>00326 
<a name="l00327"></a>00327                     <span class="comment">// We changed the columns, so we have to rebuild the list contents</span>
<a name="l00328"></a>00328                     <span class="keyword">this</span>.BuildList();
<a name="l00329"></a>00329                 }
<a name="l00330"></a>00330 
<a name="l00331"></a>00331                 base.View = value;
<a name="l00332"></a>00332                 <span class="keyword">this</span>.Unfreeze();
<a name="l00333"></a>00333             }
<a name="l00334"></a>00334         }
<a name="l00335"></a>00335         <span class="keyword">private</span> List&lt;OLVColumn&gt; columnsToRestore = null;
<a name="l00336"></a>00336         
<a name="l00337"></a>00337 <span class="preprocessor">                #endregion</span>
<a name="l00338"></a>00338 <span class="preprocessor"></span>
<a name="l00339"></a>00339 <span class="preprocessor">        #region List commands</span>
<a name="l00340"></a>00340 <span class="preprocessor"></span>
<a name="l00346"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#8e952cedd7f8ee1c14345ef85797be1d">00346</a>                 <span class="keyword">virtual</span> <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#8e952cedd7f8ee1c14345ef85797be1d" title="Set the collection of objects that will be shown in this list view.">SetObjects</a> (IEnumerable collection)
<a name="l00347"></a>00347                 {
<a name="l00348"></a>00348                         <span class="keyword">this</span>.objects = collection;
<a name="l00349"></a>00349                         <span class="keyword">this</span>.BuildList();
<a name="l00350"></a>00350         }
<a name="l00351"></a>00351 
<a name="l00355"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#ba54890724aba9484ab03c86b0d2aed8">00355</a>                 <span class="keyword">virtual</span> <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#ba54890724aba9484ab03c86b0d2aed8">BuildList</a>()
<a name="l00356"></a>00356                 {
<a name="l00357"></a>00357             <span class="keywordflow">if</span> (<span class="keyword">this</span>.<a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#a602949c7e0c2425623a2d519e08b8ee" title="Get or set whether or not the listview is frozen. When the listview is frozen, it...">Frozen</a>)
<a name="l00358"></a>00358                 <span class="keywordflow">return</span>;
<a name="l00359"></a>00359 
<a name="l00360"></a>00360                         <span class="keyword">this</span>.BeginUpdate();
<a name="l00361"></a>00361                         <span class="keyword">this</span>.Items.Clear();
<a name="l00362"></a>00362                         <span class="keyword">this</span>.ListViewItemSorter = null;
<a name="l00363"></a>00363 
<a name="l00364"></a>00364             <span class="keywordflow">if</span> (<span class="keyword">this</span>.objects != null) {
<a name="l00365"></a>00365                 <span class="keywordflow">foreach</span> (<span class="keywordtype">object</span> rowObject <span class="keywordflow">in</span> <span class="keyword">this</span>.objects) {
<a name="l00366"></a>00366                     <a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_item.html">OLVListItem</a> lvi = <span class="keyword">new</span> <a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_item.html">OLVListItem</a>(rowObject);
<a name="l00367"></a>00367                     <span class="keyword">this</span>.FillInValues(lvi, rowObject);
<a name="l00368"></a>00368                     <span class="keyword">this</span>.Items.Add(lvi);
<a name="l00369"></a>00369                 }
<a name="l00370"></a>00370                 <span class="keyword">this</span>.SetAllSubItemImages();
<a name="l00371"></a>00371                 <span class="keyword">this</span>.Sort(<span class="keyword">this</span>.lastSortColumn);
<a name="l00372"></a>00372             }
<a name="l00373"></a>00373 
<a name="l00374"></a>00374                         <span class="keyword">this</span>.EndUpdate();
<a name="l00375"></a>00375         }
<a name="l00376"></a>00376 
<a name="l00380"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#986b5e4427c05d19a51fa624d126f69d">00380</a>         <span class="keyword">new</span> <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#986b5e4427c05d19a51fa624d126f69d" title="Sort the items by the last sort column.">Sort</a>()
<a name="l00381"></a>00381         {
<a name="l00382"></a>00382             <span class="keyword">this</span>.Sort(<span class="keyword">this</span>.lastSortColumn);
<a name="l00383"></a>00383         }
<a name="l00384"></a>00384 
<a name="l00389"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#07b16245a7e3be39fd5e280d98afd335">00389</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#07b16245a7e3be39fd5e280d98afd335" title="Organise the view items into groups, based on the last sort column or the first column...">BuildGroups</a>()
<a name="l00390"></a>00390         {
<a name="l00391"></a>00391             <span class="keyword">this</span>.BuildGroups(<span class="keyword">this</span>.lastSortColumn);
<a name="l00392"></a>00392         }
<a name="l00393"></a>00393 
<a name="l00398"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#9bc24261b99f86239e03734322d04546">00398</a>         <span class="keyword">virtual</span> <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#07b16245a7e3be39fd5e280d98afd335" title="Organise the view items into groups, based on the last sort column or the first column...">BuildGroups</a>(<a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html" title="An OLVColumn knows which aspect of an object it should present.">OLVColumn</a> column)
<a name="l00399"></a>00399         {
<a name="l00400"></a>00400             <span class="keywordflow">if</span> (column == null)
<a name="l00401"></a>00401                 column = (<a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html" title="An OLVColumn knows which aspect of an object it should present.">OLVColumn</a>)<span class="keyword">this</span>.<a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#e3f66b968ce5c1b2312f93ccece030e5" title="Return Columns for this list. We hide the original so we can associate a specialised...">Columns</a>[0];
<a name="l00402"></a>00402 
<a name="l00403"></a>00403             <span class="keyword">this</span>.Groups.Clear();
<a name="l00404"></a>00404 
<a name="l00405"></a>00405             <span class="comment">// Seperate the list view items into groups, using the group key as the descrimanent</span>
<a name="l00406"></a>00406             Dictionary&lt;object, List&lt;OLVListItem&gt;&gt; map = <span class="keyword">new</span> Dictionary&lt;object, List&lt;OLVListItem&gt;&gt;();
<a name="l00407"></a>00407             <span class="keywordflow">foreach</span> (<a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_item.html">OLVListItem</a> olvi <span class="keywordflow">in</span> <span class="keyword">this</span>.Items) {
<a name="l00408"></a>00408                 <span class="keywordtype">object</span> key = column.<a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html#ce4aaa8ec94a9e2f67d080fb89509ae2" title="For a given row object, return the object that is the key of the group that this...">GetGroupKey</a>(olvi.RowObject);
<a name="l00409"></a>00409                 <span class="keywordflow">if</span> (key == null)
<a name="l00410"></a>00410                     key = <span class="stringliteral">"{null}"</span>; <span class="comment">// null can't be used as the key for a dictionary</span>
<a name="l00411"></a>00411                 <span class="keywordflow">if</span> (!map.ContainsKey(key))
<a name="l00412"></a>00412                     map[key] = <span class="keyword">new</span> List&lt;OLVListItem&gt;();
<a name="l00413"></a>00413                 map[key].Add(olvi);
<a name="l00414"></a>00414             }
<a name="l00415"></a>00415 
<a name="l00416"></a>00416             <span class="comment">// Make a list of the required groups</span>
<a name="l00417"></a>00417             List&lt;ListViewGroup&gt; groups = <span class="keyword">new</span> List&lt;ListViewGroup&gt;();
<a name="l00418"></a>00418             <span class="keywordflow">foreach</span> (<span class="keywordtype">object</span> key <span class="keywordflow">in</span> map.Keys) {
<a name="l00419"></a>00419                 ListViewGroup lvg = <span class="keyword">new</span> ListViewGroup(column.<a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html#4cb5703a5fd96b54e33a93ba93de23be" title="For a given group value, return the string that should be used as the groups title...">ConvertGroupKeyToTitle</a>(key));
<a name="l00420"></a>00420                 lvg.Tag = key;
<a name="l00421"></a>00421                 groups.Add(lvg);
<a name="l00422"></a>00422             }
<a name="l00423"></a>00423 
<a name="l00424"></a>00424             <span class="comment">// Sort the groups</span>
<a name="l00425"></a>00425             groups.Sort(<span class="keyword">new</span> <a class="code" href="class_bright_ideas_software_1_1_list_view_group_comparer.html">ListViewGroupComparer</a>(<span class="keyword">this</span>.lastSortOrder));
<a name="l00426"></a>00426 
<a name="l00427"></a>00427             <span class="comment">// Put each group into the list view, and give each group its member items.</span>
<a name="l00428"></a>00428             <span class="comment">// The order of statements is important here:</span>
<a name="l00429"></a>00429             <span class="comment">// - the header must be calculate before the group is added to the list view,</span>
<a name="l00430"></a>00430             <span class="comment">//   otherwise changing the header causes a nasty redraw (even in the middle of a BeginUpdate...EndUpdate pair)</span>
<a name="l00431"></a>00431             <span class="comment">// - the group must be added before it is given items, otherwise an exception is thrown (is this documented?)</span>
<a name="l00432"></a>00432             <span class="keywordtype">string</span> fmt = <span class="keyword">this</span>.GroupWithItemCountFormat;
<a name="l00433"></a>00433             <span class="keywordflow">if</span> (String.IsNullOrEmpty(fmt))
<a name="l00434"></a>00434                 fmt = <span class="stringliteral">"{0} [{1} items]"</span>;
<a name="l00435"></a>00435             <span class="keywordflow">foreach</span> (ListViewGroup group <span class="keywordflow">in</span> groups) {
<a name="l00436"></a>00436                 <span class="keywordflow">if</span> (<span class="keyword">this</span>.<a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#e328f3bfc1676ec4771a4dcd033c3bc4" title="This property controls whether group labels will be suffixed with a count of items...">ShowItemCountOnGroups</a>)
<a name="l00437"></a>00437                     group.Header = String.Format(fmt, group.Header, map[group.Tag].Count);
<a name="l00438"></a>00438                 <span class="keyword">this</span>.Groups.Add(group);
<a name="l00439"></a>00439                 map[group.Tag].Sort(<span class="keyword">new</span> <a class="code" href="class_bright_ideas_software_1_1_column_comparer.html" title="ColumnComparer is the workhorse for all comparison between two values of a particular...">ColumnComparer</a>(column, <span class="keyword">this</span>.lastSortOrder));
<a name="l00440"></a>00440                 group.Items.AddRange(map[group.Tag].ToArray());
<a name="l00441"></a>00441             }
<a name="l00442"></a>00442         }
<a name="l00443"></a>00443 
<a name="l00444"></a>00444 <span class="preprocessor">        #endregion</span>
<a name="l00445"></a>00445 <span class="preprocessor"></span>                
<a name="l00446"></a>00446 <span class="preprocessor">                #region Object manipulation</span>
<a name="l00447"></a>00447 <span class="preprocessor"></span>
<a name="l00452"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#0efb71d1a8e01de0ef468bf212c1c161">00452</a>                 <span class="keyword">virtual</span> <span class="keyword">public</span> <span class="keywordtype">object</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#0efb71d1a8e01de0ef468bf212c1c161" title="Return the model object of the row that is selected or null if there is no selection...">GetSelectedObject</a>()
<a name="l00453"></a>00453                 {
<a name="l00454"></a>00454                         <span class="keywordflow">if</span> (<span class="keyword">this</span>.SelectedItems.Count == 1)
<a name="l00455"></a>00455                                 <span class="keywordflow">return</span> ((<a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_item.html">OLVListItem</a>)<span class="keyword">this</span>.SelectedItems[0]).RowObject;
<a name="l00456"></a>00456                         <span class="keywordflow">else</span>
<a name="l00457"></a>00457                                 <span class="keywordflow">return</span> null;
<a name="l00458"></a>00458                 }
<a name="l00459"></a>00459 
<a name="l00464"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#e242389ac3c1ffb4c2441a9bfb5378d1">00464</a>                 <span class="keyword">virtual</span> <span class="keyword">public</span> ArrayList <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#e242389ac3c1ffb4c2441a9bfb5378d1" title="Return the model objects of the rows that are selected or an empty collection if...">GetSelectedObjects</a>()
<a name="l00465"></a>00465                 {
<a name="l00466"></a>00466                         ArrayList objects = <span class="keyword">new</span> ArrayList(<span class="keyword">this</span>.SelectedItems.Count);
<a name="l00467"></a>00467                         <span class="keywordflow">foreach</span> (ListViewItem lvi <span class="keywordflow">in</span> <span class="keyword">this</span>.SelectedItems)
<a name="l00468"></a>00468                                 objects.Add(((<a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_item.html">OLVListItem</a>)lvi).RowObject);
<a name="l00469"></a>00469 
<a name="l00470"></a>00470                         <span class="keywordflow">return</span> objects;
<a name="l00471"></a>00471                 }
<a name="l00472"></a>00472 
<a name="l00477"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#e92556b319c09900e15e25eb21c86614">00477</a>                 <span class="keyword">virtual</span> <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#e92556b319c09900e15e25eb21c86614" title="Select the row that is displaying the given model object. All other rows are deselected...">SelectObject</a>(<span class="keywordtype">object</span> modelObject)
<a name="l00478"></a>00478                 {
<a name="l00479"></a>00479                         <span class="keyword">this</span>.SelectedItems.Clear();
<a name="l00480"></a>00480 
<a name="l00481"></a>00481                         <span class="comment">//TODO: If this is too slow, we could keep a map of model object to ListViewItems</span>
<a name="l00482"></a>00482                         <span class="keywordflow">foreach</span> (ListViewItem lvi <span class="keywordflow">in</span> <span class="keyword">this</span>.Items)
<a name="l00483"></a>00483                         {
<a name="l00484"></a>00484                                 <span class="keywordflow">if</span> (((<a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_item.html">OLVListItem</a>)lvi).RowObject == modelObject)
<a name="l00485"></a>00485                                 {
<a name="l00486"></a>00486                                         lvi.Selected = <span class="keyword">true</span>;
<a name="l00487"></a>00487                                         <span class="keywordflow">break</span>;
<a name="l00488"></a>00488                                 }
<a name="l00489"></a>00489                         }
<a name="l00490"></a>00490                 }
<a name="l00491"></a>00491 
<a name="l00496"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#a1f05a0624665beb31b4adac2ae55635">00496</a>                 <span class="keyword">virtual</span> <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#a1f05a0624665beb31b4adac2ae55635" title="Select the rows that is displaying any of the given model object. All other rows...">SelectObjects</a>(IList modelObjects)
<a name="l00497"></a>00497                 {
<a name="l00498"></a>00498                         <span class="keyword">this</span>.SelectedItems.Clear();
<a name="l00499"></a>00499 
<a name="l00500"></a>00500                         <span class="comment">//TODO: If this is too slow, we could keep a map of model object to ListViewItems</span>
<a name="l00501"></a>00501                         <span class="keywordflow">foreach</span> (ListViewItem lvi <span class="keywordflow">in</span> <span class="keyword">this</span>.Items)
<a name="l00502"></a>00502                         {
<a name="l00503"></a>00503                                 <span class="keywordflow">if</span> (modelObjects.Contains(((<a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_item.html">OLVListItem</a>)lvi).RowObject))
<a name="l00504"></a>00504                                         lvi.Selected = <span class="keyword">true</span>;
<a name="l00505"></a>00505                         }
<a name="l00506"></a>00506                 }
<a name="l00507"></a>00507 
<a name="l00513"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#e598860ed83eae89432e48b2584272d7">00513</a>                 <span class="keyword">virtual</span> <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#e598860ed83eae89432e48b2584272d7" title="Update the ListViewItem with the data from its associated model.">RefreshItem</a>(<a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_item.html">OLVListItem</a> olvi)
<a name="l00514"></a>00514                 {
<a name="l00515"></a>00515                         <span class="comment">// For some reason, clearing the subitems also wipes out the back color,</span>
<a name="l00516"></a>00516                         <span class="comment">// so we need to store it and then put it back again later</span>
<a name="l00517"></a>00517                         Color c = olvi.BackColor;
<a name="l00518"></a>00518                         olvi.SubItems.Clear();
<a name="l00519"></a>00519                         <span class="keyword">this</span>.FillInValues(olvi, olvi.<a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_item.html#8a7730d25aaaacd31ec03384c0ab3e50" title="RowObject is the model object that is source of the data for this list item.">RowObject</a>);
<a name="l00520"></a>00520                         <span class="keyword">this</span>.SetSubItemImages(olvi.Index, olvi);
<a name="l00521"></a>00521                         olvi.BackColor = c;
<a name="l00522"></a>00522                 }
<a name="l00523"></a>00523 
<a name="l00528"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#589e893acb5a57c5cf30e99ae26c6014">00528</a>                 <span class="keyword">virtual</span> <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#589e893acb5a57c5cf30e99ae26c6014" title="Update the rows that are showing the given objects.">RefreshObject</a>(<span class="keywordtype">object</span> modelObject)
<a name="l00529"></a>00529                 {
<a name="l00530"></a>00530                         <span class="keyword">this</span>.RefreshObjects(<span class="keyword">new</span> <span class="keywordtype">object</span>[] {modelObject});
<a name="l00531"></a>00531                 }
<a name="l00532"></a>00532 
<a name="l00537"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#6477764f2f608db6ad336d6e7142d687">00537</a>                 <span class="keyword">virtual</span> <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#6477764f2f608db6ad336d6e7142d687">RefreshObjects</a>(IList modelObjects)
<a name="l00538"></a>00538                 {
<a name="l00539"></a>00539                         <span class="keywordflow">foreach</span> (ListViewItem lvi <span class="keywordflow">in</span> <span class="keyword">this</span>.Items)
<a name="l00540"></a>00540                         {
<a name="l00541"></a>00541                                 <a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_item.html">OLVListItem</a> olvi = (<a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_item.html">OLVListItem</a>)lvi;
<a name="l00542"></a>00542                                 <span class="keywordflow">if</span> (modelObjects.Contains(olvi.<a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_item.html#8a7730d25aaaacd31ec03384c0ab3e50" title="RowObject is the model object that is source of the data for this list item.">RowObject</a>))
<a name="l00543"></a>00543                                         <span class="keyword">this</span>.<a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#e598860ed83eae89432e48b2584272d7" title="Update the ListViewItem with the data from its associated model.">RefreshItem</a>(olvi);
<a name="l00544"></a>00544                         }
<a name="l00545"></a>00545                 }
<a name="l00546"></a>00546 
<a name="l00551"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#c7e99a12ada5422880684b7c6f704da1">00551</a>                 <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#c7e99a12ada5422880684b7c6f704da1">RefreshSelectedObjects</a>()
<a name="l00552"></a>00552                 {
<a name="l00553"></a>00553                         <span class="keywordflow">foreach</span> (ListViewItem lvi <span class="keywordflow">in</span> <span class="keyword">this</span>.SelectedItems)
<a name="l00554"></a>00554                         {
<a name="l00555"></a>00555                                 <a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_item.html">OLVListItem</a> olvi = (<a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_item.html">OLVListItem</a>)lvi;
<a name="l00556"></a>00556                                 <span class="keyword">this</span>.RefreshItem(olvi);
<a name="l00557"></a>00557                         }
<a name="l00558"></a>00558                 }
<a name="l00559"></a>00559 
<a name="l00560"></a>00560 <span class="preprocessor">                #endregion</span>
<a name="l00561"></a>00561 <span class="preprocessor"></span>
<a name="l00562"></a>00562 <span class="preprocessor">                #region Freezing</span>
<a name="l00563"></a>00563 <span class="preprocessor"></span>
<a name="l00568"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#4c99078511431d5c3756e737d32df7ad">00568</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#4c99078511431d5c3756e737d32df7ad" title="Freeze the listview so that it no longer updates itself.">Freeze</a>()
<a name="l00569"></a>00569         {
<a name="l00570"></a>00570             freezeCount++;
<a name="l00571"></a>00571         }
<a name="l00572"></a>00572 
<a name="l00578"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#a2b609dbf7d39a05049f2cda9c9257ef">00578</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#a2b609dbf7d39a05049f2cda9c9257ef" title="Unfreeze the listview. If this call is the outermost Unfreeze(), the contents of...">Unfreeze</a>()
<a name="l00579"></a>00579         {
<a name="l00580"></a>00580             <span class="keywordflow">if</span> (freezeCount &lt;= 0)
<a name="l00581"></a>00581                 <span class="keywordflow">return</span>;
<a name="l00582"></a>00582 
<a name="l00583"></a>00583             freezeCount--;
<a name="l00584"></a>00584             <span class="keywordflow">if</span> (freezeCount == 0)
<a name="l00585"></a>00585                 <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#cd4555556e0077f3a5bb543ccfc20d71" title="Do the actual work required when the listview is unfrozen.">DoUnfreeze</a>();
<a name="l00586"></a>00586         }
<a name="l00587"></a>00587 
<a name="l00591"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#cd4555556e0077f3a5bb543ccfc20d71">00591</a>         <span class="keyword">virtual</span> <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#cd4555556e0077f3a5bb543ccfc20d71" title="Do the actual work required when the listview is unfrozen.">DoUnfreeze</a>()
<a name="l00592"></a>00592         {
<a name="l00593"></a>00593             <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#ba54890724aba9484ab03c86b0d2aed8">BuildList</a>();
<a name="l00594"></a>00594         }
<a name="l00595"></a>00595 
<a name="l00596"></a>00596 <span class="preprocessor">                #endregion</span>
<a name="l00597"></a>00597 <span class="preprocessor"></span>
<a name="l00598"></a>00598 <span class="preprocessor">                #region ColumnSorting</span>
<a name="l00599"></a>00599 <span class="preprocessor"></span>
<a name="l00603"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#dc888c0f4e3bc5f572c903bded0d66d1">00603</a>                 <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#dc888c0f4e3bc5f572c903bded0d66d1" title="Event handler for the column click event.">HandleColumnClick</a>(<span class="keywordtype">object</span> sender, ColumnClickEventArgs e)
<a name="l00604"></a>00604                 {
<a name="l00605"></a>00605                         <span class="comment">// Toggle the sorting direction on sucessive clicks on the same column</span>
<a name="l00606"></a>00606             <span class="keywordflow">if</span> (<span class="keyword">this</span>.lastSortColumn != null &amp;&amp; e.Column == <span class="keyword">this</span>.lastSortColumn.Index)
<a name="l00607"></a>00607                 <span class="keyword">this</span>.lastSortOrder = (<span class="keyword">this</span>.lastSortOrder == SortOrder.Descending ? SortOrder.Ascending : SortOrder.Descending);
<a name="l00608"></a>00608                         <span class="keywordflow">else</span> 
<a name="l00609"></a>00609                 <span class="keyword">this</span>.lastSortOrder = SortOrder.Ascending;
<a name="l00610"></a>00610                         
<a name="l00611"></a>00611                         <span class="keyword">this</span>.BeginUpdate();
<a name="l00612"></a>00612             <span class="keyword">this</span>.Sort(e.Column);
<a name="l00613"></a>00613                         <span class="keyword">this</span>.EndUpdate();
<a name="l00614"></a>00614                 }
<a name="l00615"></a>00615 
<a name="l00622"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#e7cf8ccc6a04e71f51cbd14b8fe1b5ad">00622</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#986b5e4427c05d19a51fa624d126f69d" title="Sort the items by the last sort column.">Sort</a>(<span class="keywordtype">int</span> columnToSortIndex)
<a name="l00623"></a>00623         {
<a name="l00624"></a>00624             <span class="keywordflow">if</span> (columnToSortIndex &gt;= 0 &amp;&amp; columnToSortIndex &lt; <span class="keyword">this</span>.<a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#e3f66b968ce5c1b2312f93ccece030e5" title="Return Columns for this list. We hide the original so we can associate a specialised...">Columns</a>.Count)
<a name="l00625"></a>00625                 <span class="keyword">this</span>.Sort(<span class="keyword">this</span>.<a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#e3f66b968ce5c1b2312f93ccece030e5" title="Return Columns for this list. We hide the original so we can associate a specialised...">Columns</a>[columnToSortIndex] as <a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html" title="An OLVColumn knows which aspect of an object it should present.">OLVColumn</a>);
<a name="l00626"></a>00626         }
<a name="l00627"></a>00627 
<a name="l00634"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#0741635d3e422685bc3f6b7ebc4d17b4">00634</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#986b5e4427c05d19a51fa624d126f69d" title="Sort the items by the last sort column.">Sort</a>(<a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html" title="An OLVColumn knows which aspect of an object it should present.">OLVColumn</a> columnToSort)
<a name="l00635"></a>00635                 {
<a name="l00636"></a>00636             <span class="keywordflow">if</span> (columnToSort == null)
<a name="l00637"></a>00637                 columnToSort = (<a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html" title="An OLVColumn knows which aspect of an object it should present.">OLVColumn</a>)<span class="keyword">this</span>.<a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#e3f66b968ce5c1b2312f93ccece030e5" title="Return Columns for this list. We hide the original so we can associate a specialised...">Columns</a>[0];           
<a name="l00638"></a>00638 
<a name="l00639"></a>00639                         <span class="keywordflow">if</span> (lastSortOrder == SortOrder.None)
<a name="l00640"></a>00640                                 lastSortOrder = <span class="keyword">this</span>.Sorting;
<a name="l00641"></a>00641 
<a name="l00642"></a>00642             <span class="keywordflow">if</span> (<span class="keyword">this</span>.ShowGroups)
<a name="l00643"></a>00643                 <span class="keyword">this</span>.BuildGroups(columnToSort);
<a name="l00644"></a>00644             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">this</span>.<a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#5af83177fc87268ab185650ef7c13b3f" title="This delegate can be used to sort the table in a custom fasion.">CustomSorter</a> != null)
<a name="l00645"></a>00645                 <span class="keyword">this</span>.CustomSorter(columnToSort, lastSortOrder);
<a name="l00646"></a>00646                         <span class="keywordflow">else</span> 
<a name="l00647"></a>00647                 <span class="keyword">this</span>.ListViewItemSorter = <span class="keyword">new</span> <a class="code" href="class_bright_ideas_software_1_1_column_comparer.html" title="ColumnComparer is the workhorse for all comparison between two values of a particular...">ColumnComparer</a>(columnToSort, lastSortOrder);
<a name="l00648"></a>00648 
<a name="l00649"></a>00649                         <span class="keyword">this</span>.ShowSortIndicator(columnToSort, lastSortOrder);
<a name="l00650"></a>00650                         
<a name="l00651"></a>00651                         <span class="keywordflow">if</span> (<span class="keyword">this</span>.<a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#c4d0e05d0bbc6f4d1b2740e87a9d2279" title="Should the list give a different background color to every second row?">UseAlternatingBackColors</a> &amp;&amp; <span class="keyword">this</span>.<a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#7a53c04bb51af50234d687c01df2dc5e" title="Get/set the style of view that this listview is using.">View</a> == <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#7a53c04bb51af50234d687c01df2dc5e" title="Get/set the style of view that this listview is using.">View</a>.Details)
<a name="l00652"></a>00652                                 <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#bd2c599254aa195905199c28da8df580">PrepareAlternateBackColors</a>();
<a name="l00653"></a>00653 
<a name="l00654"></a>00654             <span class="keyword">this</span>.lastSortColumn = columnToSort;
<a name="l00655"></a>00655                 }
<a name="l00656"></a>00656 
<a name="l00662"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#d92b020418b5a89b0f25ebb628847f07">00662</a>                 <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#d92b020418b5a89b0f25ebb628847f07" title="Put a sort indicator next to the text of the given given column.">ShowSortIndicator</a>(<a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html" title="An OLVColumn knows which aspect of an object it should present.">OLVColumn</a> columnToSort, SortOrder sortOrder)
<a name="l00663"></a>00663                 {
<a name="l00664"></a>00664                         <span class="comment">/*MakeSortIndictorImages();</span>
<a name="l00665"></a>00665 <span class="comment">                                </span>
<a name="l00666"></a>00666 <span class="comment">                        // Remove all previous sort indicators</span>
<a name="l00667"></a>00667 <span class="comment">                        for (int i=0; i&lt;this.Columns.Count; i++) </span>
<a name="l00668"></a>00668 <span class="comment">                                ListViewNative.SetColumnImage(this, i, -1);</span>
<a name="l00669"></a>00669 <span class="comment">                                </span>
<a name="l00670"></a>00670 <span class="comment">                        // Find the index of the sort indicator we want to use.</span>
<a name="l00671"></a>00671 <span class="comment">                        // SortOrder.None doesn't show an image.</span>
<a name="l00672"></a>00672 <span class="comment">                        int imageIndex = -1;</span>
<a name="l00673"></a>00673 <span class="comment">                        if (sortOrder == SortOrder.Ascending)</span>
<a name="l00674"></a>00674 <span class="comment">                                imageIndex = this.SmallImageList.Images.IndexOfKey(SORT_INDICATOR_UP_KEY);</span>
<a name="l00675"></a>00675 <span class="comment">                        else if (sortOrder == SortOrder.Descending)</span>
<a name="l00676"></a>00676 <span class="comment">                                imageIndex = this.SmallImageList.Images.IndexOfKey(SORT_INDICATOR_DOWN_KEY);</span>
<a name="l00677"></a>00677 <span class="comment">                        </span>
<a name="l00678"></a>00678 <span class="comment">                        ListViewNative.SetColumnImage(this, columnToSort.Index, imageIndex);*/</span>
<a name="l00679"></a>00679                 }
<a name="l00680"></a>00680                 
<a name="l00681"></a>00681                 <span class="keyword">private</span> <span class="keyword">const</span> <span class="keywordtype">string</span> SORT_INDICATOR_UP_KEY = <span class="stringliteral">"sort-indicator-up"</span>;
<a name="l00682"></a>00682                 <span class="keyword">private</span> <span class="keyword">const</span> <span class="keywordtype">string</span> SORT_INDICATOR_DOWN_KEY = <span class="stringliteral">"sort-indicator-down"</span>;
<a name="l00683"></a>00683                 
<a name="l00687"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#834f0fa19b6f6b96b12ccfaa028537c9">00687</a>                 <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#834f0fa19b6f6b96b12ccfaa028537c9" title="If the sort indicator images don't already exist, this method will make and install...">MakeSortIndictorImages</a>()
<a name="l00688"></a>00688                 {
<a name="l00689"></a>00689                         <span class="comment">/*ImageList il = this.SmallImageList;</span>
<a name="l00690"></a>00690 <span class="comment">            if (il == null) {</span>
<a name="l00691"></a>00691 <span class="comment">                il = this.SmallImageList = new ImageList();</span>
<a name="l00692"></a>00692 <span class="comment">                il.ImageSize = new Size(16, 16);</span>
<a name="l00693"></a>00693 <span class="comment">            }</span>
<a name="l00694"></a>00694 <span class="comment"></span>
<a name="l00695"></a>00695 <span class="comment">                        // This arrangement of points works well with (16,16) images, and OK with others</span>
<a name="l00696"></a>00696 <span class="comment">                        int midX = il.ImageSize.Width / 2;</span>
<a name="l00697"></a>00697 <span class="comment">                        int midY = (il.ImageSize.Height / 2) - 1;</span>
<a name="l00698"></a>00698 <span class="comment">                        int deltaX = midX - 2;</span>
<a name="l00699"></a>00699 <span class="comment">                        int deltaY = deltaX / 2;</span>
<a name="l00700"></a>00700 <span class="comment"></span>
<a name="l00701"></a>00701 <span class="comment">                        if (il.Images.IndexOfKey(SORT_INDICATOR_UP_KEY) == -1) {</span>
<a name="l00702"></a>00702 <span class="comment">                                Point pt1 = new Point(midX - deltaX, midY + deltaY);</span>
<a name="l00703"></a>00703 <span class="comment">                                Point pt2 = new Point(midX,          midY - deltaY - 1);</span>
<a name="l00704"></a>00704 <span class="comment">                                Point pt3 = new Point(midX + deltaX, midY + deltaY);</span>
<a name="l00705"></a>00705 <span class="comment">                il.Images.Add(SORT_INDICATOR_UP_KEY, this.MakeTriangleBitmap(il.ImageSize, new Point[] { pt1, pt2, pt3 }));</span>
<a name="l00706"></a>00706 <span class="comment">            } </span>
<a name="l00707"></a>00707 <span class="comment">                        </span>
<a name="l00708"></a>00708 <span class="comment">                        if (il.Images.IndexOfKey(SORT_INDICATOR_DOWN_KEY) == -1) {</span>
<a name="l00709"></a>00709 <span class="comment">                                Point pt1 = new Point(midX - deltaX, midY - deltaY);</span>
<a name="l00710"></a>00710 <span class="comment">                                Point pt2 = new Point(midX,          midY + deltaY);</span>
<a name="l00711"></a>00711 <span class="comment">                                Point pt3 = new Point(midX + deltaX, midY - deltaY);</span>
<a name="l00712"></a>00712 <span class="comment">                                il.Images.Add(SORT_INDICATOR_DOWN_KEY, this.MakeTriangleBitmap(il.ImageSize, new Point[] { pt1, pt2, pt3 }));</span>
<a name="l00713"></a>00713 <span class="comment">                        }*/</span>
<a name="l00714"></a>00714                 }
<a name="l00715"></a>00715 
<a name="l00716"></a>00716         <span class="keyword">private</span> Bitmap MakeTriangleBitmap(Size sz, Point[] pts)
<a name="l00717"></a>00717         {
<a name="l00718"></a>00718             Bitmap bm = <span class="keyword">new</span> Bitmap(sz.Width, sz.Height);
<a name="l00719"></a>00719             Graphics g = Graphics.FromImage(bm);
<a name="l00720"></a>00720             g.FillPolygon(<span class="keyword">new</span> SolidBrush(Color.Gray), pts);
<a name="l00721"></a>00721             <span class="keywordflow">return</span> bm;
<a name="l00722"></a>00722         }
<a name="l00723"></a>00723 
<a name="l00724"></a>00724 <span class="preprocessor">        #endregion</span>
<a name="l00725"></a>00725 <span class="preprocessor"></span>
<a name="l00726"></a>00726 <span class="preprocessor">        #region Utilities</span>
<a name="l00727"></a>00727 <span class="preprocessor"></span>
<a name="l00733"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#344bf7520f86628fc53eaefe64af407e">00733</a>                 <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#344bf7520f86628fc53eaefe64af407e" title="the model object from which values will be taken">FillInValues</a>(<a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_item.html">OLVListItem</a> lvi, <span class="keywordtype">object</span> rowObject)
<a name="l00734"></a>00734                 {
<a name="l00735"></a>00735                         <span class="keywordflow">if</span> (<span class="keyword">this</span>.<a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#e3f66b968ce5c1b2312f93ccece030e5" title="Return Columns for this list. We hide the original so we can associate a specialised...">Columns</a>.Count == 0)
<a name="l00736"></a>00736                                 <span class="keywordflow">return</span>;
<a name="l00737"></a>00737 
<a name="l00738"></a>00738                         <a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html" title="An OLVColumn knows which aspect of an object it should present.">OLVColumn</a> column = (<a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html" title="An OLVColumn knows which aspect of an object it should present.">OLVColumn</a>)<span class="keyword">this</span>.<a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#e3f66b968ce5c1b2312f93ccece030e5" title="Return Columns for this list. We hide the original so we can associate a specialised...">Columns</a>[0];
<a name="l00739"></a>00739                         lvi.Text = column.<a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html#49bf2fcc5a5f3548e2398b533c6dd254">GetStringValue</a>(rowObject);
<a name="l00740"></a>00740             lvi.<a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_item.html#975879f9694860b3ce77eae80ce8385b" title="Get or set the image that should be shown against this item.">ImageSelector</a> = column.<a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html#4d5455ddb2946f8f675467512545fe6c" title="For a given row object, return the image selector of the image that should displayed...">GetImage</a>(rowObject);
<a name="l00741"></a>00741 
<a name="l00742"></a>00742                         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=1; i&lt;<span class="keyword">this</span>.Columns.Count; i++)
<a name="l00743"></a>00743                         {
<a name="l00744"></a>00744                                 column = (<a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html" title="An OLVColumn knows which aspect of an object it should present.">OLVColumn</a>)<span class="keyword">this</span>.<a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#e3f66b968ce5c1b2312f93ccece030e5" title="Return Columns for this list. We hide the original so we can associate a specialised...">Columns</a>[i];
<a name="l00745"></a>00745                                 lvi.SubItems.Add(<span class="keyword">new</span> <a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_sub_item.html" title="A ListViewSubItem that knows which image should be drawn against it.">OLVListSubItem</a>(column.<a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html#49bf2fcc5a5f3548e2398b533c6dd254">GetStringValue</a>(rowObject),
<a name="l00746"></a>00746                                                                     column.<a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html#4d5455ddb2946f8f675467512545fe6c" title="For a given row object, return the image selector of the image that should displayed...">GetImage</a>(rowObject)));
<a name="l00747"></a>00747                         }
<a name="l00748"></a>00748                 }
<a name="l00749"></a>00749                 
<a name="l00753"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#3f35157dd33f94328468bcf08651a5b0">00753</a>                 <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#3f35157dd33f94328468bcf08651a5b0" title="Setup all subitem images on all rows.">SetAllSubItemImages</a>()
<a name="l00754"></a>00754                 {
<a name="l00755"></a>00755                         <span class="keywordflow">if</span> (!<span class="keyword">this</span>.<a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#6c764ee6853bee5553f8a71457653ed3" title="Should the list view show images on subitems?">ShowImagesOnSubItems</a> || <span class="keyword">this</span>.OwnerDraw)
<a name="l00756"></a>00756                                 <span class="keywordflow">return</span>;
<a name="l00757"></a>00757                         
<a name="l00758"></a>00758                         <span class="keyword">this</span>.ForceSubItemImagesExStyle();
<a name="l00759"></a>00759 
<a name="l00760"></a>00760                         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> rowIndex=0; rowIndex&lt;<span class="keyword">this</span>.Items.Count; rowIndex++)
<a name="l00761"></a>00761                                 <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#f6cd253d67be15705ebf019167ef9f33" title="we draw the images ourself.">SetSubItemImages</a>(rowIndex, (<a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_item.html">OLVListItem</a>)<span class="keyword">this</span>.Items[rowIndex]);
<a name="l00762"></a>00762                 }
<a name="l00763"></a>00763                 
<a name="l00771"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#f6cd253d67be15705ebf019167ef9f33">00771</a>                 <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#f6cd253d67be15705ebf019167ef9f33" title="we draw the images ourself.">SetSubItemImages</a>(<span class="keywordtype">int</span> rowIndex, <a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_item.html">OLVListItem</a> item)
<a name="l00772"></a>00772                 {
<a name="l00773"></a>00773                         <span class="keywordflow">if</span> (!<span class="keyword">this</span>.<a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#6c764ee6853bee5553f8a71457653ed3" title="Should the list view show images on subitems?">ShowImagesOnSubItems</a> || <span class="keyword">this</span>.OwnerDraw)
<a name="l00774"></a>00774                                 <span class="keywordflow">return</span>;
<a name="l00775"></a>00775                         
<a name="l00776"></a>00776                         <span class="keywordtype">int</span> imageIndex;
<a name="l00777"></a>00777                         
<a name="l00778"></a>00778                         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=1; i&lt;item.SubItems.Count; i++)
<a name="l00779"></a>00779                         {
<a name="l00780"></a>00780                                 imageIndex = <span class="keyword">this</span>.<a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#cbe0b6a6c23c33f2736b1bf76e4b478c" title="Convert the given image selector to an index into our image list. Return -1 if that's...">GetActualImageIndex</a>(((<a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_sub_item.html" title="A ListViewSubItem that knows which image should be drawn against it.">OLVListSubItem</a>)item.SubItems[i]).ImageSelector);
<a name="l00781"></a>00781                                 if (imageIndex != -1)
<a name="l00782"></a>00782                                         <span class="keyword">this</span>.<a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#bcad6e48c25c47b18dc52f469293ccce" title="For the given item and subitem, make it display the given image.">SetSubItemImage</a>(rowIndex, i, imageIndex);
<a name="l00783"></a>00783                         }
<a name="l00784"></a>00784                 }
<a name="l00785"></a>00785 
<a name="l00795"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#bd2c599254aa195905199c28da8df580">00795</a>                 <span class="keyword">virtual</span> <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#bd2c599254aa195905199c28da8df580">PrepareAlternateBackColors</a> ()
<a name="l00796"></a>00796                 {
<a name="l00797"></a>00797                         Color rowBackColor = <span class="keyword">this</span>.AlternateRowBackColorOrDefault;
<a name="l00798"></a>00798 
<a name="l00799"></a>00799                         <span class="keywordflow">if</span> (<span class="keyword">this</span>.ShowGroups) {
<a name="l00800"></a>00800                                 <span class="keywordtype">int</span> i = 0;
<a name="l00801"></a>00801                                 <span class="keywordflow">foreach</span> (ListViewGroup group <span class="keywordflow">in</span> <span class="keyword">this</span>.Groups) {
<a name="l00802"></a>00802                                         <span class="keywordflow">foreach</span> (ListViewItem lvi <span class="keywordflow">in</span> group.Items) {
<a name="l00803"></a>00803                                                 <span class="keywordflow">if</span> (i % 2 == 0)
<a name="l00804"></a>00804                                                         lvi.BackColor = <span class="keyword">this</span>.BackColor;
<a name="l00805"></a>00805                                                 <span class="keywordflow">else</span>
<a name="l00806"></a>00806                                                         lvi.BackColor = rowBackColor;
<a name="l00807"></a>00807                                                 i++;
<a name="l00808"></a>00808                                         }
<a name="l00809"></a>00809                                 }
<a name="l00810"></a>00810                         } <span class="keywordflow">else</span> {
<a name="l00811"></a>00811                                 <span class="keywordflow">foreach</span> (ListViewItem lvi <span class="keywordflow">in</span> <span class="keyword">this</span>.Items)
<a name="l00812"></a>00812                                 {
<a name="l00813"></a>00813                                         <span class="keywordflow">if</span> (lvi.Index % 2 == 0)
<a name="l00814"></a>00814                                                 lvi.BackColor = <span class="keyword">this</span>.BackColor;
<a name="l00815"></a>00815                                         <span class="keywordflow">else</span>
<a name="l00816"></a>00816                                                 lvi.BackColor = rowBackColor;
<a name="l00817"></a>00817                                 }
<a name="l00818"></a>00818                         }
<a name="l00819"></a>00819         }
<a name="l00820"></a>00820         
<a name="l00827"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#cbe0b6a6c23c33f2736b1bf76e4b478c">00827</a>         <span class="keyword">public</span> <span class="keywordtype">int</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#cbe0b6a6c23c33f2736b1bf76e4b478c" title="Convert the given image selector to an index into our image list. Return -1 if that's...">GetActualImageIndex</a>(Object imageSelector)
<a name="l00828"></a>00828         {
<a name="l00829"></a>00829                 <span class="keywordflow">if</span> (imageSelector == null)
<a name="l00830"></a>00830                         <span class="keywordflow">return</span> -1;
<a name="l00831"></a>00831                 
<a name="l00832"></a>00832                 <span class="keywordflow">if</span> (imageSelector is Int32)
<a name="l00833"></a>00833                         <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)imageSelector;
<a name="l00834"></a>00834  
<a name="l00835"></a>00835                 <span class="keywordflow">if</span> (imageSelector is String &amp;&amp; <span class="keyword">this</span>.SmallImageList != null)
<a name="l00836"></a>00836                         <span class="keywordflow">return</span> <span class="keyword">this</span>.SmallImageList.Images.IndexOfKey((String)imageSelector);
<a name="l00837"></a>00837                 
<a name="l00838"></a>00838                 <span class="keywordflow">return</span> -1;
<a name="l00839"></a>00839         }               
<a name="l00840"></a>00840         
<a name="l00846"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#5434c254f52fab6dfe3df2ae85c1fa9c">00846</a>                 <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#5434c254f52fab6dfe3df2ae85c1fa9c" title="Make sure the ListView has the extended style that says to display subitem images...">ForceSubItemImagesExStyle</a> ()
<a name="l00847"></a>00847                 {
<a name="l00848"></a>00848                         <a class="code" href="class_bright_ideas_software_1_1_list_view_native.html" title="Wrapper for all native method calls on ListView controls.">ListViewNative</a>.ForceSubItemImagesExStyle(<span class="keyword">this</span>);
<a name="l00849"></a>00849                 }
<a name="l00850"></a>00850 
<a name="l00857"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#bcad6e48c25c47b18dc52f469293ccce">00857</a>                 <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#bcad6e48c25c47b18dc52f469293ccce" title="For the given item and subitem, make it display the given image.">SetSubItemImage</a>(<span class="keywordtype">int</span> itemIndex, <span class="keywordtype">int</span> subItemIndex, <span class="keywordtype">int</span> imageIndex)
<a name="l00858"></a>00858                 {
<a name="l00859"></a>00859                         <a class="code" href="class_bright_ideas_software_1_1_list_view_native.html" title="Wrapper for all native method calls on ListView controls.">ListViewNative</a>.SetSubItemImage(<span class="keyword">this</span>, itemIndex, subItemIndex, imageIndex);
<a name="l00860"></a>00860                 }
<a name="l00861"></a>00861                 
<a name="l00862"></a>00862 <span class="preprocessor">                #endregion</span>
<a name="l00863"></a>00863 <span class="preprocessor"></span>
<a name="l00864"></a>00864 <span class="preprocessor">        #region ISupportInitialize Members</span>
<a name="l00865"></a>00865 <span class="preprocessor"></span>
<a name="l00866"></a>00866         <span class="keywordtype">void</span> ISupportInitialize.BeginInit()
<a name="l00867"></a>00867         {
<a name="l00868"></a>00868             <span class="keyword">this</span>.Frozen = <span class="keyword">true</span>;
<a name="l00869"></a>00869         }
<a name="l00870"></a>00870 
<a name="l00871"></a>00871         <span class="keywordtype">void</span> ISupportInitialize.EndInit()
<a name="l00872"></a>00872         {
<a name="l00873"></a>00873             <span class="keyword">this</span>.Frozen = <span class="keyword">false</span>;
<a name="l00874"></a>00874             <span class="keyword">this</span>.MakeSortIndictorImages();
<a name="l00875"></a>00875         }
<a name="l00876"></a>00876 
<a name="l00877"></a>00877 <span class="preprocessor">        #endregion</span>
<a name="l00878"></a>00878 <span class="preprocessor"></span>
<a name="l00879"></a>00879 <span class="preprocessor">        #region Owner drawing</span>
<a name="l00880"></a>00880 <span class="preprocessor"></span>
<a name="l00885"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#887d1ee0f74ecafceeeba39e62c7fbf7">00885</a>         <span class="keyword">protected</span> <span class="keyword">override</span> <span class="keywordtype">void</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#887d1ee0f74ecafceeeba39e62c7fbf7" title="Owner draw the column header.">OnDrawColumnHeader</a>(DrawListViewColumnHeaderEventArgs e)
<a name="l00886"></a>00886         {
<a name="l00887"></a>00887             e.DrawDefault = <span class="keyword">true</span>;
<a name="l00888"></a>00888             base.OnDrawColumnHeader(e);
<a name="l00889"></a>00889         }
<a name="l00890"></a>00890 
<a name="l00895"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#2d5026b1bcd14e9892a72b74af13c19b">00895</a>         <span class="keyword">protected</span> <span class="keyword">override</span> <span class="keywordtype">void</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#2d5026b1bcd14e9892a72b74af13c19b" title="Owner draw the item.">OnDrawItem</a>(DrawListViewItemEventArgs e)
<a name="l00896"></a>00896         {
<a name="l00897"></a>00897             e.DrawDefault = (<span class="keyword">this</span>.View != <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#7a53c04bb51af50234d687c01df2dc5e" title="Get/set the style of view that this listview is using.">View</a>.Details);   
<a name="l00898"></a>00898             base.OnDrawItem(e);
<a name="l00899"></a>00899         }
<a name="l00900"></a>00900 
<a name="l00901"></a>00901         <span class="keywordtype">int</span>[] columnRightEdge = <span class="keyword">new</span> <span class="keywordtype">int</span>[128]; <span class="comment">// will anyone ever want more than 128 columns??</span>
<a name="l00902"></a>00902 
<a name="l00907"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#46c0ab21285887813cb68c8c72809a40">00907</a>         <span class="keyword">protected</span> <span class="keyword">override</span> <span class="keywordtype">void</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#46c0ab21285887813cb68c8c72809a40" title="Owner draw a single subitem.">OnDrawSubItem</a>(DrawListViewSubItemEventArgs e)
<a name="l00908"></a>00908         {
<a name="l00909"></a>00909                 <span class="comment">// Get the special renderer for this column. </span>
<a name="l00910"></a>00910             <span class="comment">// If there isn't one, don't draw anything.</span>
<a name="l00911"></a>00911             <a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html" title="An OLVColumn knows which aspect of an object it should present.">OLVColumn</a> column = (<a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html" title="An OLVColumn knows which aspect of an object it should present.">OLVColumn</a>)<span class="keyword">this</span>.<a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#e3f66b968ce5c1b2312f93ccece030e5" title="Return Columns for this list. We hide the original so we can associate a specialised...">Columns</a>[e.ColumnIndex];
<a name="l00912"></a>00912             if (column.<a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html#01d571a7e66d6e10fb8193ce474b6533" title="This delegate is called when a cell needs to be drawn.">RendererDelegate</a> == null) 
<a name="l00913"></a>00913                 <span class="keywordflow">return</span>;
<a name="l00914"></a>00914             
<a name="l00915"></a>00915             <span class="comment">// Calculate where the subitem should be drawn</span>
<a name="l00916"></a>00916             <span class="comment">// It should be as simple as 'e.Bounds', but it isn't :-(</span>
<a name="l00917"></a>00917 
<a name="l00918"></a>00918             <span class="comment">// There seems to be a bug in .NET where the left edge of the bounds of subitem 0</span>
<a name="l00919"></a>00919             <span class="comment">// is always 0. This is normally what is required, but it's wrong when</span>
<a name="l00920"></a>00920             <span class="comment">// someone drags column 0 to somewhere else in the listview. We could</span>
<a name="l00921"></a>00921             <span class="comment">// drop down into Windows-ville and use LVM_GETSUBITEMRECT, but I'm specifically</span>
<a name="l00922"></a>00922             <span class="comment">// avoiding Windows dependencies -- Mono-ready, I guess.</span>
<a name="l00923"></a>00923             <span class="comment">// So, we keep track of the right edge of all columns, and when subitem 0</span>
<a name="l00924"></a>00924             <span class="comment">// isn't being shown at column 0, we make its left edge to be the right</span>
<a name="l00925"></a>00925             <span class="comment">// edge of the previous column plus a little bit.</span>
<a name="l00926"></a>00926             Rectangle r = e.Bounds;
<a name="l00927"></a>00927             <span class="keywordflow">if</span> (e.ColumnIndex == 0 &amp;&amp; e.Header.DisplayIndex != 0) {
<a name="l00928"></a>00928                 r.X = <span class="keyword">this</span>.columnRightEdge[e.Header.DisplayIndex - 1] + 1;
<a name="l00929"></a>00929             } <span class="keywordflow">else</span>
<a name="l00930"></a>00930                 <span class="comment">//TODO: Check the size of columnRightEdge and dynamically reallocate?</span>
<a name="l00931"></a>00931                 <span class="keyword">this</span>.columnRightEdge[e.Header.DisplayIndex] = e.Bounds.Right;
<a name="l00932"></a>00932 
<a name="l00933"></a>00933             <span class="comment">// Get a graphics context for the renderer to use. </span>
<a name="l00934"></a>00934             <span class="comment">// But we have more complications. Virtual lists have a nasty habit of drawing column 0</span>
<a name="l00935"></a>00935             <span class="comment">// whenever there is any mouse move events over a row, and doing it in an un-double buffered manner,</span>
<a name="l00936"></a>00936             <span class="comment">// which results in nasty flickers! There are also some unbuffered draw when a mouse is first</span>
<a name="l00937"></a>00937             <span class="comment">// hovered over column 0 of a normal row. So, to avoid all complications,</span>
<a name="l00938"></a>00938             <span class="comment">// we always manually double-buffer the drawing.</span>
<a name="l00939"></a>00939             Graphics g;
<a name="l00940"></a>00940             BufferedGraphics buffer = null;
<a name="l00941"></a>00941             <span class="keywordtype">bool</span> avoidFlickerMode = <span class="keyword">true</span>; <span class="comment">// set this to false to see the probems with flicker</span>
<a name="l00942"></a>00942             <span class="keywordflow">if</span> (avoidFlickerMode) {
<a name="l00943"></a>00943                 buffer = BufferedGraphicsManager.Current.Allocate(e.Graphics, r);
<a name="l00944"></a>00944                 g = buffer.Graphics;
<a name="l00945"></a>00945             } <span class="keywordflow">else</span>
<a name="l00946"></a>00946                 g = e.Graphics;
<a name="l00947"></a>00947 
<a name="l00948"></a>00948             <span class="comment">// Finally, give the renderer a chance to draw something</span>
<a name="l00949"></a>00949             Object row = ((<a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_item.html">OLVListItem</a>)e.Item).RowObject;
<a name="l00950"></a>00950             column.<a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html#01d571a7e66d6e10fb8193ce474b6533" title="This delegate is called when a cell needs to be drawn.">RendererDelegate</a>(e, g, r, row);
<a name="l00951"></a>00951 
<a name="l00952"></a>00952             <span class="keywordflow">if</span> (buffer != null) {
<a name="l00953"></a>00953                 buffer.Render();
<a name="l00954"></a>00954                 buffer.Dispose();
<a name="l00955"></a>00955             }
<a name="l00956"></a>00956         }
<a name="l00957"></a>00957 
<a name="l00958"></a>00958 <span class="preprocessor">        #endregion</span>
<a name="l00959"></a>00959 <span class="preprocessor"></span>
<a name="l00960"></a>00960 <span class="preprocessor">                #region Design Time</span>
<a name="l00961"></a>00961 <span class="preprocessor"></span>
<a name="l00966"></a>00966                 <span class="keyword">internal</span> <span class="keyword">class </span>OLVColumnCollectionEditor : System.ComponentModel.Design.CollectionEditor
<a name="l00967"></a>00967                 {
<a name="l00968"></a>00968                         <span class="keyword">public</span> OLVColumnCollectionEditor(Type t)
<a name="l00969"></a>00969                                 : base(t)
<a name="l00970"></a>00970                         {
<a name="l00971"></a>00971                         }
<a name="l00972"></a>00972 
<a name="l00973"></a>00973                         <span class="keyword">protected</span> <span class="keyword">override</span> Type CreateCollectionItemType()
<a name="l00974"></a>00974                         {
<a name="l00975"></a>00975                                 <span class="keywordflow">return</span> typeof(OLVColumn);
<a name="l00976"></a>00976                         }
<a name="l00977"></a>00977                 }
<a name="l00978"></a>00978 
<a name="l00983"></a>00983                 [Editor(typeof(OLVColumnCollectionEditor), typeof(System.Drawing.Design.UITypeEditor))]
<a name="l00984"></a><a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#e3f66b968ce5c1b2312f93ccece030e5">00984</a>                 <span class="keyword">new</span> <span class="keyword">public</span> ListView.ColumnHeaderCollection <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#e3f66b968ce5c1b2312f93ccece030e5" title="Return Columns for this list. We hide the original so we can associate a specialised...">Columns</a> {
<a name="l00985"></a>00985                         <span class="keyword">get</span> {
<a name="l00986"></a>00986                                 <span class="keywordflow">return</span> base.Columns;
<a name="l00987"></a>00987                         }
<a name="l00988"></a>00988                 }
<a name="l00989"></a>00989 
<a name="l00990"></a>00990 <span class="preprocessor">                #endregion</span>
<a name="l00991"></a>00991 <span class="preprocessor"></span>
<a name="l00992"></a>00992                 <span class="keyword">private</span> IEnumerable     objects; <span class="comment">// the collection of objects on show</span>
<a name="l00993"></a>00993         <span class="keyword">private</span> <a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html" title="An OLVColumn knows which aspect of an object it should present.">OLVColumn</a> lastSortColumn; <span class="comment">// which column did we last sort by</span>
<a name="l00994"></a>00994                 <span class="keyword">private</span> <span class="keywordtype">bool</span> showImagesOnSubItems; <span class="comment">// should we try to show images on subitems?</span>
<a name="l00995"></a>00995                 <span class="keyword">private</span> SortOrder lastSortOrder; <span class="comment">// which direction did we last sort</span>
<a name="l00996"></a>00996                 <span class="keyword">private</span> <span class="keywordtype">bool</span> showItemCountOnGroups; <span class="comment">// should we show items count in group labels?</span>
<a name="l00997"></a>00997                 <span class="keyword">private</span> <span class="keywordtype">string</span> groupWithItemCountFormat; <span class="comment">// when a group title has an item count, how should the label be formatted?</span>
<a name="l00998"></a>00998                 <span class="keyword">private</span> <span class="keywordtype">bool</span> useAlternatingBackColors; <span class="comment">// should we use different colors for alternate lines?</span>
<a name="l00999"></a>00999                 <span class="keyword">private</span> Color alternateRowBackColor; <span class="comment">// what color background should alternate lines have?</span>
<a name="l01000"></a>01000         <span class="keyword">private</span> <a class="code" href="namespace_bright_ideas_software.html#352a0b9e936f8e478c6dfd97a988b718" title="These delegates are used to sort the listview in some custom fashion.">SortDelegate</a> customSorter; <span class="comment">// callback for handling custom sort by column processing</span>
<a name="l01001"></a>01001 
<a name="l01002"></a>01002     }
<a name="l01003"></a>01003 
<a name="l01007"></a><a class="code" href="class_bright_ideas_software_1_1_list_view_native.html">01007</a>     <span class="keyword">internal</span> <span class="keyword">class </span><a class="code" href="class_bright_ideas_software_1_1_list_view_native.html" title="Wrapper for all native method calls on ListView controls.">ListViewNative</a> {
<a name="l01008"></a>01008         
<a name="l01009"></a>01009                 <span class="keyword">private</span> <span class="keyword">const</span> <span class="keywordtype">int</span> LVM_SETEXTENDEDLISTVIEWSTYLE = 0x1000 + 54; <span class="comment">// LVM_FIRST + 54</span>
<a name="l01010"></a>01010                 <span class="keyword">private</span> <span class="keyword">const</span> <span class="keywordtype">int</span> LVM_SETITEM                  = 0x1000 + 76; <span class="comment">// LVM_FIRST + 76</span>
<a name="l01011"></a>01011                 <span class="keyword">private</span> <span class="keyword">const</span> <span class="keywordtype">int</span> LVM_GETCOLUMN                = 0x1000 + 95; <span class="comment">// LVM_FIRST + 95</span>
<a name="l01012"></a>01012                 <span class="keyword">private</span> <span class="keyword">const</span> <span class="keywordtype">int</span> LVM_SETCOLUMN                = 0x1000 + 96; <span class="comment">// LVM_FIRST + 96</span>
<a name="l01013"></a>01013                 <span class="keyword">private</span> <span class="keyword">const</span> <span class="keywordtype">int</span> LVS_EX_SUBITEMIMAGES         = 0x0002;
<a name="l01014"></a>01014                 
<a name="l01015"></a>01015                 <span class="keyword">private</span> <span class="keyword">const</span> <span class="keywordtype">int</span> LVIF_TEXT              = 0x0001;
<a name="l01016"></a>01016                 <span class="keyword">private</span> <span class="keyword">const</span> <span class="keywordtype">int</span> LVIF_IMAGE             = 0x0002;
<a name="l01017"></a>01017                 <span class="keyword">private</span> <span class="keyword">const</span> <span class="keywordtype">int</span> LVIF_PARAM             = 0x0004;
<a name="l01018"></a>01018                 <span class="keyword">private</span> <span class="keyword">const</span> <span class="keywordtype">int</span> LVIF_STATE             = 0x0008;
<a name="l01019"></a>01019                 <span class="keyword">private</span> <span class="keyword">const</span> <span class="keywordtype">int</span> LVIF_INDENT            = 0x0010;
<a name="l01020"></a>01020                 <span class="keyword">private</span> <span class="keyword">const</span> <span class="keywordtype">int</span> LVIF_NORECOMPUTE       = 0x0800;
<a name="l01021"></a>01021                 
<a name="l01022"></a>01022                 <span class="keyword">private</span> <span class="keyword">const</span> <span class="keywordtype">int</span> LVCF_FMT               = 0x0001;
<a name="l01023"></a>01023                 <span class="keyword">private</span> <span class="keyword">const</span> <span class="keywordtype">int</span> LVCF_WIDTH             = 0x0002;
<a name="l01024"></a>01024                 <span class="keyword">private</span> <span class="keyword">const</span> <span class="keywordtype">int</span> LVCF_TEXT              = 0x0004;
<a name="l01025"></a>01025                 <span class="keyword">private</span> <span class="keyword">const</span> <span class="keywordtype">int</span> LVCF_SUBITEM           = 0x0008;
<a name="l01026"></a>01026                 <span class="keyword">private</span> <span class="keyword">const</span> <span class="keywordtype">int</span> LVCF_IMAGE             = 0x0010;
<a name="l01027"></a>01027                 <span class="keyword">private</span> <span class="keyword">const</span> <span class="keywordtype">int</span> LVCF_ORDER             = 0x0020;
<a name="l01028"></a>01028                 <span class="keyword">private</span> <span class="keyword">const</span> <span class="keywordtype">int</span> LVCFMT_LEFT            = 0x0000;
<a name="l01029"></a>01029                 <span class="keyword">private</span> <span class="keyword">const</span> <span class="keywordtype">int</span> LVCFMT_RIGHT           = 0x0001;
<a name="l01030"></a>01030                 <span class="keyword">private</span> <span class="keyword">const</span> <span class="keywordtype">int</span> LVCFMT_CENTER          = 0x0002;
<a name="l01031"></a>01031                 <span class="keyword">private</span> <span class="keyword">const</span> <span class="keywordtype">int</span> LVCFMT_JUSTIFYMASK     = 0x0003;
<a name="l01032"></a>01032                 
<a name="l01033"></a>01033                 <span class="keyword">private</span> <span class="keyword">const</span> <span class="keywordtype">int</span> LVCFMT_IMAGE           = 0x0800;
<a name="l01034"></a>01034                 <span class="keyword">private</span> <span class="keyword">const</span> <span class="keywordtype">int</span> LVCFMT_BITMAP_ON_RIGHT = 0x1000;
<a name="l01035"></a>01035                 <span class="keyword">private</span> <span class="keyword">const</span> <span class="keywordtype">int</span> LVCFMT_COL_HAS_IMAGES  = 0x8000;
<a name="l01036"></a>01036 
<a name="l01037"></a>01037                 [StructLayout(LayoutKind.Sequential,CharSet=CharSet.Auto)]
<a name="l01038"></a>01038                 <span class="keyword">private</span> <span class="keyword">struct </span>LVITEM
<a name="l01039"></a>01039                 {
<a name="l01040"></a>01040                         <span class="keyword">public</span> <span class="keywordtype">int</span>     mask;
<a name="l01041"></a>01041                         <span class="keyword">public</span> <span class="keywordtype">int</span>     iItem;
<a name="l01042"></a>01042                         <span class="keyword">public</span> <span class="keywordtype">int</span>     iSubItem;
<a name="l01043"></a>01043                         <span class="keyword">public</span> <span class="keywordtype">int</span>     state;
<a name="l01044"></a>01044                         <span class="keyword">public</span> <span class="keywordtype">int</span>     stateMask;
<a name="l01045"></a>01045                         [MarshalAs(UnmanagedType.LPTStr)]
<a name="l01046"></a>01046                         <span class="keyword">public</span> <span class="keywordtype">string</span>  pszText;
<a name="l01047"></a>01047                         <span class="keyword">public</span> <span class="keywordtype">int</span>     cchTextMax;
<a name="l01048"></a>01048                         <span class="keyword">public</span> <span class="keywordtype">int</span>     iImage;
<a name="l01049"></a>01049                         <span class="keyword">public</span> <span class="keywordtype">int</span>     lParam;
<a name="l01050"></a>01050                         <span class="comment">// These are available in Common Controls &gt;= 0x0300</span>
<a name="l01051"></a>01051                         <span class="keyword">public</span> <span class="keywordtype">int</span>     iIndent;
<a name="l01052"></a>01052                         <span class="comment">// These are available in Common Controls &gt;= 0x056</span>
<a name="l01053"></a>01053                         <span class="keyword">public</span> <span class="keywordtype">int</span>     iGroupId;
<a name="l01054"></a>01054                         <span class="keyword">public</span> <span class="keywordtype">int</span>     cColumns;
<a name="l01055"></a>01055                         <span class="keyword">public</span> IntPtr  puColumns;
<a name="l01056"></a>01056                 };
<a name="l01057"></a>01057                 
<a name="l01058"></a>01058                 [StructLayout(LayoutKind.Sequential,CharSet=CharSet.Auto)]
<a name="l01059"></a>01059                 <span class="keyword">private</span> <span class="keyword">struct </span>LVCOLUMN 
<a name="l01060"></a>01060                 {
<a name="l01061"></a>01061                     <span class="keyword">public</span> <span class="keywordtype">int</span> mask; 
<a name="l01062"></a>01062                     <span class="keyword">public</span> <span class="keywordtype">int</span> fmt; 
<a name="l01063"></a>01063                     <span class="keyword">public</span> <span class="keywordtype">int</span> cx; 
<a name="l01064"></a>01064                         [MarshalAs(UnmanagedType.LPTStr)]
<a name="l01065"></a>01065                     <span class="keyword">public</span> <span class="keywordtype">string</span> pszText; 
<a name="l01066"></a>01066                     <span class="keyword">public</span> <span class="keywordtype">int</span> cchTextMax; 
<a name="l01067"></a>01067                     <span class="keyword">public</span> <span class="keywordtype">int</span> iSubItem; 
<a name="l01068"></a>01068                         <span class="comment">// These are available in Common Controls &gt;= 0x0300</span>
<a name="l01069"></a>01069                     <span class="keyword">public</span> <span class="keywordtype">int</span> iImage;
<a name="l01070"></a>01070                     <span class="keyword">public</span> <span class="keywordtype">int</span> iOrder;
<a name="l01071"></a>01071                 };
<a name="l01072"></a>01072 
<a name="l01073"></a>01073                 <span class="comment">// Three different imports of SendMessage: </span>
<a name="l01074"></a>01074                 <span class="comment">// 1) plain vanilla; </span>
<a name="l01075"></a>01075                 <span class="comment">// 2) passes a references to LVITEM</span>
<a name="l01076"></a>01076                 <span class="comment">// 3) passes a references to LVCOLUMN</span>
<a name="l01077"></a>01077                 [DllImport(<span class="stringliteral">"user32.dll"</span>, CharSet=CharSet.Auto)]
<a name="l01078"></a>01078                 <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> IntPtr SendMessage(IntPtr hWnd, <span class="keywordtype">int</span> msg, <span class="keywordtype">int</span> wParam, <span class="keywordtype">int</span> lParam);
<a name="l01079"></a>01079                 [DllImport(<span class="stringliteral">"user32.dll"</span>, EntryPoint=<span class="stringliteral">"SendMessage"</span>, CharSet=CharSet.Auto)]
<a name="l01080"></a>01080                 <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> IntPtr SendMessageLVItem(IntPtr hWnd, <span class="keywordtype">int</span> msg, <span class="keywordtype">int</span> wParam, ref LVITEM lvi);
<a name="l01081"></a>01081                 [DllImport(<span class="stringliteral">"user32.dll"</span>, EntryPoint=<span class="stringliteral">"SendMessage"</span>, CharSet=CharSet.Auto)]
<a name="l01082"></a>01082                 <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> IntPtr SendMessageLVColumn(IntPtr hWnd, <span class="keywordtype">int</span> msg, <span class="keywordtype">int</span> wParam, ref LVCOLUMN lvc);
<a name="l01083"></a>01083 
<a name="l01090"></a><a class="code" href="class_bright_ideas_software_1_1_list_view_native.html#401275d290ac48a641c4590162db55f1">01090</a>                 <span class="keyword">public</span> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#5434c254f52fab6dfe3df2ae85c1fa9c" title="Make sure the ListView has the extended style that says to display subitem images...">ForceSubItemImagesExStyle</a> (ListView list)
<a name="l01091"></a>01091                 {
<a name="l01092"></a>01092                         SendMessage(list.Handle, LVM_SETEXTENDEDLISTVIEWSTYLE, LVS_EX_SUBITEMIMAGES, LVS_EX_SUBITEMIMAGES);
<a name="l01093"></a>01093                 }
<a name="l01094"></a>01094 
<a name="l01102"></a><a class="code" href="class_bright_ideas_software_1_1_list_view_native.html#51ccfeda4f1ad9c1843053485e0e630f">01102</a>                 <span class="keyword">public</span> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#bcad6e48c25c47b18dc52f469293ccce" title="For the given item and subitem, make it display the given image.">SetSubItemImage</a>(ListView list, <span class="keywordtype">int</span> itemIndex, <span class="keywordtype">int</span> subItemIndex, <span class="keywordtype">int</span> imageIndex)
<a name="l01103"></a>01103                 {
<a name="l01104"></a>01104                         LVITEM lvItem = <span class="keyword">new</span> LVITEM();
<a name="l01105"></a>01105                         lvItem.mask = LVIF_IMAGE;
<a name="l01106"></a>01106                         lvItem.iItem = itemIndex;
<a name="l01107"></a>01107                         lvItem.iSubItem = subItemIndex;
<a name="l01108"></a>01108                         lvItem.iImage = imageIndex;
<a name="l01109"></a>01109                         SendMessageLVItem(list.Handle, LVM_SETITEM, 0, ref lvItem);
<a name="l01110"></a>01110                 }
<a name="l01111"></a>01111                 
<a name="l01119"></a><a class="code" href="class_bright_ideas_software_1_1_list_view_native.html#d25f2f17605749927a57849f7c9fce28">01119</a>                 <span class="keyword">public</span> <span class="keyword">static</span> <span class="keywordtype">void</span> SetColumnImage(ListView list, <span class="keywordtype">int</span> columnIndex, <span class="keywordtype">int</span> imageIndex)
<a name="l01120"></a>01120                 {
<a name="l01121"></a>01121                         <span class="comment">/*LVCOLUMN lvColumn = new LVCOLUMN();</span>
<a name="l01122"></a>01122 <span class="comment">                        </span>
<a name="l01123"></a>01123 <span class="comment">                        // Get the columns current format</span>
<a name="l01124"></a>01124 <span class="comment">                        lvColumn.mask = LVCF_FMT;</span>
<a name="l01125"></a>01125 <span class="comment">                        IntPtr result = SendMessageLVColumn(list.Handle, LVM_GETCOLUMN, columnIndex, ref lvColumn);</span>
<a name="l01126"></a>01126 <span class="comment">                        if (result.ToInt32() == 0)</span>
<a name="l01127"></a>01127 <span class="comment">                                return;</span>
<a name="l01128"></a>01128 <span class="comment">                        </span>
<a name="l01129"></a>01129 <span class="comment">                        // Tell it to show an image on the right, or remove it altogether</span>
<a name="l01130"></a>01130 <span class="comment">                        lvColumn.mask = LVCF_FMT | LVCF_IMAGE;</span>
<a name="l01131"></a>01131 <span class="comment">                        if (imageIndex == -1)</span>
<a name="l01132"></a>01132 <span class="comment">                                lvColumn.fmt &amp;= ~(LVCFMT_IMAGE | LVCFMT_BITMAP_ON_RIGHT);</span>
<a name="l01133"></a>01133 <span class="comment">                        else</span>
<a name="l01134"></a>01134 <span class="comment">                                lvColumn.fmt |= (LVCFMT_IMAGE | LVCFMT_BITMAP_ON_RIGHT);</span>
<a name="l01135"></a>01135 <span class="comment">                        lvColumn.iImage = imageIndex;</span>
<a name="l01136"></a>01136 <span class="comment">                        result = SendMessageLVColumn(list.Handle, LVM_SETCOLUMN, columnIndex, ref lvColumn);*/</span>
<a name="l01137"></a>01137                 }
<a name="l01138"></a>01138     }
<a name="l01139"></a>01139     
<a name="l01151"></a><a class="code" href="class_bright_ideas_software_1_1_virtual_object_list_view.html">01151</a>         <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="class_bright_ideas_software_1_1_virtual_object_list_view.html" title="A virtual object list view operates in virtual mode, that is, it only gets model...">VirtualObjectListView</a> : <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html" title="An object list displays 'aspects' of a collection of objects in a multi-column list...">ObjectListView</a>
<a name="l01152"></a>01152         {
<a name="l01156"></a><a class="code" href="class_bright_ideas_software_1_1_virtual_object_list_view.html#64e154d8135a7ea2759628b223a43270">01156</a>                 <span class="keyword">public</span> <a class="code" href="class_bright_ideas_software_1_1_virtual_object_list_view.html" title="A virtual object list view operates in virtual mode, that is, it only gets model...">VirtualObjectListView</a>()
<a name="l01157"></a>01157                         : base()
<a name="l01158"></a>01158                 {
<a name="l01159"></a>01159                         <span class="keyword">this</span>.VirtualMode = <span class="keyword">true</span>;
<a name="l01160"></a>01160                         <span class="keyword">this</span>.RetrieveVirtualItem += <span class="keyword">new</span> RetrieveVirtualItemEventHandler(<span class="keyword">this</span>.HandleRetrieveVirtualItem);
<a name="l01161"></a>01161 
<a name="l01162"></a>01162             <span class="comment">// Turn off sorting. Who wants to fetch and sort 10 million items?</span>
<a name="l01163"></a>01163             <span class="keyword">this</span>.CustomSorter = delegate(<a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html" title="An OLVColumn knows which aspect of an object it should present.">OLVColumn</a> column, SortOrder sortOrder) { };
<a name="l01164"></a>01164                 }
<a name="l01165"></a>01165 
<a name="l01166"></a>01166 <span class="preprocessor">                #region Public Properties</span>
<a name="l01167"></a>01167 <span class="preprocessor"></span>
<a name="l01171"></a><a class="code" href="class_bright_ideas_software_1_1_virtual_object_list_view.html#14abbe6e0900f35844d5333cdfc0c228">01171</a>                 <span class="keyword">public</span> <a class="code" href="namespace_bright_ideas_software.html#adf872dfb3bca25a857d4f33888e6229" title="These delegates are used to fetch a row object for virtual lists.">RowGetterDelegate</a> RowGetter {
<a name="l01172"></a>01172                         <span class="keyword">get</span> { <span class="keywordflow">return</span> rowGetter; }
<a name="l01173"></a>01173                         <span class="keyword">set</span> { rowGetter = value; }
<a name="l01174"></a>01174                 }
<a name="l01175"></a>01175 
<a name="l01176"></a>01176 <span class="preprocessor">                #endregion</span>
<a name="l01177"></a>01177 <span class="preprocessor"></span>
<a name="l01178"></a>01178 <span class="preprocessor">                #region Object manipulation</span>
<a name="l01179"></a>01179 <span class="preprocessor"></span>
<a name="l01184"></a><a class="code" href="class_bright_ideas_software_1_1_virtual_object_list_view.html#db80e7dd0c3241218739e62b9205a0a8">01184</a>                 <span class="keyword">override</span> <span class="keyword">public</span> <span class="keywordtype">object</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#0efb71d1a8e01de0ef468bf212c1c161" title="Return the model object of the row that is selected or null if there is no selection...">GetSelectedObject</a>()
<a name="l01185"></a>01185                 {
<a name="l01186"></a>01186                         <span class="keywordflow">if</span> (<span class="keyword">this</span>.SelectedIndices.Count == 1)
<a name="l01187"></a>01187                                 <span class="keywordflow">return</span> <span class="keyword">this</span>.GetRowObjectAt(<span class="keyword">this</span>.SelectedIndices[0]);
<a name="l01188"></a>01188                         <span class="keywordflow">else</span>
<a name="l01189"></a>01189                                 <span class="keywordflow">return</span> null;
<a name="l01190"></a>01190                 }
<a name="l01191"></a>01191 
<a name="l01196"></a><a class="code" href="class_bright_ideas_software_1_1_virtual_object_list_view.html#a1ce221257edb29b76c14cfd8aae69ca">01196</a>                 <span class="keyword">override</span> <span class="keyword">public</span> ArrayList <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#e242389ac3c1ffb4c2441a9bfb5378d1" title="Return the model objects of the rows that are selected or an empty collection if...">GetSelectedObjects</a>()
<a name="l01197"></a>01197                 {
<a name="l01198"></a>01198                         ArrayList objects = <span class="keyword">new</span> ArrayList(<span class="keyword">this</span>.SelectedIndices.Count);
<a name="l01199"></a>01199                         <span class="keywordflow">foreach</span> (<span class="keywordtype">int</span> index <span class="keywordflow">in</span> <span class="keyword">this</span>.SelectedIndices)
<a name="l01200"></a>01200                                 objects.Add(<span class="keyword">this</span>.GetRowObjectAt(index));
<a name="l01201"></a>01201 
<a name="l01202"></a>01202                         <span class="keywordflow">return</span> objects;
<a name="l01203"></a>01203                 }
<a name="l01204"></a>01204 
<a name="l01212"></a><a class="code" href="class_bright_ideas_software_1_1_virtual_object_list_view.html#76b0f7e8898329e4928c80890bf2d327">01212</a>                 <span class="keyword">override</span> <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#e92556b319c09900e15e25eb21c86614" title="Select the row that is displaying the given model object. All other rows are deselected...">SelectObject</a>(<span class="keywordtype">object</span> modelObject)
<a name="l01213"></a>01213                 {
<a name="l01214"></a>01214                         <span class="comment">// do nothing</span>
<a name="l01215"></a>01215                 }
<a name="l01216"></a>01216 
<a name="l01224"></a><a class="code" href="class_bright_ideas_software_1_1_virtual_object_list_view.html#c9e1d8507385cbb77f688b96013fa03b">01224</a>                 <span class="keyword">override</span> <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#a1f05a0624665beb31b4adac2ae55635" title="Select the rows that is displaying any of the given model object. All other rows...">SelectObjects</a>(IList modelObjects)
<a name="l01225"></a>01225                 {
<a name="l01226"></a>01226                         <span class="comment">// do nothing</span>
<a name="l01227"></a>01227                 }
<a name="l01228"></a>01228 
<a name="l01229"></a>01229 <span class="preprocessor">                #endregion</span>
<a name="l01230"></a>01230 <span class="preprocessor"></span>
<a name="l01236"></a><a class="code" href="class_bright_ideas_software_1_1_virtual_object_list_view.html#5552b562051f04185f0ecfd207edd276">01236</a>         <span class="keyword">protected</span> <span class="keyword">override</span> <span class="keywordtype">void</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#bd2c599254aa195905199c28da8df580">PrepareAlternateBackColors</a> ()
<a name="l01237"></a>01237                 {
<a name="l01238"></a>01238             <span class="comment">// do nothing</span>
<a name="l01239"></a>01239                 }
<a name="l01240"></a>01240 
<a name="l01241"></a>01241 <span class="preprocessor">                #region Event handlers</span>
<a name="l01242"></a>01242 <span class="preprocessor"></span>
<a name="l01248"></a><a class="code" href="class_bright_ideas_software_1_1_virtual_object_list_view.html#0c1f1082e59c2d6b95cef571e88a0307">01248</a>                 <span class="keyword">protected</span> <span class="keywordtype">void</span> HandleRetrieveVirtualItem(<span class="keywordtype">object</span> sender, RetrieveVirtualItemEventArgs e)
<a name="l01249"></a>01249                 {
<a name="l01250"></a>01250                         <span class="comment">// .NET 2.0 seems to generate a lot of these events. Before drawing *each* sub-item,</span>
<a name="l01251"></a>01251                         <span class="comment">// this event is triggered 4-8 times for the same index. So we save lots of CPU time</span>
<a name="l01252"></a>01252                         <span class="comment">// by caching the last result.</span>
<a name="l01253"></a>01253                         <span class="keywordflow">if</span> (<span class="keyword">this</span>.lastRetrieveVirtualItemIndex != e.ItemIndex) {
<a name="l01254"></a>01254                                 <span class="keyword">this</span>.lastRetrieveVirtualItemIndex = e.ItemIndex;
<a name="l01255"></a>01255                                 <span class="keyword">this</span>.lastRetrieveVirtualItem = <span class="keyword">this</span>.MakeListViewItem(e.ItemIndex);
<a name="l01256"></a>01256                         }
<a name="l01257"></a>01257                         e.Item = <span class="keyword">this</span>.lastRetrieveVirtualItem;
<a name="l01258"></a>01258                 }
<a name="l01259"></a>01259 
<a name="l01265"></a><a class="code" href="class_bright_ideas_software_1_1_virtual_object_list_view.html#e319ce9ce24d411844919dcb7536d695">01265</a>                 <span class="keyword">protected</span> <a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_item.html">OLVListItem</a> MakeListViewItem(<span class="keywordtype">int</span> itemIndex)
<a name="l01266"></a>01266                 {
<a name="l01267"></a>01267                         <a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_item.html">OLVListItem</a> olvi = <span class="keyword">new</span> <a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_item.html">OLVListItem</a>(<span class="keyword">this</span>.GetRowObjectAt(itemIndex));
<a name="l01268"></a>01268                         <span class="keyword">this</span>.FillInValues(olvi, olvi.<a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_item.html#8a7730d25aaaacd31ec03384c0ab3e50" title="RowObject is the model object that is source of the data for this list item.">RowObject</a>);
<a name="l01269"></a>01269             <span class="keywordflow">if</span> (<span class="keyword">this</span>.<a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#c4d0e05d0bbc6f4d1b2740e87a9d2279" title="Should the list give a different background color to every second row?">UseAlternatingBackColors</a> &amp;&amp; <span class="keyword">this</span>.<a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#7a53c04bb51af50234d687c01df2dc5e" title="Get/set the style of view that this listview is using.">View</a> == <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#7a53c04bb51af50234d687c01df2dc5e" title="Get/set the style of view that this listview is using.">View</a>.Details &amp;&amp; itemIndex % 2 == 1)
<a name="l01270"></a>01270                                 olvi.BackColor = <span class="keyword">this</span>.AlternateRowBackColorOrDefault;
<a name="l01271"></a>01271                         <span class="keywordflow">else</span>
<a name="l01272"></a>01272                                 olvi.BackColor = <span class="keyword">this</span>.BackColor;
<a name="l01273"></a>01273                         <span class="keyword">this</span>.SetSubItemImages(itemIndex, olvi);
<a name="l01274"></a>01274                         <span class="keywordflow">return</span> olvi;
<a name="l01275"></a>01275                 }
<a name="l01276"></a>01276 
<a name="l01282"></a><a class="code" href="class_bright_ideas_software_1_1_virtual_object_list_view.html#2c80e4673fb43b681dace0909a47a75f">01282</a>         <span class="keyword">protected</span> <span class="keywordtype">object</span> GetRowObjectAt(<span class="keywordtype">int</span> index)
<a name="l01283"></a>01283         {
<a name="l01284"></a>01284             <span class="keywordflow">if</span> (<span class="keyword">this</span>.RowGetter == null)
<a name="l01285"></a>01285                 <span class="keywordflow">return</span> null;
<a name="l01286"></a>01286             <span class="keywordflow">else</span>
<a name="l01287"></a>01287                 <span class="keywordflow">return</span> <span class="keyword">this</span>.RowGetter(index);
<a name="l01288"></a>01288         }
<a name="l01289"></a>01289 
<a name="l01290"></a>01290 <span class="preprocessor">                #endregion</span>
<a name="l01291"></a>01291 <span class="preprocessor"></span>
<a name="l01292"></a>01292 <span class="preprocessor">                #region Variable declaractions</span>
<a name="l01293"></a>01293 <span class="preprocessor"></span>
<a name="l01294"></a>01294                 <span class="keyword">private</span> <a class="code" href="namespace_bright_ideas_software.html#adf872dfb3bca25a857d4f33888e6229" title="These delegates are used to fetch a row object for virtual lists.">RowGetterDelegate</a> rowGetter;
<a name="l01295"></a>01295                 <span class="keyword">private</span> <span class="keywordtype">int</span> lastRetrieveVirtualItemIndex = -1;
<a name="l01296"></a>01296                 <span class="keyword">private</span> <a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_item.html">OLVListItem</a> lastRetrieveVirtualItem;
<a name="l01297"></a>01297 
<a name="l01298"></a>01298 <span class="preprocessor">                #endregion</span>
<a name="l01299"></a>01299 <span class="preprocessor"></span>        }
<a name="l01300"></a>01300 
<a name="l01311"></a><a class="code" href="class_bright_ideas_software_1_1_data_list_view.html">01311</a>         <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="class_bright_ideas_software_1_1_data_list_view.html" title="A DataListView is specialised to show the contents of a data source, which would...">DataListView</a> : <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html" title="An object list displays 'aspects' of a collection of objects in a multi-column list...">ObjectListView</a>
<a name="l01312"></a>01312         {
<a name="l01316"></a><a class="code" href="class_bright_ideas_software_1_1_data_list_view.html#a02da06f395fbfd2590d9e623ac2ba67">01316</a>                 <span class="keyword">public</span> <a class="code" href="class_bright_ideas_software_1_1_data_list_view.html" title="A DataListView is specialised to show the contents of a data source, which would...">DataListView</a>() : base ()
<a name="l01317"></a>01317                 {
<a name="l01318"></a>01318             <span class="keyword">this</span>.bindingSource = <span class="keyword">new</span> BindingSource();
<a name="l01319"></a>01319                         <span class="keyword">this</span>.bindingSource.ListChanged += <span class="keyword">new</span> ListChangedEventHandler(OnListChanged);
<a name="l01320"></a>01320                 }
<a name="l01321"></a>01321 
<a name="l01322"></a>01322 <span class="preprocessor">        #region Public Properties</span>
<a name="l01323"></a>01323 <span class="preprocessor"></span>
<a name="l01339"></a>01339         [Category(<span class="stringliteral">"Data"</span>),
<a name="l01340"></a>01340          RefreshProperties(RefreshProperties.Repaint),
<a name="l01341"></a>01341          DefaultValue((<span class="keywordtype">string</span>)null),
<a name="l01342"></a>01342          AttributeProvider(typeof(IListSource))]
<a name="l01343"></a>01343         <span class="keyword">public</span> Object DataSource
<a name="l01344"></a><a class="code" href="class_bright_ideas_software_1_1_data_list_view.html#be38e8ac49ec31df13bd5ab8b3c190a5">01344</a>         {
<a name="l01345"></a>01345             <span class="keyword">get</span> { <span class="keywordflow">return</span> dataSource; }
<a name="l01346"></a>01346             <span class="keyword">set</span> {
<a name="l01347"></a>01347                 <span class="keywordflow">if</span> (dataSource != value) {
<a name="l01348"></a>01348                     dataSource = value;
<a name="l01349"></a>01349                     <span class="keyword">this</span>.RebindDataSource(value);
<a name="l01350"></a>01350                 }
<a name="l01351"></a>01351             }
<a name="l01352"></a>01352         }
<a name="l01353"></a>01353         <span class="keyword">private</span> Object dataSource;
<a name="l01354"></a>01354         <span class="keyword">private</span> BindingSource bindingSource;
<a name="l01355"></a>01355 
<a name="l01360"></a>01360         [Category(<span class="stringliteral">"Data"</span>),
<a name="l01361"></a>01361          Editor(<span class="stringliteral">"System.Windows.Forms.Design.DataMemberListEditor, System.Design, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"</span>, typeof(UITypeEditor)),
<a name="l01362"></a>01362          DefaultValue(<span class="stringliteral">""</span>)]
<a name="l01363"></a>01363         <span class="keyword">public</span> <span class="keywordtype">string</span> DataMember
<a name="l01364"></a><a class="code" href="class_bright_ideas_software_1_1_data_list_view.html#0919e349bc3ee4249d7bfef48cf5ba96">01364</a>         {
<a name="l01365"></a>01365             <span class="keyword">get</span> { <span class="keywordflow">return</span> bindingSourceDataMember; }
<a name="l01366"></a>01366             <span class="keyword">set</span> {
<a name="l01367"></a>01367                 <span class="keywordflow">if</span> (bindingSourceDataMember != value) {
<a name="l01368"></a>01368                     bindingSourceDataMember = value;
<a name="l01369"></a>01369                     RebindDataSource(<span class="keyword">this</span>.bindingSource);
<a name="l01370"></a>01370                 }
<a name="l01371"></a>01371             }
<a name="l01372"></a>01372         }
<a name="l01373"></a>01373         <span class="keyword">private</span> <span class="keywordtype">string</span> bindingSourceDataMember = <span class="stringliteral">""</span>;
<a name="l01374"></a>01374 
<a name="l01375"></a>01375 <span class="preprocessor">        #endregion</span>
<a name="l01376"></a>01376 <span class="preprocessor"></span>
<a name="l01377"></a>01377 <span class="preprocessor">        #region Initialization</span>
<a name="l01378"></a>01378 <span class="preprocessor"></span>
<a name="l01383"></a><a class="code" href="class_bright_ideas_software_1_1_data_list_view.html#d202fef6615125816e5d5cd98842cd33">01383</a>         <span class="keyword">protected</span> <span class="keywordtype">void</span> RebindDataSource(Object newSource)
<a name="l01384"></a>01384         {
<a name="l01385"></a>01385             <span class="keywordflow">if</span> (<span class="keyword">this</span>.bindingSource != null)
<a name="l01386"></a>01386                 <span class="keyword">this</span>.bindingSource.ListChanged -= <span class="keyword">new</span> ListChangedEventHandler(OnListChanged);
<a name="l01387"></a>01387 
<a name="l01388"></a>01388             <span class="comment">// If the new source is a BindingSource, we keep a reference to it directly,</span>
<a name="l01389"></a>01389             <span class="comment">// otherwise we create a new BindingSource to wrap the given datasource.</span>
<a name="l01390"></a>01390             <span class="keywordflow">if</span> (newSource is BindingSource) {
<a name="l01391"></a>01391                 <span class="keyword">this</span>.bindingSource = (BindingSource)newSource;
<a name="l01392"></a>01392                 <span class="keywordflow">if</span> (!String.IsNullOrEmpty(<span class="keyword">this</span>.bindingSourceDataMember)) 
<a name="l01393"></a>01393                         <span class="keyword">this</span>.bindingSource.DataMember = <span class="keyword">this</span>.bindingSourceDataMember;
<a name="l01394"></a>01394             } <span class="keywordflow">else</span> {
<a name="l01395"></a>01395                 <span class="keywordflow">try</span> {
<a name="l01396"></a>01396                     <span class="keyword">this</span>.bindingSource = <span class="keyword">new</span> BindingSource(newSource, <span class="keyword">this</span>.bindingSourceDataMember);
<a name="l01397"></a>01397                 } <span class="keywordflow">catch</span> (ArgumentException) {
<a name="l01398"></a>01398                     <span class="keyword">this</span>.bindingSource = <span class="keyword">new</span> BindingSource(newSource, <span class="stringliteral">""</span>);
<a name="l01399"></a>01399                 }
<a name="l01400"></a>01400             }
<a name="l01401"></a>01401             <span class="keywordflow">if</span> (<span class="keyword">this</span>.bindingSource != null) {
<a name="l01402"></a>01402                 <span class="keyword">this</span>.bindingSource.ListChanged += <span class="keyword">new</span> ListChangedEventHandler(OnListChanged);
<a name="l01403"></a>01403             }
<a name="l01404"></a>01404             InitializeDataSource();
<a name="l01405"></a>01405         }
<a name="l01406"></a>01406 
<a name="l01410"></a><a class="code" href="class_bright_ideas_software_1_1_data_list_view.html#0cac18baa4f633f33649afd28800910c">01410</a>         <span class="keyword">protected</span> <span class="keywordtype">void</span> InitializeDataSource()
<a name="l01411"></a>01411         {
<a name="l01412"></a>01412             <span class="keywordflow">if</span> (<span class="keyword">this</span>.<a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#a602949c7e0c2425623a2d519e08b8ee" title="Get or set whether or not the listview is frozen. When the listview is frozen, it...">Frozen</a> || <span class="keyword">this</span>.bindingSource == null)
<a name="l01413"></a>01413                 <span class="keywordflow">return</span>;
<a name="l01414"></a>01414 
<a name="l01415"></a>01415             <span class="comment">// Can we figure out what our source of data is?</span>
<a name="l01416"></a>01416             Object sourceList = <span class="keyword">this</span>.bindingSource.List;
<a name="l01417"></a>01417 
<a name="l01418"></a>01418             <span class="comment">// If the source is a format we recognize, try to automatically configure the columns.</span>
<a name="l01419"></a>01419             <span class="comment">// If we don't recognize the source, remove our auto generated aspect getters, since they</span>
<a name="l01420"></a>01420             <span class="comment">// are certainly wrong.</span>
<a name="l01421"></a>01421             <span class="keywordflow">if</span> (sourceList is DataTable) {
<a name="l01422"></a>01422                 CreateColumnsFromDataTable((DataTable)sourceList);
<a name="l01423"></a>01423                 CreateMissingAspectGetters(<span class="keyword">false</span>);
<a name="l01424"></a>01424             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sourceList is DataView) {
<a name="l01425"></a>01425                 CreateColumnsFromDataTable(((DataView)sourceList).Table);
<a name="l01426"></a>01426                 CreateMissingAspectGetters(<span class="keyword">true</span>);
<a name="l01427"></a>01427             } <span class="keywordflow">else</span>
<a name="l01428"></a>01428                 RemoveAutoGeneratedAspectGetters();
<a name="l01429"></a>01429 
<a name="l01430"></a>01430             <span class="keyword">this</span>.SetObjects((IEnumerable)sourceList);
<a name="l01431"></a>01431         }
<a name="l01432"></a>01432 
<a name="l01436"></a><a class="code" href="class_bright_ideas_software_1_1_data_list_view.html#acabacd1e1704e719d84f5a2a48a445f">01436</a>         <span class="keyword">protected</span> <span class="keywordtype">void</span> CreateColumnsFromDataTable(DataTable table)
<a name="l01437"></a>01437         {
<a name="l01438"></a>01438             <span class="keywordflow">if</span> (table == null || <span class="keyword">this</span>.<a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#e3f66b968ce5c1b2312f93ccece030e5" title="Return Columns for this list. We hide the original so we can associate a specialised...">Columns</a>.Count != 0)
<a name="l01439"></a>01439                 <span class="keywordflow">return</span>;
<a name="l01440"></a>01440 
<a name="l01441"></a>01441             <span class="keywordflow">foreach</span> (DataColumn dataColumn <span class="keywordflow">in</span> table.Columns) {
<a name="l01442"></a>01442                 <a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html" title="An OLVColumn knows which aspect of an object it should present.">OLVColumn</a> column = <span class="keyword">new</span> <a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html" title="An OLVColumn knows which aspect of an object it should present.">OLVColumn</a>(dataColumn.Caption, dataColumn.ColumnName);
<a name="l01443"></a>01443                 <span class="keyword">this</span>.Columns.Add(column);
<a name="l01444"></a>01444                 <span class="keywordflow">if</span> (dataColumn.DataType == typeof(System.Byte[]))
<a name="l01445"></a>01445                     column.<a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html#f4b4ca1152ba4c3a486672ddf2203fa5" title="Get/set the renderer that will be invoked when a cell needs to be redrawn.">Renderer</a> = <span class="keyword">new</span> <a class="code" href="class_bright_ideas_software_1_1_image_renderer.html" title="Render an image that comes from our data source.">ImageRenderer</a>(); 
<a name="l01446"></a>01446             }
<a name="l01447"></a>01447         }
<a name="l01448"></a>01448 
<a name="l01453"></a><a class="code" href="class_bright_ideas_software_1_1_data_list_view.html#06438f5394163dda43c115ae443f287f">01453</a>         <span class="keyword">protected</span> <span class="keywordtype">void</span> CreateMissingAspectGetters(<span class="keywordtype">bool</span> isForDataView)
<a name="l01454"></a>01454         {
<a name="l01455"></a>01455             <span class="keywordflow">foreach</span> (ColumnHeader ch <span class="keywordflow">in</span> <span class="keyword">this</span>.<a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#e3f66b968ce5c1b2312f93ccece030e5" title="Return Columns for this list. We hide the original so we can associate a specialised...">Columns</a>) {
<a name="l01456"></a>01456                 <a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html" title="An OLVColumn knows which aspect of an object it should present.">OLVColumn</a> column = (<a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html" title="An OLVColumn knows which aspect of an object it should present.">OLVColumn</a>)ch;
<a name="l01457"></a>01457                 <span class="keywordflow">if</span> ((column.<a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html#2a5cf23b0f04b0ccd2dcf438310f120e" title="This delegate will be used to extract a value to be displayed in this column.">AspectGetter</a> == null || column.<a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html#196800a6674185cb18488c1953391326" title="Remember if this aspect getter for this column was generated internally, and can...">AspectGetterAutoGenerated</a>) &amp;&amp; !String.IsNullOrEmpty(column.<a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html#8ea92f66198cfeab8f7a145b15c3595c" title="The name of the property or method that should be called to get the value to display...">AspectName</a>))
<a name="l01458"></a>01458                     CreateAspectGetter(column, isForDataView);
<a name="l01459"></a>01459             }
<a name="l01460"></a>01460         }
<a name="l01461"></a>01461 
<a name="l01468"></a><a class="code" href="class_bright_ideas_software_1_1_data_list_view.html#ee055927f855b3c2242957ac977d16a9">01468</a>         <span class="keyword">protected</span> <span class="keywordtype">void</span> CreateAspectGetter(<a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html" title="An OLVColumn knows which aspect of an object it should present.">OLVColumn</a> column, <span class="keywordtype">bool</span> isForDataView)
<a name="l01469"></a>01469         {
<a name="l01470"></a>01470                 <span class="keywordflow">if</span> (isForDataView) {
<a name="l01471"></a>01471                 column.<a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html#2a5cf23b0f04b0ccd2dcf438310f120e" title="This delegate will be used to extract a value to be displayed in this column.">AspectGetter</a> = delegate(<span class="keywordtype">object</span> row) {
<a name="l01472"></a>01472                     <span class="keywordflow">try</span> {
<a name="l01473"></a>01473                         <span class="keywordflow">return</span> ((DataRowView)row)[column.<a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html#8ea92f66198cfeab8f7a145b15c3595c" title="The name of the property or method that should be called to get the value to display...">AspectName</a>];
<a name="l01474"></a>01474                     } <span class="keywordflow">catch</span> (ArgumentException) {
<a name="l01475"></a>01475                         <span class="keywordflow">return</span> String.Format(<span class="stringliteral">"No data column '{0}'"</span>, column.<a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html#8ea92f66198cfeab8f7a145b15c3595c" title="The name of the property or method that should be called to get the value to display...">AspectName</a>);
<a name="l01476"></a>01476                     }
<a name="l01477"></a>01477                 };
<a name="l01478"></a>01478             } <span class="keywordflow">else</span> {
<a name="l01479"></a>01479                 column.<a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html#2a5cf23b0f04b0ccd2dcf438310f120e" title="This delegate will be used to extract a value to be displayed in this column.">AspectGetter</a> = delegate(<span class="keywordtype">object</span> row) {
<a name="l01480"></a>01480                     <span class="keywordflow">try</span> {
<a name="l01481"></a>01481                         <span class="keywordflow">return</span> ((DataRow)row)[column.<a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html#8ea92f66198cfeab8f7a145b15c3595c" title="The name of the property or method that should be called to get the value to display...">AspectName</a>];
<a name="l01482"></a>01482                     } <span class="keywordflow">catch</span> (ArgumentException) {
<a name="l01483"></a>01483                         <span class="keywordflow">return</span> String.Format(<span class="stringliteral">"No data column '{0}'"</span>, column.<a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html#8ea92f66198cfeab8f7a145b15c3595c" title="The name of the property or method that should be called to get the value to display...">AspectName</a>);
<a name="l01484"></a>01484                     }
<a name="l01485"></a>01485                 };
<a name="l01486"></a>01486             }
<a name="l01487"></a>01487                 column.<a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html#196800a6674185cb18488c1953391326" title="Remember if this aspect getter for this column was generated internally, and can...">AspectGetterAutoGenerated</a> = <span class="keyword">true</span>;
<a name="l01488"></a>01488         }
<a name="l01489"></a>01489 
<a name="l01493"></a><a class="code" href="class_bright_ideas_software_1_1_data_list_view.html#e68347295ac35ecb4de301fd522aaa9b">01493</a>         <span class="keyword">protected</span> <span class="keywordtype">void</span> RemoveAutoGeneratedAspectGetters()
<a name="l01494"></a>01494         {
<a name="l01495"></a>01495             <span class="keywordflow">foreach</span> (ColumnHeader ch <span class="keywordflow">in</span> <span class="keyword">this</span>.<a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#e3f66b968ce5c1b2312f93ccece030e5" title="Return Columns for this list. We hide the original so we can associate a specialised...">Columns</a>) {
<a name="l01496"></a>01496                 <a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html" title="An OLVColumn knows which aspect of an object it should present.">OLVColumn</a> column = (<a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html" title="An OLVColumn knows which aspect of an object it should present.">OLVColumn</a>)ch;
<a name="l01497"></a>01497                 <span class="keywordflow">if</span> (column.<a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html#196800a6674185cb18488c1953391326" title="Remember if this aspect getter for this column was generated internally, and can...">AspectGetterAutoGenerated</a>)
<a name="l01498"></a>01498                     column.<a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html#2a5cf23b0f04b0ccd2dcf438310f120e" title="This delegate will be used to extract a value to be displayed in this column.">AspectGetter</a> = null;
<a name="l01499"></a>01499             }
<a name="l01500"></a>01500         }
<a name="l01501"></a>01501 
<a name="l01502"></a>01502 <span class="preprocessor">        #endregion</span>
<a name="l01503"></a>01503 <span class="preprocessor"></span>
<a name="l01504"></a>01504 <span class="preprocessor">        #region Event Handlers</span>
<a name="l01505"></a>01505 <span class="preprocessor"></span>
<a name="l01509"></a><a class="code" href="class_bright_ideas_software_1_1_data_list_view.html#de5c0d34438c8cc4f63960d0fb22db4b">01509</a>         <span class="keyword">protected</span> <span class="keywordtype">void</span> OnListChanged(<span class="keywordtype">object</span> sender, ListChangedEventArgs args)
<a name="l01510"></a>01510                 {
<a name="l01511"></a>01511             <span class="keywordflow">if</span> (<span class="keyword">this</span>.<a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#a602949c7e0c2425623a2d519e08b8ee" title="Get or set whether or not the listview is frozen. When the listview is frozen, it...">Frozen</a> ||
<a name="l01512"></a>01512                 args.ListChangedType == ListChangedType.PropertyDescriptorAdded ||
<a name="l01513"></a>01513                 args.ListChangedType == ListChangedType.PropertyDescriptorChanged ||
<a name="l01514"></a>01514                 args.ListChangedType == ListChangedType.PropertyDescriptorDeleted)
<a name="l01515"></a>01515                         <span class="keywordflow">return</span>;
<a name="l01516"></a>01516 
<a name="l01517"></a>01517                 <span class="keywordflow">if</span> (args.ListChangedType == ListChangedType.Reset)
<a name="l01518"></a>01518                         <span class="keyword">this</span>.InitializeDataSource();
<a name="l01519"></a>01519                 <span class="keywordflow">else</span>
<a name="l01520"></a>01520                 <span class="keyword">this</span>.SetObjects(<span class="keyword">this</span>.bindingSource.List);
<a name="l01521"></a>01521                 }
<a name="l01522"></a>01522 
<a name="l01526"></a><a class="code" href="class_bright_ideas_software_1_1_data_list_view.html#d97f3f7b8aff0d21d5c3d87e709d3006">01526</a>         <span class="keyword">override</span> <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html#cd4555556e0077f3a5bb543ccfc20d71" title="Do the actual work required when the listview is unfrozen.">DoUnfreeze</a>()
<a name="l01527"></a>01527         {
<a name="l01528"></a>01528             InitializeDataSource();
<a name="l01529"></a>01529         }
<a name="l01530"></a>01530 
<a name="l01531"></a>01531 <span class="preprocessor">                #endregion</span>
<a name="l01532"></a>01532 <span class="preprocessor"></span>
<a name="l01533"></a>01533         }
<a name="l01534"></a>01534 
<a name="l01535"></a>01535 <span class="preprocessor">        #region Delegate declarations</span>
<a name="l01536"></a>01536 <span class="preprocessor"></span>
<a name="l01540"></a>01540         <span class="keyword">public</span> delegate <span class="keywordtype">object</span> <a class="code" href="namespace_bright_ideas_software.html#08781fbab2ebaf9948bfa74cd4542d56" title="These delegates are used to extract an aspect from a row object.">AspectGetterDelegate</a>(<span class="keywordtype">object</span> rowObject);
<a name="l01541"></a>01541 
<a name="l01546"></a>01546         <span class="keyword">public</span> delegate Object <a class="code" href="namespace_bright_ideas_software.html#223f34ec2cbe7a76b8aee34cb3b1052d">ImageGetterDelegate</a>(<span class="keywordtype">object</span> rowObject);
<a name="l01547"></a>01547 
<a name="l01552"></a>01552         <span class="keyword">public</span> delegate <span class="keywordtype">string</span> <a class="code" href="namespace_bright_ideas_software.html#fce02ac178d6ae8bfcceb5463b7dfd9a" title="These delegates can be used to convert an aspect value to a display string, instead...">AspectToStringConverterDelegate</a>(<span class="keywordtype">object</span> value);
<a name="l01553"></a>01553 
<a name="l01557"></a>01557         <span class="keyword">public</span> delegate <span class="keywordtype">object</span> <a class="code" href="namespace_bright_ideas_software.html#c9d897e0474be185e67caa067773a4ec" title="These delegates are used to retrieve the object that is the key of the group to which...">GroupKeyGetterDelegate</a>(<span class="keywordtype">object</span> rowObject);
<a name="l01558"></a>01558 
<a name="l01562"></a>01562         <span class="keyword">public</span> delegate <span class="keywordtype">string</span> <a class="code" href="namespace_bright_ideas_software.html#f7db3c16e2854fb8133a675c8e879a68" title="These delegates are used to convert a group key into a title for the group.">GroupKeyToTitleConverterDelegate</a>(<span class="keywordtype">object</span> groupKey);
<a name="l01563"></a>01563 
<a name="l01567"></a>01567         <span class="keyword">public</span> delegate <span class="keywordtype">object</span> <a class="code" href="namespace_bright_ideas_software.html#adf872dfb3bca25a857d4f33888e6229" title="These delegates are used to fetch a row object for virtual lists.">RowGetterDelegate</a>(<span class="keywordtype">int</span> rowIndex);
<a name="l01568"></a>01568 
<a name="l01572"></a>01572     <span class="keyword">public</span> delegate <span class="keywordtype">void</span> <a class="code" href="namespace_bright_ideas_software.html#352a0b9e936f8e478c6dfd97a988b718" title="These delegates are used to sort the listview in some custom fashion.">SortDelegate</a>(OLVColumn column, SortOrder sortOrder);
<a name="l01573"></a>01573 
<a name="l01577"></a>01577     <span class="keyword">public</span> delegate <span class="keywordtype">void</span> <a class="code" href="namespace_bright_ideas_software.html#1ead0a86ea4ef86a033bffcdcece7c98" title="These delegates are used to draw a cell.">RenderDelegate</a>(DrawListViewSubItemEventArgs e, Graphics g, Rectangle r, Object rowObject);
<a name="l01578"></a>01578 
<a name="l01579"></a>01579 <span class="preprocessor">        #endregion</span>
<a name="l01580"></a>01580 <span class="preprocessor"></span>
<a name="l01581"></a>01581 <span class="preprocessor">        #region Column</span>
<a name="l01582"></a>01582 <span class="preprocessor"></span>
<a name="l01599"></a>01599         [Browsable(<span class="keyword">false</span>)]
<a name="l01600"></a><a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html">01600</a>         <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html" title="An OLVColumn knows which aspect of an object it should present.">OLVColumn</a> : ColumnHeader
<a name="l01601"></a>01601         {
<a name="l01605"></a><a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html#8b44aeaea1449dd7983683e403af02c7">01605</a>                 <span class="keyword">public</span> <a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html" title="An OLVColumn knows which aspect of an object it should present.">OLVColumn</a>()
<a name="l01606"></a>01606                         : base ()
<a name="l01607"></a>01607                 {
<a name="l01608"></a>01608                         <span class="keyword">this</span>.Renderer = <span class="keyword">new</span> <a class="code" href="class_bright_ideas_software_1_1_base_renderer.html" title="Renderers are responsible for drawing a single cell within an owner drawn ObjectListView...">BaseRenderer</a>();
<a name="l01609"></a>01609         }
<a name="l01610"></a>01610 
<a name="l01616"></a><a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html#c62eaa2f9eef531a710bb70578ee031a">01616</a>                 <span class="keyword">public</span> <a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html" title="An OLVColumn knows which aspect of an object it should present.">OLVColumn</a>(<span class="keywordtype">string</span> title, <span class="keywordtype">string</span> aspect)
<a name="l01617"></a>01617                         : this ()
<a name="l01618"></a>01618                 {
<a name="l01619"></a>01619                         <span class="keyword">this</span>.Text = title;
<a name="l01620"></a>01620                         <span class="keyword">this</span>.AspectName = aspect;
<a name="l01621"></a>01621                 }
<a name="l01622"></a>01622 
<a name="l01623"></a>01623 <span class="preprocessor">                #region Public Properties</span>
<a name="l01624"></a>01624 <span class="preprocessor"></span>
<a name="l01629"></a>01629                 [Category(<span class="stringliteral">"Behavior"</span>),
<a name="l01630"></a>01630                  Description(<span class="stringliteral">"The name of the property or method that should be called to get the aspect to display in this column"</span>)]
<a name="l01631"></a><a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html#8ea92f66198cfeab8f7a145b15c3595c">01631</a>                 <span class="keyword">public</span> <span class="keywordtype">string</span> AspectName {
<a name="l01632"></a>01632                         <span class="keyword">get</span> { <span class="keywordflow">return</span> aspectName; }
<a name="l01633"></a>01633                         <span class="keyword">set</span> { aspectName = value; }
<a name="l01634"></a>01634                 }
<a name="l01635"></a>01635 
<a name="l01643"></a>01643                 [Category(<span class="stringliteral">"Behavior"</span>),
<a name="l01644"></a>01644                  Description(<span class="stringliteral">"The format string that will be used to convert an aspect to its string representation"</span>),
<a name="l01645"></a>01645                  DefaultValue(null)]
<a name="l01646"></a><a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html#8d5a82ba022081b52a5d00b77c3f7faf">01646</a>                 <span class="keyword">public</span> <span class="keywordtype">string</span> AspectToStringFormat {
<a name="l01647"></a>01647                         <span class="keyword">get</span> { <span class="keywordflow">return</span> aspectToStringFormat; }
<a name="l01648"></a>01648                         <span class="keyword">set</span> { aspectToStringFormat = value; }
<a name="l01649"></a>01649                 }
<a name="l01650"></a>01650 
<a name="l01658"></a>01658         [Category(<span class="stringliteral">"Behavior"</span>),
<a name="l01659"></a>01659          Description(<span class="stringliteral">"The name of the property or method that should be called to get the aspect to display in this column"</span>),
<a name="l01660"></a>01660          DefaultValue(<span class="keyword">false</span>)]
<a name="l01661"></a>01661         <span class="keyword">public</span> <span class="keywordtype">bool</span> UseInitialLetterForGroup
<a name="l01662"></a><a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html#363bb3d44b9094fe467a764a05824486">01662</a>         {
<a name="l01663"></a>01663             <span class="keyword">get</span> { <span class="keywordflow">return</span> useInitialLetterForGroup; }
<a name="l01664"></a>01664             <span class="keyword">set</span> { useInitialLetterForGroup = value; }
<a name="l01665"></a>01665         }
<a name="l01666"></a>01666 
<a name="l01672"></a>01672         [Category(<span class="stringliteral">"Behavior"</span>),
<a name="l01673"></a>01673         Description(<span class="stringliteral">"Will this column be used when the view is switched to tile view"</span>),
<a name="l01674"></a>01674          DefaultValue(<span class="keyword">false</span>)]
<a name="l01675"></a>01675         <span class="keyword">public</span> <span class="keywordtype">bool</span> IsTileViewColumn
<a name="l01676"></a><a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html#0edf855aa63af2138cb4e626f0f982cb">01676</a>         {
<a name="l01677"></a>01677             <span class="keyword">get</span> { <span class="keywordflow">return</span> isTileViewColumn; }
<a name="l01678"></a>01678             <span class="keyword">set</span> { isTileViewColumn = value; }
<a name="l01679"></a>01679         }
<a name="l01680"></a>01680         <span class="keyword">private</span> <span class="keywordtype">bool</span> isTileViewColumn = <span class="keyword">false</span>;
<a name="l01681"></a>01681 
<a name="l01688"></a>01688                 [Browsable(<span class="keyword">false</span>),
<a name="l01689"></a>01689                  DesignerSerializationVisibility(DesignerSerializationVisibility.Hidden)]
<a name="l01690"></a><a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html#2a5cf23b0f04b0ccd2dcf438310f120e">01690</a>                 <span class="keyword">public</span> <a class="code" href="namespace_bright_ideas_software.html#08781fbab2ebaf9948bfa74cd4542d56" title="These delegates are used to extract an aspect from a row object.">AspectGetterDelegate</a> AspectGetter {
<a name="l01691"></a>01691                         <span class="keyword">get</span> { <span class="keywordflow">return</span> aspectGetter; }
<a name="l01692"></a>01692                         <span class="keyword">set</span> {
<a name="l01693"></a>01693                                 aspectGetter = value;
<a name="l01694"></a>01694                             aspectGetterAutoGenerated = <span class="keyword">false</span>;
<a name="l01695"></a>01695                         }
<a name="l01696"></a>01696                 }
<a name="l01697"></a>01697 
<a name="l01702"></a>01702                 [Browsable(<span class="keyword">false</span>),
<a name="l01703"></a>01703                  DesignerSerializationVisibility(DesignerSerializationVisibility.Hidden)]
<a name="l01704"></a><a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html#73420a00e3700ab9fe66166c4ac75c33">01704</a>                 <span class="keyword">public</span> <a class="code" href="namespace_bright_ideas_software.html#fce02ac178d6ae8bfcceb5463b7dfd9a" title="These delegates can be used to convert an aspect value to a display string, instead...">AspectToStringConverterDelegate</a> AspectToStringConverter {
<a name="l01705"></a>01705                         <span class="keyword">get</span> { <span class="keywordflow">return</span> aspectToStringConverter; }
<a name="l01706"></a>01706                         <span class="keyword">set</span> { aspectToStringConverter = value; }
<a name="l01707"></a>01707                 }
<a name="l01708"></a>01708 
<a name="l01721"></a>01721                 [Browsable(<span class="keyword">false</span>),
<a name="l01722"></a>01722                  DesignerSerializationVisibility(DesignerSerializationVisibility.Hidden)]
<a name="l01723"></a><a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html#7b367c725027240a49d93741b5b895ef">01723</a>                 <span class="keyword">public</span> <a class="code" href="namespace_bright_ideas_software.html#223f34ec2cbe7a76b8aee34cb3b1052d">ImageGetterDelegate</a> ImageGetter {
<a name="l01724"></a>01724                         <span class="keyword">get</span> { <span class="keywordflow">return</span> imageGetter; }
<a name="l01725"></a>01725                         <span class="keyword">set</span> { imageGetter = value; }
<a name="l01726"></a>01726                 }
<a name="l01727"></a>01727 
<a name="l01732"></a>01732                 [Browsable(<span class="keyword">false</span>),
<a name="l01733"></a>01733                  DesignerSerializationVisibility(DesignerSerializationVisibility.Hidden)]
<a name="l01734"></a><a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html#f0b51661383962d035d9863c810dd26b">01734</a>                 <span class="keyword">public</span> <a class="code" href="namespace_bright_ideas_software.html#c9d897e0474be185e67caa067773a4ec" title="These delegates are used to retrieve the object that is the key of the group to which...">GroupKeyGetterDelegate</a> GroupKeyGetter {
<a name="l01735"></a>01735                         <span class="keyword">get</span> { <span class="keywordflow">return</span> groupKeyGetter; }
<a name="l01736"></a>01736                         <span class="keyword">set</span> { groupKeyGetter = value; }
<a name="l01737"></a>01737                 }
<a name="l01738"></a>01738 
<a name="l01742"></a>01742                 [Browsable(<span class="keyword">false</span>),
<a name="l01743"></a>01743                  DesignerSerializationVisibility(DesignerSerializationVisibility.Hidden)]
<a name="l01744"></a><a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html#3e76a67245e6261147344d05bf9fdafc">01744</a>                 <span class="keyword">public</span> <a class="code" href="namespace_bright_ideas_software.html#f7db3c16e2854fb8133a675c8e879a68" title="These delegates are used to convert a group key into a title for the group.">GroupKeyToTitleConverterDelegate</a> GroupKeyToTitleConverter {
<a name="l01745"></a>01745                         <span class="keyword">get</span> { <span class="keywordflow">return</span> groupKeyToTitleConverter; }
<a name="l01746"></a>01746                         <span class="keyword">set</span> { groupKeyToTitleConverter = value; }
<a name="l01747"></a>01747                 }
<a name="l01748"></a>01748 
<a name="l01752"></a>01752         [Browsable(<span class="keyword">false</span>),
<a name="l01753"></a>01753          DesignerSerializationVisibility(DesignerSerializationVisibility.Hidden)]
<a name="l01754"></a>01754         <span class="keyword">public</span> <a class="code" href="namespace_bright_ideas_software.html#1ead0a86ea4ef86a033bffcdcece7c98" title="These delegates are used to draw a cell.">RenderDelegate</a> RendererDelegate
<a name="l01755"></a><a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html#01d571a7e66d6e10fb8193ce474b6533">01755</a>         {
<a name="l01756"></a>01756             <span class="keyword">get</span> { <span class="keywordflow">return</span> rendererDelegate; }
<a name="l01757"></a>01757             <span class="keyword">set</span> { rendererDelegate = value; }
<a name="l01758"></a>01758         }
<a name="l01759"></a>01759 
<a name="l01763"></a>01763         [Browsable(<span class="keyword">false</span>),
<a name="l01764"></a>01764          DesignerSerializationVisibility(DesignerSerializationVisibility.Hidden)]
<a name="l01765"></a>01765         <span class="keyword">public</span> <a class="code" href="class_bright_ideas_software_1_1_base_renderer.html" title="Renderers are responsible for drawing a single cell within an owner drawn ObjectListView...">BaseRenderer</a> Renderer
<a name="l01766"></a><a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html#f4b4ca1152ba4c3a486672ddf2203fa5">01766</a>         {
<a name="l01767"></a>01767             <span class="keyword">get</span> { <span class="keywordflow">return</span> renderer; }
<a name="l01768"></a>01768             <span class="keyword">set</span> { 
<a name="l01769"></a>01769                 renderer = value;
<a name="l01770"></a>01770                 <span class="keywordflow">if</span> (renderer == null)
<a name="l01771"></a>01771                     <span class="keyword">this</span>.RendererDelegate = null; 
<a name="l01772"></a>01772                 <span class="keywordflow">else</span> {
<a name="l01773"></a>01773                     renderer.Column = <span class="keyword">this</span>;
<a name="l01774"></a>01774                     <span class="keyword">this</span>.RendererDelegate = <span class="keyword">new</span> <a class="code" href="namespace_bright_ideas_software.html#1ead0a86ea4ef86a033bffcdcece7c98" title="These delegates are used to draw a cell.">RenderDelegate</a>(renderer.HandleRendering);
<a name="l01775"></a>01775                 }
<a name="l01776"></a>01776             }
<a name="l01777"></a>01777         }
<a name="l01778"></a>01778         <span class="keyword">private</span> <a class="code" href="class_bright_ideas_software_1_1_base_renderer.html" title="Renderers are responsible for drawing a single cell within an owner drawn ObjectListView...">BaseRenderer</a> renderer;
<a name="l01779"></a>01779 
<a name="l01784"></a>01784                 [Browsable(<span class="keyword">false</span>),
<a name="l01785"></a>01785                  DesignerSerializationVisibility(DesignerSerializationVisibility.Hidden)]
<a name="l01786"></a><a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html#196800a6674185cb18488c1953391326">01786</a>                 <span class="keyword">public</span> <span class="keywordtype">bool</span> AspectGetterAutoGenerated {
<a name="l01787"></a>01787                         <span class="keyword">get</span> { <span class="keywordflow">return</span> aspectGetterAutoGenerated; }
<a name="l01788"></a>01788                         <span class="keyword">set</span> { aspectGetterAutoGenerated = value; }
<a name="l01789"></a>01789                 }
<a name="l01790"></a>01790         <span class="keyword">private</span> <span class="keywordtype">bool</span> aspectGetterAutoGenerated;
<a name="l01791"></a>01791 
<a name="l01792"></a>01792 <span class="preprocessor">                #endregion</span>
<a name="l01793"></a>01793 <span class="preprocessor"></span>
<a name="l01799"></a><a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html#28568a9320f4db58bce4f5b7561ee111">01799</a>                 <span class="keyword">public</span> <span class="keywordtype">object</span> GetValue(<span class="keywordtype">object</span> rowObject)
<a name="l01800"></a>01800                 {
<a name="l01801"></a>01801                         <span class="keywordflow">if</span> (<span class="keyword">this</span>.aspectGetter == null)
<a name="l01802"></a>01802                                 <span class="keywordflow">return</span> <span class="keyword">this</span>.GetAspectByName(rowObject);
<a name="l01803"></a>01803                         <span class="keywordflow">else</span>
<a name="l01804"></a>01804                                 <span class="keywordflow">return</span> <span class="keyword">this</span>.aspectGetter(rowObject);
<a name="l01805"></a>01805                 }
<a name="l01806"></a>01806 
<a name="l01812"></a><a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html#1ec45e16acb8a44e6a7436b8c30670ae">01812</a>                 <span class="keyword">protected</span> <span class="keywordtype">object</span> GetAspectByName(<span class="keywordtype">object</span> rowObject)
<a name="l01813"></a>01813                 {
<a name="l01814"></a>01814                         <span class="keywordflow">if</span> (<span class="keywordtype">string</span>.IsNullOrEmpty(<span class="keyword">this</span>.aspectName))
<a name="l01815"></a>01815                                 <span class="keywordflow">return</span> null;
<a name="l01816"></a>01816 
<a name="l01817"></a>01817                         <span class="comment">//CONSIDER: Should we include NonPublic in this list?</span>
<a name="l01818"></a>01818                         BindingFlags flags = BindingFlags.Public | BindingFlags.NonPublic | BindingFlags.Instance |
<a name="l01819"></a>01819                                 BindingFlags.InvokeMethod | BindingFlags.GetProperty | BindingFlags.GetField;
<a name="l01820"></a>01820             <span class="keywordtype">object</span> source = rowObject;
<a name="l01821"></a>01821             <span class="keywordflow">foreach</span> (<span class="keywordtype">string</span> property <span class="keywordflow">in</span> <span class="keyword">this</span>.aspectName.Split(<span class="charliteral">'.'</span>)) {
<a name="l01822"></a>01822                 <span class="keywordflow">try</span> {
<a name="l01823"></a>01823                     source = source.GetType().InvokeMember(property, flags, null, source, null);
<a name="l01824"></a>01824                 } <span class="keywordflow">catch</span> (System.MissingMethodException) {
<a name="l01825"></a>01825                     <span class="keywordflow">return</span> String.Format(<span class="stringliteral">"Cannot invoke '{0}' on a {1}"</span>, property, source.GetType());
<a name="l01826"></a>01826                 }
<a name="l01827"></a>01827             }
<a name="l01828"></a>01828             <span class="keywordflow">return</span> source;
<a name="l01829"></a>01829         }
<a name="l01830"></a>01830 
<a name="l01840"></a><a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html#49bf2fcc5a5f3548e2398b533c6dd254">01840</a>                 <span class="keyword">public</span> <span class="keywordtype">string</span> GetStringValue(<span class="keywordtype">object</span> rowObject)
<a name="l01841"></a>01841                 {
<a name="l01842"></a>01842                         <span class="keywordflow">return</span> <span class="keyword">this</span>.ValueToString(<span class="keyword">this</span>.GetValue(rowObject));
<a name="l01843"></a>01843                 }
<a name="l01844"></a>01844 
<a name="l01855"></a><a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html#c5461d0397c20c6f723938a0fd6baae0">01855</a>                 <span class="keyword">public</span> <span class="keywordtype">string</span> ValueToString(<span class="keywordtype">object</span> value)
<a name="l01856"></a>01856                 {
<a name="l01857"></a>01857                         <span class="comment">// CONSIDER: Should we give aspect-to-string converters a chance to work on a null value?</span>
<a name="l01858"></a>01858                         <span class="keywordflow">if</span> (value == null)
<a name="l01859"></a>01859                                 <span class="keywordflow">return</span> <span class="stringliteral">""</span>;
<a name="l01860"></a>01860 
<a name="l01861"></a>01861                         <span class="keywordflow">if</span> (<span class="keyword">this</span>.aspectToStringConverter != null)
<a name="l01862"></a>01862                                 <span class="keywordflow">return</span> <span class="keyword">this</span>.aspectToStringConverter(value);
<a name="l01863"></a>01863 
<a name="l01864"></a>01864                         <span class="keywordtype">string</span> fmt = <span class="keyword">this</span>.AspectToStringFormat;
<a name="l01865"></a>01865                         <span class="keywordflow">if</span> (String.IsNullOrEmpty(fmt))
<a name="l01866"></a>01866                                 fmt = <span class="stringliteral">"{0}"</span>;
<a name="l01867"></a>01867                         <span class="keywordflow">return</span> String.Format(fmt, value);
<a name="l01868"></a>01868                 }
<a name="l01869"></a>01869 
<a name="l01875"></a><a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html#4d5455ddb2946f8f675467512545fe6c">01875</a>                 <span class="keyword">public</span> Object GetImage(<span class="keywordtype">object</span> rowObject)
<a name="l01876"></a>01876                 {
<a name="l01877"></a>01877                         <span class="keywordflow">if</span> (<span class="keyword">this</span>.imageGetter == null)
<a name="l01878"></a>01878                                 <span class="keywordflow">return</span> null;
<a name="l01879"></a>01879                         <span class="keywordflow">else</span>
<a name="l01880"></a>01880                                 <span class="keywordflow">return</span> <span class="keyword">this</span>.imageGetter(rowObject);
<a name="l01881"></a>01881                 }
<a name="l01882"></a>01882 
<a name="l01888"></a><a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html#ce4aaa8ec94a9e2f67d080fb89509ae2">01888</a>                 <span class="keyword">public</span> <span class="keywordtype">object</span> GetGroupKey(<span class="keywordtype">object</span> rowObject)
<a name="l01889"></a>01889                 {
<a name="l01890"></a>01890                         <span class="keywordflow">if</span> (<span class="keyword">this</span>.groupKeyGetter == null)
<a name="l01891"></a>01891                         {
<a name="l01892"></a>01892                                 <span class="keywordtype">object</span> key = <span class="keyword">this</span>.GetValue(rowObject);
<a name="l01893"></a>01893                                 <span class="keywordflow">if</span> (key is <span class="keywordtype">string</span> &amp;&amp; <span class="keyword">this</span>.UseInitialLetterForGroup)
<a name="l01894"></a>01894                                         key = ((string)key).Substring(0, 1).ToUpper();
<a name="l01895"></a>01895                                 <span class="keywordflow">return</span> key;
<a name="l01896"></a>01896                         }
<a name="l01897"></a>01897                         <span class="keywordflow">else</span>
<a name="l01898"></a>01898                                 <span class="keywordflow">return</span> <span class="keyword">this</span>.groupKeyGetter(rowObject);
<a name="l01899"></a>01899                 }
<a name="l01900"></a>01900 
<a name="l01906"></a><a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html#4cb5703a5fd96b54e33a93ba93de23be">01906</a>                 <span class="keyword">public</span> <span class="keywordtype">string</span> ConvertGroupKeyToTitle(<span class="keywordtype">object</span> value)
<a name="l01907"></a>01907                 {
<a name="l01908"></a>01908                         <span class="keywordflow">if</span> (<span class="keyword">this</span>.groupKeyToTitleConverter == null)
<a name="l01909"></a>01909                                 <span class="keywordflow">return</span> <span class="keyword">this</span>.ValueToString(value);
<a name="l01910"></a>01910                         <span class="keywordflow">else</span>
<a name="l01911"></a>01911                                 <span class="keywordflow">return</span> <span class="keyword">this</span>.groupKeyToTitleConverter(value);
<a name="l01912"></a>01912         }
<a name="l01913"></a>01913 
<a name="l01914"></a>01914 <span class="preprocessor">        #region Utilities</span>
<a name="l01915"></a>01915 <span class="preprocessor"></span>
<a name="l01931"></a>01931         <span class="keyword">public</span> <span class="keywordtype">void</span> MakeGroupies&lt;T&gt;(T[] values, <span class="keywordtype">string</span>[] descriptions) 
<a name="l01932"></a>01932         {
<a name="l01933"></a>01933             <span class="keywordflow">if</span> (values.Length + 1 != descriptions.Length)
<a name="l01934"></a>01934                 <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentException(<span class="stringliteral">"descriptions must have one more element than values."</span>);
<a name="l01935"></a>01935 
<a name="l01936"></a>01936             <span class="comment">// Install a delegate that returns the index of the description to be shown</span>
<a name="l01937"></a>01937             <span class="keyword">this</span>.GroupKeyGetter = delegate(<span class="keywordtype">object</span> row) {
<a name="l01938"></a>01938                 Object aspect = <span class="keyword">this</span>.GetValue(row);
<a name="l01939"></a>01939                 <span class="keywordflow">if</span> (aspect == null || aspect == System.DBNull.Value)
<a name="l01940"></a>01940                     <span class="keywordflow">return</span> -1;
<a name="l01941"></a>01941                 IComparable comparable = (IComparable)aspect;
<a name="l01942"></a>01942                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; values.Length; i++) {
<a name="l01943"></a>01943                     <span class="keywordflow">if</span> (comparable.CompareTo(values[i]) &lt; 0)
<a name="l01944"></a>01944                         <span class="keywordflow">return</span> i;
<a name="l01945"></a>01945                 }
<a name="l01946"></a>01946 
<a name="l01947"></a>01947                 <span class="comment">// Display the last element in the array</span>
<a name="l01948"></a>01948                 <span class="keywordflow">return</span> descriptions.Length - 1;
<a name="l01949"></a>01949             };
<a name="l01950"></a>01950 
<a name="l01951"></a>01951             <span class="comment">// Install a delegate that simply looks up the given index in the descriptions. </span>
<a name="l01952"></a>01952             <span class="keyword">this</span>.GroupKeyToTitleConverter = delegate(<span class="keywordtype">object</span> key) {
<a name="l01953"></a>01953                 <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)key &lt; 0)
<a name="l01954"></a>01954                     <span class="keywordflow">return</span> <span class="stringliteral">""</span>;
<a name="l01955"></a>01955 
<a name="l01956"></a>01956                 <span class="keywordflow">return</span> descriptions[(int)key];
<a name="l01957"></a>01957             };
<a name="l01958"></a>01958         }
<a name="l01959"></a>01959 
<a name="l01960"></a>01960 <span class="preprocessor">        #endregion</span>
<a name="l01961"></a>01961 <span class="preprocessor"></span>
<a name="l01962"></a>01962 <span class="preprocessor">        #region Private Variables</span>
<a name="l01963"></a>01963 <span class="preprocessor"></span>
<a name="l01964"></a>01964         <span class="keyword">private</span> <span class="keywordtype">string</span> aspectName;
<a name="l01965"></a>01965                 <span class="keyword">private</span> <span class="keywordtype">string</span> aspectToStringFormat;
<a name="l01966"></a>01966                 <span class="keyword">private</span> <span class="keywordtype">bool</span> useInitialLetterForGroup;
<a name="l01967"></a>01967                 <span class="keyword">private</span> <a class="code" href="namespace_bright_ideas_software.html#08781fbab2ebaf9948bfa74cd4542d56" title="These delegates are used to extract an aspect from a row object.">AspectGetterDelegate</a> aspectGetter;
<a name="l01968"></a>01968                 <span class="keyword">private</span> <a class="code" href="namespace_bright_ideas_software.html#fce02ac178d6ae8bfcceb5463b7dfd9a" title="These delegates can be used to convert an aspect value to a display string, instead...">AspectToStringConverterDelegate</a> aspectToStringConverter;
<a name="l01969"></a>01969                 <span class="keyword">private</span> <a class="code" href="namespace_bright_ideas_software.html#223f34ec2cbe7a76b8aee34cb3b1052d">ImageGetterDelegate</a> imageGetter;
<a name="l01970"></a>01970                 <span class="keyword">private</span> <a class="code" href="namespace_bright_ideas_software.html#c9d897e0474be185e67caa067773a4ec" title="These delegates are used to retrieve the object that is the key of the group to which...">GroupKeyGetterDelegate</a> groupKeyGetter;
<a name="l01971"></a>01971         <span class="keyword">private</span> <a class="code" href="namespace_bright_ideas_software.html#f7db3c16e2854fb8133a675c8e879a68" title="These delegates are used to convert a group key into a title for the group.">GroupKeyToTitleConverterDelegate</a> groupKeyToTitleConverter;
<a name="l01972"></a>01972         <span class="keyword">private</span> <a class="code" href="namespace_bright_ideas_software.html#1ead0a86ea4ef86a033bffcdcece7c98" title="These delegates are used to draw a cell.">RenderDelegate</a> rendererDelegate;
<a name="l01973"></a>01973         
<a name="l01974"></a>01974 
<a name="l01975"></a>01975 <span class="preprocessor">        #endregion</span>
<a name="l01976"></a>01976 <span class="preprocessor"></span>
<a name="l01977"></a>01977     }
<a name="l01978"></a>01978 
<a name="l01979"></a>01979 <span class="preprocessor">        #endregion</span>
<a name="l01980"></a>01980 <span class="preprocessor"></span>
<a name="l01981"></a>01981 <span class="preprocessor">        #region OLVListItem and OLVListSubItem</span>
<a name="l01982"></a>01982 <span class="preprocessor"></span>
<a name="l01988"></a><a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_item.html">01988</a>         <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_item.html">OLVListItem</a> : ListViewItem
<a name="l01989"></a>01989         {
<a name="l01993"></a><a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_item.html#283a41188b60812e64ea9d6370b18614">01993</a>                 <span class="keyword">public</span> <a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_item.html">OLVListItem</a>(<span class="keywordtype">object</span> rowObject)
<a name="l01994"></a>01994                         : base()
<a name="l01995"></a>01995                 {
<a name="l01996"></a>01996                         <span class="keyword">this</span>.rowObject = rowObject;
<a name="l01997"></a>01997                 }
<a name="l01998"></a>01998 
<a name="l02002"></a><a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_item.html#9419b594b92c1a8c7106055e0e291872">02002</a>         <span class="keyword">public</span> <a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_item.html">OLVListItem</a>(<span class="keywordtype">object</span> rowObject, <span class="keywordtype">string</span> text, Object image)
<a name="l02003"></a>02003                         : base(text, -1)
<a name="l02004"></a>02004                 {
<a name="l02005"></a>02005                         <span class="keyword">this</span>.rowObject = rowObject;
<a name="l02006"></a>02006             <span class="keyword">this</span>.imageSelector = image;
<a name="l02007"></a>02007                 }
<a name="l02008"></a>02008 
<a name="l02012"></a><a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_item.html#8a7730d25aaaacd31ec03384c0ab3e50">02012</a>                 <span class="keyword">public</span> <span class="keywordtype">object</span> RowObject {
<a name="l02013"></a>02013                         <span class="keyword">get</span> { <span class="keywordflow">return</span> rowObject; }
<a name="l02014"></a>02014                         <span class="keyword">set</span> { rowObject = value; }
<a name="l02015"></a>02015                 }
<a name="l02016"></a>02016         <span class="keyword">private</span> <span class="keywordtype">object</span> rowObject;
<a name="l02017"></a>02017 
<a name="l02022"></a><a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_item.html#9eaa743adfcf86812b1b055fe5598825">02022</a>                 <span class="keyword">public</span> <span class="keywordtype">int</span> DisplayIndex {
<a name="l02023"></a>02023                         <span class="keyword">get</span> { <span class="keywordflow">return</span> displayIndex; }
<a name="l02024"></a>02024                         <span class="keyword">set</span> { displayIndex = value; }
<a name="l02025"></a>02025                 }
<a name="l02026"></a>02026         <span class="keyword">private</span> <span class="keywordtype">int</span> displayIndex;
<a name="l02027"></a>02027 
<a name="l02033"></a>02033         <span class="keyword">public</span> Object ImageSelector
<a name="l02034"></a><a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_item.html#975879f9694860b3ce77eae80ce8385b">02034</a>         {
<a name="l02035"></a>02035             <span class="keyword">get</span> { <span class="keywordflow">return</span> imageSelector; }
<a name="l02036"></a>02036             <span class="keyword">set</span> { 
<a name="l02037"></a>02037                 imageSelector = value;
<a name="l02038"></a>02038                 <span class="keywordflow">if</span> (value is Int32)
<a name="l02039"></a>02039                     <span class="keyword">this</span>.ImageIndex = (Int32)value;
<a name="l02040"></a>02040                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (value is String)
<a name="l02041"></a>02041                     <span class="keyword">this</span>.ImageKey = (String)value;
<a name="l02042"></a>02042                 <span class="keywordflow">else</span>
<a name="l02043"></a>02043                     <span class="keyword">this</span>.ImageIndex = -1;
<a name="l02044"></a>02044             }
<a name="l02045"></a>02045         }
<a name="l02046"></a>02046         <span class="keyword">private</span> Object imageSelector;
<a name="l02047"></a>02047         }
<a name="l02048"></a>02048 
<a name="l02052"></a>02052     [Browsable(<span class="keyword">false</span>)]
<a name="l02053"></a><a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_sub_item.html">02053</a>         <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_sub_item.html" title="A ListViewSubItem that knows which image should be drawn against it.">OLVListSubItem</a> : ListViewItem.ListViewSubItem
<a name="l02054"></a>02054         {
<a name="l02058"></a><a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_sub_item.html#411e6a2cab0831f6747f90365c5c864a">02058</a>                 <span class="keyword">public</span> <a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_sub_item.html" title="A ListViewSubItem that knows which image should be drawn against it.">OLVListSubItem</a>()
<a name="l02059"></a>02059                         : base()
<a name="l02060"></a>02060                 {
<a name="l02061"></a>02061                 }
<a name="l02062"></a>02062 
<a name="l02066"></a><a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_sub_item.html#2351f33016f9804c3f2113b9c0428c05">02066</a>         <span class="keyword">public</span> <a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_sub_item.html" title="A ListViewSubItem that knows which image should be drawn against it.">OLVListSubItem</a>(<span class="keywordtype">string</span> text, Object image)
<a name="l02067"></a>02067                         : base()
<a name="l02068"></a>02068                 {
<a name="l02069"></a>02069                         <span class="keyword">this</span>.Text = text;
<a name="l02070"></a>02070             <span class="keyword">this</span>.ImageSelector = image;
<a name="l02071"></a>02071                 }
<a name="l02072"></a>02072 
<a name="l02078"></a>02078         <span class="keyword">public</span> Object ImageSelector
<a name="l02079"></a><a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_sub_item.html#e44cbcd4eec98754b436db074f10b303">02079</a>         {
<a name="l02080"></a>02080             <span class="keyword">get</span> { <span class="keywordflow">return</span> imageSelector; }
<a name="l02081"></a>02081             <span class="keyword">set</span> { imageSelector = value;}
<a name="l02082"></a>02082         }
<a name="l02083"></a>02083         <span class="keyword">private</span> Object imageSelector;
<a name="l02084"></a>02084         }
<a name="l02085"></a>02085 
<a name="l02086"></a>02086 <span class="preprocessor">        #endregion</span>
<a name="l02087"></a>02087 <span class="preprocessor"></span>
<a name="l02088"></a>02088 <span class="preprocessor">    #region Comparers</span>
<a name="l02089"></a>02089 <span class="preprocessor"></span>
<a name="l02095"></a><a class="code" href="class_bright_ideas_software_1_1_list_view_group_comparer.html">02095</a>         <span class="keyword">internal</span> <span class="keyword">class </span><a class="code" href="class_bright_ideas_software_1_1_list_view_group_comparer.html">ListViewGroupComparer</a> : IComparer&lt;ListViewGroup&gt;
<a name="l02096"></a>02096         {
<a name="l02097"></a><a class="code" href="class_bright_ideas_software_1_1_list_view_group_comparer.html#be6a4eebe8193630f75320a8f1a45722">02097</a>             <span class="keyword">public</span> <a class="code" href="class_bright_ideas_software_1_1_list_view_group_comparer.html">ListViewGroupComparer</a>(SortOrder order)
<a name="l02098"></a>02098             {
<a name="l02099"></a>02099                 <span class="keyword">this</span>.sortOrder = order;
<a name="l02100"></a>02100             }
<a name="l02101"></a>02101 
<a name="l02102"></a><a class="code" href="class_bright_ideas_software_1_1_list_view_group_comparer.html#ae0326da1fd97e09698ce63d5e8b681c">02102</a>                 <span class="keyword">public</span> <span class="keywordtype">int</span> Compare(ListViewGroup x, ListViewGroup y)
<a name="l02103"></a>02103                 {
<a name="l02104"></a>02104                 <span class="comment">// If we know how to compare the tags, do that.</span>
<a name="l02105"></a>02105                 <span class="comment">// Otherwise do a case insensitive compare on the group header.</span>
<a name="l02106"></a>02106             <span class="comment">// We have explicitly catch the "almost-null" value of DBNull.Value,</span>
<a name="l02107"></a>02107             <span class="comment">// since comparing to that value always produces a type exception.</span>
<a name="l02108"></a>02108                         <span class="keywordtype">int</span> result;
<a name="l02109"></a>02109             IComparable comparable = x.Tag as IComparable;
<a name="l02110"></a>02110             <span class="keywordflow">if</span> (comparable != null &amp;&amp; y.Tag != System.DBNull.Value)
<a name="l02111"></a>02111                 result = comparable.CompareTo(y.Tag);
<a name="l02112"></a>02112             <span class="keywordflow">else</span>
<a name="l02113"></a>02113                 result = String.Compare(x.Header, y.Header, <span class="keyword">true</span>);
<a name="l02114"></a>02114 
<a name="l02115"></a>02115                 <span class="keywordflow">if</span> (<span class="keyword">this</span>.sortOrder == SortOrder.Descending)
<a name="l02116"></a>02116                         result = 0 - result;
<a name="l02117"></a>02117 
<a name="l02118"></a>02118                 <span class="keywordflow">return</span> result;
<a name="l02119"></a>02119                 }
<a name="l02120"></a>02120 
<a name="l02121"></a>02121             <span class="keyword">private</span> SortOrder sortOrder;
<a name="l02122"></a>02122         }
<a name="l02123"></a>02123 
<a name="l02131"></a><a class="code" href="class_bright_ideas_software_1_1_column_comparer.html">02131</a>         <span class="keyword">internal</span> <span class="keyword">class </span><a class="code" href="class_bright_ideas_software_1_1_column_comparer.html" title="ColumnComparer is the workhorse for all comparison between two values of a particular...">ColumnComparer</a> : IComparer, IComparer&lt;OLVListItem&gt;
<a name="l02132"></a>02132         {
<a name="l02133"></a><a class="code" href="class_bright_ideas_software_1_1_column_comparer.html#91dfa5d38e865ebe1886322ee0721594">02133</a>                 <span class="keyword">public</span> <a class="code" href="class_bright_ideas_software_1_1_column_comparer.html" title="ColumnComparer is the workhorse for all comparison between two values of a particular...">ColumnComparer</a>(<a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html" title="An OLVColumn knows which aspect of an object it should present.">OLVColumn</a> col, SortOrder order)
<a name="l02134"></a>02134                 {
<a name="l02135"></a>02135                         <span class="keyword">this</span>.column = col;
<a name="l02136"></a>02136                         <span class="keyword">this</span>.sortOrder = order;
<a name="l02137"></a>02137                 }
<a name="l02138"></a>02138 
<a name="l02139"></a><a class="code" href="class_bright_ideas_software_1_1_column_comparer.html#4387229cf3a7db32274e7729e6ff7bdd">02139</a>                 <span class="keyword">public</span> <span class="keywordtype">int</span> Compare(<span class="keywordtype">object</span> x, <span class="keywordtype">object</span> y)
<a name="l02140"></a>02140                 {
<a name="l02141"></a>02141                         <span class="keywordflow">return</span> <span class="keyword">this</span>.Compare((<a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_item.html">OLVListItem</a>)x, (<a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_item.html">OLVListItem</a>)y);
<a name="l02142"></a>02142                 }
<a name="l02143"></a>02143 
<a name="l02144"></a><a class="code" href="class_bright_ideas_software_1_1_column_comparer.html#dfc04745424633712fbf6f3b4e99f5f1">02144</a>                 <span class="keyword">public</span> <span class="keywordtype">int</span> Compare(<a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_item.html">OLVListItem</a> x, <a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_item.html">OLVListItem</a> y)
<a name="l02145"></a>02145                 {
<a name="l02146"></a>02146                         <span class="keywordtype">int</span> result = 0;
<a name="l02147"></a>02147                         <span class="keywordtype">object</span> x1 = <span class="keyword">this</span>.column.<a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html#28568a9320f4db58bce4f5b7561ee111" title="For a given row object, return the object that is to be displayed in this column...">GetValue</a>(x.<a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_item.html#8a7730d25aaaacd31ec03384c0ab3e50" title="RowObject is the model object that is source of the data for this list item.">RowObject</a>);
<a name="l02148"></a>02148                         <span class="keywordtype">object</span> y1 = <span class="keyword">this</span>.column.GetValue(y.<a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_item.html#8a7730d25aaaacd31ec03384c0ab3e50" title="RowObject is the model object that is source of the data for this list item.">RowObject</a>);
<a name="l02149"></a>02149 
<a name="l02150"></a>02150                         <span class="keywordflow">if</span> (<span class="keyword">this</span>.sortOrder == SortOrder.None)
<a name="l02151"></a>02151                                 <span class="keywordflow">return</span> 0;
<a name="l02152"></a>02152 
<a name="l02153"></a>02153                         <span class="comment">// Handle nulls. Null values come last</span>
<a name="l02154"></a>02154             <span class="keywordtype">bool</span> xIsNull = (x1 == null || x1 == System.DBNull.Value);
<a name="l02155"></a>02155             <span class="keywordtype">bool</span> yIsNull = (y1 == null || y1 == System.DBNull.Value);
<a name="l02156"></a>02156             <span class="keywordflow">if</span> (xIsNull || yIsNull)
<a name="l02157"></a>02157                 <span class="keywordflow">if</span> (xIsNull &amp;&amp; yIsNull)
<a name="l02158"></a>02158                                         result = 0;
<a name="l02159"></a>02159                                 <span class="keywordflow">else</span>
<a name="l02160"></a>02160                     result = (xIsNull ? -1 : 1);
<a name="l02161"></a>02161                         <span class="keywordflow">else</span>
<a name="l02162"></a>02162                                 result = <span class="keyword">this</span>.CompareValues(x1, y1);
<a name="l02163"></a>02163 
<a name="l02164"></a>02164                         <span class="keywordflow">if</span> (<span class="keyword">this</span>.sortOrder == SortOrder.Descending)
<a name="l02165"></a>02165                                 result = 0 - result;
<a name="l02166"></a>02166 
<a name="l02167"></a>02167                         <span class="keywordflow">return</span> result;
<a name="l02168"></a>02168                 }
<a name="l02169"></a>02169 
<a name="l02170"></a><a class="code" href="class_bright_ideas_software_1_1_column_comparer.html#14fa9c906c840845ac4c1cd0a5b71b09">02170</a>                 <span class="keyword">public</span> <span class="keywordtype">int</span> CompareValues(<span class="keywordtype">object</span> x, <span class="keywordtype">object</span> y)
<a name="l02171"></a>02171                 {
<a name="l02172"></a>02172             <span class="comment">// Force case insensitive compares on strings</span>
<a name="l02173"></a>02173             <span class="keywordflow">if</span> (x is String)
<a name="l02174"></a>02174                 <span class="keywordflow">return</span> String.Compare((String)x, (String)y, <span class="keyword">true</span>);
<a name="l02175"></a>02175             <span class="keywordflow">else</span> {
<a name="l02176"></a>02176                 IComparable comparable = x as IComparable;
<a name="l02177"></a>02177                 <span class="keywordflow">if</span> (comparable != null)
<a name="l02178"></a>02178                     <span class="keywordflow">return</span> comparable.CompareTo(y);
<a name="l02179"></a>02179                 <span class="keywordflow">else</span>
<a name="l02180"></a>02180                     <span class="keywordflow">return</span> 0;
<a name="l02181"></a>02181             }
<a name="l02182"></a>02182                 }
<a name="l02183"></a>02183 
<a name="l02184"></a>02184                 <span class="keyword">private</span> <a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html" title="An OLVColumn knows which aspect of an object it should present.">OLVColumn</a> column;
<a name="l02185"></a>02185                 <span class="keyword">private</span> SortOrder sortOrder;
<a name="l02186"></a>02186         }
<a name="l02187"></a>02187 
<a name="l02188"></a>02188 <span class="preprocessor">        #endregion</span>
<a name="l02189"></a>02189 <span class="preprocessor"></span>
<a name="l02190"></a>02190 <span class="preprocessor">    #region Renderers</span>
<a name="l02191"></a>02191 <span class="preprocessor"></span>
<a name="l02200"></a>02200     [Browsable(<span class="keyword">false</span>)]
<a name="l02201"></a><a class="code" href="class_bright_ideas_software_1_1_base_renderer.html">02201</a>     <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="class_bright_ideas_software_1_1_base_renderer.html" title="Renderers are responsible for drawing a single cell within an owner drawn ObjectListView...">BaseRenderer</a>
<a name="l02202"></a>02202     {
<a name="l02206"></a><a class="code" href="class_bright_ideas_software_1_1_base_renderer.html#3dd1d2cfbab43c47bdf0762291b82efc">02206</a>         <span class="keyword">public</span> <a class="code" href="class_bright_ideas_software_1_1_base_renderer.html" title="Renderers are responsible for drawing a single cell within an owner drawn ObjectListView...">BaseRenderer</a>()
<a name="l02207"></a>02207         {
<a name="l02208"></a>02208         }
<a name="l02209"></a>02209 
<a name="l02210"></a>02210 <span class="preprocessor">        #region Properties </span>
<a name="l02211"></a>02211 <span class="preprocessor"></span>
<a name="l02215"></a>02215         <span class="keyword">public</span> DrawListViewSubItemEventArgs Event
<a name="l02216"></a><a class="code" href="class_bright_ideas_software_1_1_base_renderer.html#97d3b56d642988e1e4c8400603282d75">02216</a>         {
<a name="l02217"></a>02217             <span class="keyword">get</span> { <span class="keywordflow">return</span> eventArgs; }
<a name="l02218"></a>02218             <span class="keyword">set</span> { eventArgs = value; }
<a name="l02219"></a>02219         }
<a name="l02220"></a>02220         <span class="keyword">private</span> DrawListViewSubItemEventArgs eventArgs;
<a name="l02221"></a>02221 
<a name="l02225"></a>02225         <span class="keyword">public</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html" title="An object list displays 'aspects' of a collection of objects in a multi-column list...">ObjectListView</a> ListView
<a name="l02226"></a><a class="code" href="class_bright_ideas_software_1_1_base_renderer.html#9d11ed48caa506acb454a979ca126f52">02226</a>         {
<a name="l02227"></a>02227             <span class="keyword">get</span> { <span class="keywordflow">return</span> objectListView; }
<a name="l02228"></a>02228             <span class="keyword">set</span> { objectListView = value; }
<a name="l02229"></a>02229         }
<a name="l02230"></a>02230         <span class="keyword">private</span> <a class="code" href="class_bright_ideas_software_1_1_object_list_view.html" title="An object list displays 'aspects' of a collection of objects in a multi-column list...">ObjectListView</a> objectListView;
<a name="l02231"></a>02231 
<a name="l02235"></a>02235         <span class="keyword">public</span> <a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html" title="An OLVColumn knows which aspect of an object it should present.">OLVColumn</a> Column
<a name="l02236"></a><a class="code" href="class_bright_ideas_software_1_1_base_renderer.html#f2975a5e02e1fef582d94a38969ceecf">02236</a>         {
<a name="l02237"></a>02237             <span class="keyword">get</span> { <span class="keywordflow">return</span> column; }
<a name="l02238"></a>02238             <span class="keyword">set</span> { column = value; }
<a name="l02239"></a>02239         }
<a name="l02240"></a>02240         <span class="keyword">private</span> <a class="code" href="class_bright_ideas_software_1_1_o_l_v_column.html" title="An OLVColumn knows which aspect of an object it should present.">OLVColumn</a> column;
<a name="l02241"></a>02241 
<a name="l02245"></a>02245         <span class="keyword">public</span> Object RowObject
<a name="l02246"></a><a class="code" href="class_bright_ideas_software_1_1_base_renderer.html#a11c7b033da30b6d4771a5d4d6da6ac2">02246</a>         {
<a name="l02247"></a>02247             <span class="keyword">get</span> { <span class="keywordflow">return</span> rowObject; }
<a name="l02248"></a>02248             <span class="keyword">set</span> { rowObject = value; }
<a name="l02249"></a>02249         }
<a name="l02250"></a>02250         <span class="keyword">private</span> Object rowObject;
<a name="l02251"></a>02251 
<a name="l02255"></a>02255         <span class="keyword">public</span> Object Aspect
<a name="l02256"></a><a class="code" href="class_bright_ideas_software_1_1_base_renderer.html#200a16f1fc9294e0f8fd63209ec8d917">02256</a>         {
<a name="l02257"></a>02257             <span class="keyword">get</span> {
<a name="l02258"></a>02258                 <span class="keywordflow">if</span> (aspect == null)
<a name="l02259"></a>02259                     aspect = column.GetValue(<span class="keyword">this</span>.rowObject);
<a name="l02260"></a>02260                 <span class="keywordflow">return</span> aspect; 
<a name="l02261"></a>02261             }
<a name="l02262"></a>02262             <span class="keyword">set</span> { aspect = value; }
<a name="l02263"></a>02263         }
<a name="l02264"></a>02264         <span class="keyword">private</span> Object aspect;
<a name="l02265"></a>02265 
<a name="l02269"></a>02269         <span class="keyword">public</span> <a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_item.html">OLVListItem</a> ListItem
<a name="l02270"></a><a class="code" href="class_bright_ideas_software_1_1_base_renderer.html#f5d9cc465d68f357ec015acca90407c6">02270</a>         {
<a name="l02271"></a>02271             <span class="keyword">get</span> { <span class="keywordflow">return</span> listItem; }
<a name="l02272"></a>02272             <span class="keyword">set</span> { listItem = value; }
<a name="l02273"></a>02273         }
<a name="l02274"></a>02274         <span class="keyword">private</span> <a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_item.html">OLVListItem</a> listItem;
<a name="l02275"></a>02275 
<a name="l02279"></a>02279         <span class="keyword">public</span> ListViewItem.ListViewSubItem SubItem
<a name="l02280"></a><a class="code" href="class_bright_ideas_software_1_1_base_renderer.html#b96dc0efc99cf80fd72f06010797102d">02280</a>         {
<a name="l02281"></a>02281             <span class="keyword">get</span> { <span class="keywordflow">return</span> listSubItem; }
<a name="l02282"></a>02282             <span class="keyword">set</span> { listSubItem = value; }
<a name="l02283"></a>02283         }
<a name="l02284"></a>02284         <span class="keyword">private</span> ListViewItem.ListViewSubItem listSubItem;
<a name="l02285"></a>02285 
<a name="l02290"></a>02290         <span class="keyword">public</span> <a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_sub_item.html" title="A ListViewSubItem that knows which image should be drawn against it.">OLVListSubItem</a> OLVSubItem
<a name="l02291"></a><a class="code" href="class_bright_ideas_software_1_1_base_renderer.html#7ff557746bc04315940c34075ce3457a">02291</a>         {
<a name="l02292"></a>02292             <span class="keyword">get</span> { <span class="keywordflow">return</span> listSubItem as <a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_sub_item.html" title="A ListViewSubItem that knows which image should be drawn against it.">OLVListSubItem</a>; }
<a name="l02293"></a>02293         }
<a name="l02294"></a>02294 
<a name="l02298"></a>02298         <span class="keyword">public</span> <span class="keywordtype">bool</span> IsItemSelected
<a name="l02299"></a><a class="code" href="class_bright_ideas_software_1_1_base_renderer.html#d94e2204eaffeaeb7c9fa3c864fff49f">02299</a>         {
<a name="l02300"></a>02300             <span class="keyword">get</span> { <span class="keywordflow">return</span> isItemSelected; }
<a name="l02301"></a>02301             <span class="keyword">set</span> { isItemSelected = value; }
<a name="l02302"></a>02302         }
<a name="l02303"></a>02303         <span class="keyword">private</span> <span class="keywordtype">bool</span> isItemSelected;
<a name="l02304"></a>02304         
<a name="l02311"></a>02311         <span class="keyword">public</span> <span class="keywordtype">bool</span> DoubleBuffered
<a name="l02312"></a><a class="code" href="class_bright_ideas_software_1_1_base_renderer.html#4a6ce68d573d045e5b7f2430c782594a">02312</a>         {
<a name="l02313"></a>02313             <span class="keyword">get</span> { 
<a name="l02314"></a>02314                 <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">// set this to false if you've changed the DrawSubItem event code</span>
<a name="l02315"></a>02315             }
<a name="l02316"></a>02316         }
<a name="l02317"></a>02317 
<a name="l02318"></a>02318 <span class="preprocessor">        #endregion</span>
<a name="l02319"></a>02319 <span class="preprocessor"></span>
<a name="l02320"></a>02320 <span class="preprocessor">        #region Utilities</span>
<a name="l02321"></a>02321 <span class="preprocessor"></span>        
<a name="l02326"></a><a class="code" href="class_bright_ideas_software_1_1_base_renderer.html#a74dd6d96c1ee2f3d5bda4535cb5fe65">02326</a>         <span class="keyword">public</span> Image GetImage() {
<a name="l02327"></a>02327             <span class="keywordflow">if</span> (<span class="keyword">this</span>.Column.Index == 0)
<a name="l02328"></a>02328                 <span class="keywordflow">return</span> <span class="keyword">this</span>.GetImage(<span class="keyword">this</span>.ListItem.ImageSelector);
<a name="l02329"></a>02329             <span class="keywordflow">else</span>
<a name="l02330"></a>02330                 <span class="keywordflow">return</span> <span class="keyword">this</span>.GetImage(<span class="keyword">this</span>.OLVSubItem.ImageSelector);
<a name="l02331"></a>02331         }
<a name="l02332"></a>02332         
<a name="l02343"></a><a class="code" href="class_bright_ideas_software_1_1_base_renderer.html#07ebdc90764b7a260daa1a400cc3f4d7">02343</a>         <span class="keyword">public</span> Image GetImage(Object imageSelector)
<a name="l02344"></a>02344         {
<a name="l02345"></a>02345             <span class="keywordflow">if</span> (imageSelector == null)
<a name="l02346"></a>02346                 <span class="keywordflow">return</span> null;
<a name="l02347"></a>02347 
<a name="l02348"></a>02348             ImageList il = <span class="keyword">this</span>.ListView.SmallImageList;
<a name="l02349"></a>02349             <span class="keywordflow">if</span> (imageSelector is Int32) {
<a name="l02350"></a>02350                 Int32 index = (Int32)imageSelector;
<a name="l02351"></a>02351                 <span class="keywordflow">if</span> (index &lt; 0 || index &gt;= il.Images.Count)
<a name="l02352"></a>02352                     <span class="keywordflow">return</span> null;
<a name="l02353"></a>02353                 <span class="keywordflow">else</span>
<a name="l02354"></a>02354                     <span class="keywordflow">return</span> il.Images[index];
<a name="l02355"></a>02355             } 
<a name="l02356"></a>02356             
<a name="l02357"></a>02357             <span class="keywordflow">if</span> (imageSelector is String) {
<a name="l02358"></a>02358                 <span class="keywordflow">if</span> (il.Images.ContainsKey((String)imageSelector)) 
<a name="l02359"></a>02359                         <span class="keywordflow">return</span> il.Images[(String)imageSelector];
<a name="l02360"></a>02360                 <span class="keywordflow">else</span>
<a name="l02361"></a>02361                         <span class="keywordflow">return</span> null;
<a name="l02362"></a>02362             }
<a name="l02363"></a>02363             
<a name="l02364"></a>02364             <span class="keywordflow">return</span> imageSelector as Image;
<a name="l02365"></a>02365         }
<a name="l02366"></a>02366 
<a name="l02371"></a><a class="code" href="class_bright_ideas_software_1_1_base_renderer.html#c1ef1d2d8074d82fbdd991eb28c58f97">02371</a>         <span class="keyword">protected</span> Color GetBackgroundColor()
<a name="l02372"></a>02372         {
<a name="l02373"></a>02373             <span class="keywordflow">if</span> (<span class="keyword">this</span>.IsItemSelected &amp;&amp; <span class="keyword">this</span>.ListView.FullRowSelect) {
<a name="l02374"></a>02374                 <span class="keywordflow">return</span> SystemColors.Highlight;
<a name="l02375"></a>02375             } <span class="keywordflow">else</span> {
<a name="l02376"></a>02376                 <span class="keywordflow">return</span> <span class="keyword">this</span>.ListItem.BackColor;
<a name="l02377"></a>02377             }
<a name="l02378"></a>02378         }
<a name="l02379"></a>02379 
<a name="l02384"></a><a class="code" href="class_bright_ideas_software_1_1_base_renderer.html#10857c33cb24e319b61e20fa78b8a488">02384</a>         <span class="keyword">protected</span> Color GetTextBackgroundColor()
<a name="l02385"></a>02385         {
<a name="l02386"></a>02386             <span class="keywordflow">if</span> (<span class="keyword">this</span>.IsItemSelected &amp;&amp; (<span class="keyword">this</span>.Column.Index == 0 || <span class="keyword">this</span>.ListView.FullRowSelect))
<a name="l02387"></a>02387                 <span class="keywordflow">return</span> SystemColors.Highlight;
<a name="l02388"></a>02388             <span class="keywordflow">else</span>
<a name="l02389"></a>02389                 <span class="keywordflow">return</span> <span class="keyword">this</span>.ListItem.BackColor;
<a name="l02390"></a>02390         }
<a name="l02391"></a>02391 
<a name="l02396"></a><a class="code" href="class_bright_ideas_software_1_1_base_renderer.html#1a4aad370c1bbea947d1cde36965c77d">02396</a>         <span class="keyword">protected</span> Color GetForegroundColor()
<a name="l02397"></a>02397         {
<a name="l02398"></a>02398             <span class="keywordflow">if</span> (<span class="keyword">this</span>.IsItemSelected &amp;&amp; (<span class="keyword">this</span>.Column.Index == 0 || <span class="keyword">this</span>.ListView.FullRowSelect))
<a name="l02399"></a>02399                 <span class="keywordflow">return</span> SystemColors.HighlightText;
<a name="l02400"></a>02400             <span class="keywordflow">else</span>
<a name="l02401"></a>02401                 <span class="keywordflow">return</span> <span class="keyword">this</span>.SubItem.ForeColor;
<a name="l02402"></a>02402         }
<a name="l02403"></a>02403 
<a name="l02411"></a><a class="code" href="class_bright_ideas_software_1_1_base_renderer.html#a23ca40cdae7bb3f6fce8a6125425d19">02411</a>         <span class="keyword">protected</span> Rectangle AlignRectangle(Rectangle outer, Rectangle inner)
<a name="l02412"></a>02412         {
<a name="l02413"></a>02413             <span class="keywordflow">if</span> (inner.Width &gt;= outer.Width)
<a name="l02414"></a>02414                 <span class="keywordflow">return</span> inner;
<a name="l02415"></a>02415 
<a name="l02416"></a>02416             Rectangle r = <span class="keyword">new</span> Rectangle(inner.Location, inner.Size);
<a name="l02417"></a>02417             <span class="keywordflow">switch</span> (<span class="keyword">this</span>.Column.TextAlign) {
<a name="l02418"></a>02418                 <span class="keywordflow">case</span> HorizontalAlignment.Left:
<a name="l02419"></a>02419                     r.X = outer.Left;
<a name="l02420"></a>02420                     <span class="keywordflow">break</span>;
<a name="l02421"></a>02421                 <span class="keywordflow">case</span> HorizontalAlignment.Center:
<a name="l02422"></a>02422                     r.X = outer.Left + ((outer.Width - inner.Width) / 2);
<a name="l02423"></a>02423                     <span class="keywordflow">break</span>;
<a name="l02424"></a>02424                 <span class="keywordflow">case</span> HorizontalAlignment.Right:
<a name="l02425"></a>02425                     r.X = outer.Right - inner.Width - 1;
<a name="l02426"></a>02426                     <span class="keywordflow">break</span>;
<a name="l02427"></a>02427             }
<a name="l02428"></a>02428 
<a name="l02429"></a>02429             <span class="keywordflow">if</span> (inner.Height &lt; outer.Height)
<a name="l02430"></a>02430                 r.Y = outer.Top + ((outer.Height - inner.Height) / 2);
<a name="l02431"></a>02431 
<a name="l02432"></a>02432             <span class="keywordflow">return</span> r;
<a name="l02433"></a>02433         }
<a name="l02434"></a>02434 
<a name="l02441"></a><a class="code" href="class_bright_ideas_software_1_1_base_renderer.html#ee2464ee880b8093dab2724632dc744b">02441</a>         <span class="keyword">protected</span> <span class="keywordtype">void</span> DrawAlignedImage(Graphics g, Rectangle r, Image image)
<a name="l02442"></a>02442         {
<a name="l02443"></a>02443             <span class="keywordflow">if</span> (image == null)
<a name="l02444"></a>02444                 <span class="keywordflow">return</span>;
<a name="l02445"></a>02445 
<a name="l02446"></a>02446             Rectangle imageBounds = <span class="keyword">this</span>.AlignRectangle(r, <span class="keyword">new</span> Rectangle(r.Location, image.Size));
<a name="l02447"></a>02447             
<a name="l02448"></a>02448             <span class="comment">// If the image is too big to be drawn in the space provided, proportionally scale it down</span>
<a name="l02449"></a>02449             <span class="keywordflow">if</span> (r.Height &lt; image.Height)
<a name="l02450"></a>02450                 imageBounds.Width = (int)((<span class="keywordtype">float</span>)image.Width * (<span class="keywordtype">float</span>)r.Height / (<span class="keywordtype">float</span>)image.Height);
<a name="l02451"></a>02451 
<a name="l02452"></a>02452             g.DrawImage(image, imageBounds);
<a name="l02453"></a>02453         }
<a name="l02454"></a>02454 
<a name="l02460"></a><a class="code" href="class_bright_ideas_software_1_1_base_renderer.html#71bb7c195cd8ca1b6d49164a9472eb61">02460</a>         <span class="keyword">protected</span> <span class="keywordtype">void</span> DrawBackground(Graphics g, Rectangle r)
<a name="l02461"></a>02461         {
<a name="l02462"></a>02462             g.FillRectangle(<span class="keyword">new</span> SolidBrush(<span class="keyword">this</span>.GetBackgroundColor()), r);
<a name="l02463"></a>02463         }
<a name="l02464"></a>02464 
<a name="l02465"></a>02465 <span class="preprocessor">        #endregion</span>
<a name="l02466"></a>02466 <span class="preprocessor"></span>
<a name="l02467"></a>02467 
<a name="l02476"></a><a class="code" href="class_bright_ideas_software_1_1_base_renderer.html#6c7642dd19cf8a1fbcc61170c9374eb6">02476</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> HandleRendering(DrawListViewSubItemEventArgs e, Graphics g, Rectangle r, Object rowObject)
<a name="l02477"></a>02477         {
<a name="l02478"></a>02478             <span class="keyword">this</span>.Event = e;
<a name="l02479"></a>02479             <span class="keyword">this</span>.ListView = (<a class="code" href="class_bright_ideas_software_1_1_object_list_view.html" title="An object list displays 'aspects' of a collection of objects in a multi-column list...">ObjectListView</a>)<span class="keyword">this</span>.Column.ListView;
<a name="l02480"></a>02480             <span class="keyword">this</span>.RowObject = rowObject;
<a name="l02481"></a>02481             <span class="keyword">this</span>.ListItem = e.Item as <a class="code" href="class_bright_ideas_software_1_1_o_l_v_list_item.html">OLVListItem</a>;
<a name="l02482"></a>02482             <span class="keyword">this</span>.SubItem = e.SubItem;
<a name="l02483"></a>02483             <span class="keyword">this</span>.Aspect = null; <span class="comment">// uncache previous result</span>
<a name="l02484"></a>02484             <span class="keyword">this</span>.IsItemSelected = <span class="keyword">this</span>.ListItem.Selected; <span class="comment">// ((e.ItemState &amp; ListViewItemStates.Selected) == ListViewItemStates.Selected);</span>
<a name="l02485"></a>02485             <span class="keyword">this</span>.Render(g, r);
<a name="l02486"></a>02486         }
<a name="l02487"></a>02487 
<a name="l02495"></a><a class="code" href="class_bright_ideas_software_1_1_base_renderer.html#aeb9da37a9ff5fe9be870eba417d76e2">02495</a>         <span class="keyword">virtual</span> <span class="keyword">public</span> <span class="keywordtype">void</span> Render(Graphics g, Rectangle r)
<a name="l02496"></a>02496         {
<a name="l02497"></a>02497             <span class="keyword">this</span>.DrawBackground(g, r);
<a name="l02498"></a>02498             
<a name="l02499"></a>02499             <span class="comment">// Adjust the rectangle to match the padding used by the native mode of the ListView</span>
<a name="l02500"></a>02500             Rectangle r2 = r;
<a name="l02501"></a>02501             r2.X += 4;
<a name="l02502"></a>02502             r2.Width -= 2;
<a name="l02503"></a>02503             <span class="keyword">this</span>.DrawImageAndText(g, r2);
<a name="l02504"></a>02504         }
<a name="l02505"></a>02505 
<a name="l02511"></a><a class="code" href="class_bright_ideas_software_1_1_base_renderer.html#36d5c13cab2c56d9d19a4bce20b10c35">02511</a>         <span class="keyword">protected</span> <span class="keywordtype">void</span> DrawImageAndText(Graphics g, Rectangle r)
<a name="l02512"></a>02512         {
<a name="l02513"></a>02513             DrawImageAndText(g, r, <span class="keyword">this</span>.SubItem.Text, <span class="keyword">this</span>.GetImage());
<a name="l02514"></a>02514         }
<a name="l02515"></a>02515 
<a name="l02523"></a><a class="code" href="class_bright_ideas_software_1_1_base_renderer.html#8b6a17b0ef5dbe49c783f263bd094c3c">02523</a>         <span class="keyword">protected</span> <span class="keywordtype">void</span> DrawImageAndText(Graphics g, Rectangle r, String txt, Image image)
<a name="l02524"></a>02524         {
<a name="l02525"></a>02525             <span class="comment">// Draw the image</span>
<a name="l02526"></a>02526             <span class="keywordtype">int</span> textStart = 3;
<a name="l02527"></a>02527             <span class="keywordflow">if</span> (image != null) {
<a name="l02528"></a>02528                 g.DrawImageUnscaled(image, r.X, r.Y);
<a name="l02529"></a>02529                 textStart += image.Width;
<a name="l02530"></a>02530                 r.X += image.Width;
<a name="l02531"></a>02531                 r.Width -= image.Width;
<a name="l02532"></a>02532             }
<a name="l02533"></a>02533 
<a name="l02534"></a>02534             <span class="comment">// One more problem. When double-buffered, the TextRenderer doesn't correctly offset</span>
<a name="l02535"></a>02535             <span class="comment">// the drawing, so we have to position the text at the left of the buffer.</span>
<a name="l02536"></a>02536             <span class="keywordflow">if</span> (<span class="keyword">this</span>.DoubleBuffered)
<a name="l02537"></a>02537                 r = <span class="keyword">new</span> Rectangle(textStart, 0, r.Width, r.Height);
<a name="l02538"></a>02538 
<a name="l02539"></a>02539             TextFormatFlags flags = TextFormatFlags.EndEllipsis | TextFormatFlags.NoPrefix | TextFormatFlags.VerticalCenter;
<a name="l02540"></a>02540             <span class="keywordflow">switch</span> (<span class="keyword">this</span>.Column.TextAlign) {
<a name="l02541"></a>02541                 <span class="keywordflow">case</span> HorizontalAlignment.Center: flags |= TextFormatFlags.HorizontalCenter; <span class="keywordflow">break</span>;
<a name="l02542"></a>02542                 <span class="keywordflow">case</span> HorizontalAlignment.Left:   flags |= TextFormatFlags.Left; <span class="keywordflow">break</span>;
<a name="l02543"></a>02543                 <span class="keywordflow">case</span> HorizontalAlignment.Right:  flags |= TextFormatFlags.Right; <span class="keywordflow">break</span>;
<a name="l02544"></a>02544             }
<a name="l02545"></a>02545             TextRenderer.DrawText(g, txt, <span class="keyword">this</span>.ListView.Font, r,
<a name="l02546"></a>02546                                   <span class="keyword">this</span>.GetForegroundColor(), <span class="keyword">this</span>.GetTextBackgroundColor(), flags);
<a name="l02547"></a>02547 
<a name="l02548"></a>02548             <span class="comment">// We should put a focus rectange around the column 0 text if it's selected --</span>
<a name="l02549"></a>02549             <span class="comment">// but we don't because:</span>
<a name="l02550"></a>02550             <span class="comment">// - I really dislike this UI convention</span>
<a name="l02551"></a>02551             <span class="comment">// - we are using buffered graphics, so the DrawFocusRecatangle method of the event doesn't work</span>
<a name="l02552"></a>02552 
<a name="l02553"></a>02553             <span class="comment">//if (this.Column.Index == 0) {</span>
<a name="l02554"></a>02554             <span class="comment">//    Size size = TextRenderer.MeasureText(this.SubItem.Text, this.ListView.Font);</span>
<a name="l02555"></a>02555             <span class="comment">//    if (r.Width &gt; size.Width)</span>
<a name="l02556"></a>02556             <span class="comment">//        r.Width = size.Width;</span>
<a name="l02557"></a>02557             <span class="comment">//    this.Event.DrawFocusRectangle(r);</span>
<a name="l02558"></a>02558             <span class="comment">//}</span>
<a name="l02559"></a>02559         }
<a name="l02560"></a>02560     }
<a name="l02561"></a>02561 
<a name="l02566"></a><a class="code" href="class_bright_ideas_software_1_1_mapped_image_renderer.html">02566</a>     <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="class_bright_ideas_software_1_1_mapped_image_renderer.html" title="This class maps a data value to an image that should be drawn for that value.">MappedImageRenderer</a> : <a class="code" href="class_bright_ideas_software_1_1_base_renderer.html" title="Renderers are responsible for drawing a single cell within an owner drawn ObjectListView...">BaseRenderer</a>
<a name="l02567"></a>02567     {
<a name="l02574"></a><a class="code" href="class_bright_ideas_software_1_1_mapped_image_renderer.html#bb9d6036752640bd7cb4210c0f24b2b7">02574</a>         <span class="keyword">static</span> <span class="keyword">public</span> <a class="code" href="class_bright_ideas_software_1_1_mapped_image_renderer.html" title="This class maps a data value to an image that should be drawn for that value.">MappedImageRenderer</a> Boolean(Object trueImage, Object falseImage)
<a name="l02575"></a>02575         {
<a name="l02576"></a>02576             <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="class_bright_ideas_software_1_1_mapped_image_renderer.html" title="This class maps a data value to an image that should be drawn for that value.">MappedImageRenderer</a>(<span class="keyword">true</span>, trueImage, <span class="keyword">false</span>, falseImage);
<a name="l02577"></a>02577         }
<a name="l02578"></a>02578 
<a name="l02586"></a><a class="code" href="class_bright_ideas_software_1_1_mapped_image_renderer.html#ad3847f5898f2848d823f581d8896988">02586</a>         <span class="keyword">static</span> <span class="keyword">public</span> <a class="code" href="class_bright_ideas_software_1_1_mapped_image_renderer.html" title="This class maps a data value to an image that should be drawn for that value.">MappedImageRenderer</a> TriState(Object trueImage, Object falseImage, Object nullImage)
<a name="l02587"></a>02587         {
<a name="l02588"></a>02588             <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="class_bright_ideas_software_1_1_mapped_image_renderer.html" title="This class maps a data value to an image that should be drawn for that value.">MappedImageRenderer</a>(<span class="keyword">new</span> Object[] { <span class="keyword">true</span>, trueImage, <span class="keyword">false</span>, falseImage, null, nullImage });
<a name="l02589"></a>02589         }
<a name="l02590"></a>02590 
<a name="l02594"></a><a class="code" href="class_bright_ideas_software_1_1_mapped_image_renderer.html#0d09b7aed7e1a090a4051044b194f8d0">02594</a>         <span class="keyword">public</span> <a class="code" href="class_bright_ideas_software_1_1_mapped_image_renderer.html" title="This class maps a data value to an image that should be drawn for that value.">MappedImageRenderer</a>()
<a name="l02595"></a>02595             : base()
<a name="l02596"></a>02596         {
<a name="l02597"></a>02597             map = <span class="keyword">new</span> System.Collections.Hashtable();
<a name="l02598"></a>02598         }
<a name="l02599"></a>02599 
<a name="l02605"></a><a class="code" href="class_bright_ideas_software_1_1_mapped_image_renderer.html#7006c56b1c938a191d4e480730bc8882">02605</a>         <span class="keyword">public</span> <a class="code" href="class_bright_ideas_software_1_1_mapped_image_renderer.html" title="This class maps a data value to an image that should be drawn for that value.">MappedImageRenderer</a>(Object key, Object image)
<a name="l02606"></a>02606             : this()
<a name="l02607"></a>02607         {
<a name="l02608"></a>02608             <span class="keyword">this</span>.Add(key, image);
<a name="l02609"></a>02609         }
<a name="l02610"></a>02610 
<a name="l02611"></a><a class="code" href="class_bright_ideas_software_1_1_mapped_image_renderer.html#071bba457c5f16c8b19d83a89976b345">02611</a>         <span class="keyword">public</span> <a class="code" href="class_bright_ideas_software_1_1_mapped_image_renderer.html" title="This class maps a data value to an image that should be drawn for that value.">MappedImageRenderer</a>(Object key1, Object image1, Object key2, Object image2)
<a name="l02612"></a>02612             : this()
<a name="l02613"></a>02613         {
<a name="l02614"></a>02614             <span class="keyword">this</span>.Add(key1, image1);
<a name="l02615"></a>02615             <span class="keyword">this</span>.Add(key2, image2);
<a name="l02616"></a>02616         }
<a name="l02617"></a>02617 
<a name="l02622"></a><a class="code" href="class_bright_ideas_software_1_1_mapped_image_renderer.html#755b00030f2ac6289c4659ae457473e8">02622</a>         <span class="keyword">public</span> <a class="code" href="class_bright_ideas_software_1_1_mapped_image_renderer.html" title="This class maps a data value to an image that should be drawn for that value.">MappedImageRenderer</a>(Object [] keysAndImages)
<a name="l02623"></a>02623             : this()
<a name="l02624"></a>02624         {
<a name="l02625"></a>02625             <span class="keywordflow">if</span> ((keysAndImages.GetLength(0) % 2) != 0)
<a name="l02626"></a>02626                 <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentException(<span class="stringliteral">"Array must have key/image pairs"</span>);
<a name="l02627"></a>02627 
<a name="l02628"></a>02628             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; keysAndImages.GetLength(0); i += 2)
<a name="l02629"></a>02629                 <span class="keyword">this</span>.Add(keysAndImages[i], keysAndImages[i + 1]);
<a name="l02630"></a>02630         }
<a name="l02631"></a>02631 
<a name="l02637"></a><a class="code" href="class_bright_ideas_software_1_1_mapped_image_renderer.html#367b51a3c04157bfc260993039180674">02637</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> Add(Object value, Object image)
<a name="l02638"></a>02638         {
<a name="l02639"></a>02639             <span class="keywordflow">if</span> (value == null)
<a name="l02640"></a>02640                 <span class="keyword">this</span>.nullImage = image;
<a name="l02641"></a>02641             <span class="keywordflow">else</span>
<a name="l02642"></a>02642                 map[value] = image;
<a name="l02643"></a>02643         }
<a name="l02644"></a>02644 
<a name="l02650"></a><a class="code" href="class_bright_ideas_software_1_1_mapped_image_renderer.html#848715494a3dc228063d384ce4bd7a10">02650</a>         <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> Render(Graphics g, Rectangle r)
<a name="l02651"></a>02651         {
<a name="l02652"></a>02652             <span class="keyword">this</span>.DrawBackground(g, r);
<a name="l02653"></a>02653 
<a name="l02654"></a>02654             Image image = null;
<a name="l02655"></a>02655             <span class="keywordflow">if</span> (<span class="keyword">this</span>.Aspect == null)
<a name="l02656"></a>02656                 image = <span class="keyword">this</span>.GetImage(<span class="keyword">this</span>.nullImage);
<a name="l02657"></a>02657             <span class="keywordflow">else</span>
<a name="l02658"></a>02658                 <span class="keywordflow">if</span> (map.ContainsKey(<span class="keyword">this</span>.Aspect))
<a name="l02659"></a>02659                         image = <span class="keyword">this</span>.GetImage(map[<span class="keyword">this</span>.Aspect]);
<a name="l02660"></a>02660             
<a name="l02661"></a>02661             <span class="keyword">this</span>.DrawAlignedImage(g, r, image);
<a name="l02662"></a>02662         }
<a name="l02663"></a>02663 
<a name="l02664"></a>02664 <span class="preprocessor">        #region Private variables</span>
<a name="l02665"></a>02665 <span class="preprocessor"></span>        
<a name="l02666"></a>02666         <span class="keyword">private</span> Hashtable map; <span class="comment">// Track the association between values and images</span>
<a name="l02667"></a>02667         <span class="keyword">private</span> Object nullImage; <span class="comment">// image to be drawn for null values (since null can't be a key)</span>
<a name="l02668"></a>02668 
<a name="l02669"></a>02669 <span class="preprocessor">        #endregion</span>
<a name="l02670"></a>02670 <span class="preprocessor"></span>    }
<a name="l02671"></a>02671 
<a name="l02675"></a><a class="code" href="class_bright_ideas_software_1_1_image_renderer.html">02675</a>     <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="class_bright_ideas_software_1_1_image_renderer.html" title="Render an image that comes from our data source.">ImageRenderer</a> : <a class="code" href="class_bright_ideas_software_1_1_base_renderer.html" title="Renderers are responsible for drawing a single cell within an owner drawn ObjectListView...">BaseRenderer</a>
<a name="l02676"></a>02676     {
<a name="l02680"></a><a class="code" href="class_bright_ideas_software_1_1_image_renderer.html#020fb145c4c99b18c0ea31c19dcc1b18">02680</a>         <span class="keyword">public</span> <a class="code" href="class_bright_ideas_software_1_1_image_renderer.html" title="Render an image that comes from our data source.">ImageRenderer</a>() : base()
<a name="l02681"></a>02681         {
<a name="l02682"></a>02682         }
<a name="l02683"></a>02683 
<a name="l02689"></a><a class="code" href="class_bright_ideas_software_1_1_image_renderer.html#7fa9a5c0524e6aa92b56c889bfa5166e">02689</a>         <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> Render(Graphics g, Rectangle r)
<a name="l02690"></a>02690         {
<a name="l02691"></a>02691             <span class="keyword">this</span>.DrawBackground(g, r);
<a name="l02692"></a>02692             <span class="keyword">this</span>.DrawAlignedImage(g, r, <span class="keyword">this</span>.GetImageFromAspect());
<a name="l02693"></a>02693         }
<a name="l02694"></a>02694 
<a name="l02695"></a>02695         <span class="keyword">private</span> Image GetImageFromAspect()
<a name="l02696"></a>02696         {
<a name="l02697"></a>02697             <span class="keywordflow">if</span> (<span class="keyword">this</span>.Aspect == null || <span class="keyword">this</span>.Aspect == System.DBNull.Value)
<a name="l02698"></a>02698                 <span class="keywordflow">return</span> null;
<a name="l02699"></a>02699 
<a name="l02700"></a>02700             <span class="keywordflow">if</span> (<span class="keyword">this</span>.OLVSubItem != null &amp;&amp; <span class="keyword">this</span>.OLVSubItem.ImageSelector is Image)
<a name="l02701"></a>02701                 <span class="keywordflow">return</span> (Image)<span class="keyword">this</span>.OLVSubItem.ImageSelector;
<a name="l02702"></a>02702 
<a name="l02703"></a>02703             <span class="comment">// Try to convert our Aspect into an Image</span>
<a name="l02704"></a>02704             <span class="comment">// If its a byte array, we treat it as an in-memory image</span>
<a name="l02705"></a>02705             <span class="comment">// If it's an int, we use that as an index into our image list</span>
<a name="l02706"></a>02706             <span class="comment">// If it's a string, we try to find a file by that name. If we can't, we use</span>
<a name="l02707"></a>02707             <span class="comment">//   the string as an index into our image list.</span>
<a name="l02708"></a>02708             <span class="comment">//CONSIDER: Do we really want to look for files on the disk?</span>
<a name="l02709"></a>02709             Image image = null;
<a name="l02710"></a>02710             <span class="keywordflow">if</span> (<span class="keyword">this</span>.Aspect is System.Byte[]) {
<a name="l02711"></a>02711                 <span class="keyword">using</span> (MemoryStream stream = <span class="keyword">new</span> MemoryStream((System.Byte[])<span class="keyword">this</span>.Aspect)) {
<a name="l02712"></a>02712                     <span class="keywordflow">try</span> {
<a name="l02713"></a>02713                         image = Image.FromStream(stream);
<a name="l02714"></a>02714                     } <span class="keywordflow">catch</span> (ArgumentException) {
<a name="l02715"></a>02715                         <span class="comment">// ignore</span>
<a name="l02716"></a>02716                     }
<a name="l02717"></a>02717                 }
<a name="l02718"></a>02718             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">this</span>.Aspect is Int32) {
<a name="l02719"></a>02719                 image = <span class="keyword">this</span>.GetImage(<span class="keyword">this</span>.Aspect);
<a name="l02720"></a>02720             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">this</span>.Aspect is String) {
<a name="l02721"></a>02721                 <span class="keywordflow">try</span> {
<a name="l02722"></a>02722                     image = Image.FromFile((String)<span class="keyword">this</span>.Aspect);
<a name="l02723"></a>02723                 } <span class="keywordflow">catch</span> (FileNotFoundException) {
<a name="l02724"></a>02724                     image = <span class="keyword">this</span>.GetImage(<span class="keyword">this</span>.Aspect);
<a name="l02725"></a>02725                 } <span class="keywordflow">catch</span> (OutOfMemoryException) {
<a name="l02726"></a>02726                     image = <span class="keyword">this</span>.GetImage(<span class="keyword">this</span>.Aspect);
<a name="l02727"></a>02727                 }
<a name="l02728"></a>02728             }
<a name="l02729"></a>02729 
<a name="l02730"></a>02730             <span class="comment">// Cache the image so we don't repeat this dreary process</span>
<a name="l02731"></a>02731             <span class="keywordflow">if</span> (<span class="keyword">this</span>.OLVSubItem != null &amp;&amp; <span class="keyword">this</span>.OLVSubItem.ImageSelector == null)
<a name="l02732"></a>02732                 <span class="keyword">this</span>.OLVSubItem.ImageSelector = image;
<a name="l02733"></a>02733 
<a name="l02734"></a>02734             <span class="keywordflow">return</span> image;
<a name="l02735"></a>02735         }
<a name="l02736"></a>02736 
<a name="l02737"></a>02737 <span class="preprocessor">        #region Private variables</span>
<a name="l02738"></a>02738 <span class="preprocessor"></span>
<a name="l02739"></a>02739 <span class="preprocessor">        #endregion</span>
<a name="l02740"></a>02740 <span class="preprocessor"></span>    }
<a name="l02741"></a>02741 
<a name="l02745"></a><a class="code" href="class_bright_ideas_software_1_1_bar_renderer.html">02745</a>     <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="class_bright_ideas_software_1_1_bar_renderer.html" title="Render our Aspect as a progress bar.">BarRenderer</a> : <a class="code" href="class_bright_ideas_software_1_1_base_renderer.html" title="Renderers are responsible for drawing a single cell within an owner drawn ObjectListView...">BaseRenderer</a>
<a name="l02746"></a>02746     {
<a name="l02747"></a>02747 <span class="preprocessor">        #region Constructors</span>
<a name="l02748"></a>02748 <span class="preprocessor"></span>
<a name="l02752"></a><a class="code" href="class_bright_ideas_software_1_1_bar_renderer.html#4b5b43afa37b3b6642aeebd50cb43096">02752</a>         <span class="keyword">public</span> <a class="code" href="class_bright_ideas_software_1_1_bar_renderer.html" title="Render our Aspect as a progress bar.">BarRenderer</a>()
<a name="l02753"></a>02753             : base()
<a name="l02754"></a>02754         {
<a name="l02755"></a>02755             <span class="keyword">this</span>.Pen = <span class="keyword">new</span> Pen(Color.Blue, 1);
<a name="l02756"></a>02756             <span class="keyword">this</span>.Brush = Brushes.Aquamarine;
<a name="l02757"></a>02757             <span class="keyword">this</span>.BackgroundBrush = Brushes.White;
<a name="l02758"></a>02758             <span class="keyword">this</span>.StartColor = Color.Empty;
<a name="l02759"></a>02759         }
<a name="l02760"></a>02760 
<a name="l02764"></a><a class="code" href="class_bright_ideas_software_1_1_bar_renderer.html#9b80cffa0f9b110852f50e2634464e0c">02764</a>         <span class="keyword">public</span> <a class="code" href="class_bright_ideas_software_1_1_bar_renderer.html" title="Render our Aspect as a progress bar.">BarRenderer</a>(<span class="keywordtype">int</span> minimum, <span class="keywordtype">int</span> maximum)
<a name="l02765"></a>02765             : this()
<a name="l02766"></a>02766         {
<a name="l02767"></a>02767             <span class="keyword">this</span>.MinimumValue = minimum;
<a name="l02768"></a>02768             <span class="keyword">this</span>.MaximumValue = maximum;
<a name="l02769"></a>02769         }
<a name="l02770"></a>02770 
<a name="l02774"></a><a class="code" href="class_bright_ideas_software_1_1_bar_renderer.html#34c95b6e2116e2053aeaf2b8d88f4e4e">02774</a>         <span class="keyword">public</span> <a class="code" href="class_bright_ideas_software_1_1_bar_renderer.html" title="Render our Aspect as a progress bar.">BarRenderer</a>(Pen aPen, Brush aBrush)
<a name="l02775"></a>02775             : this()
<a name="l02776"></a>02776         {
<a name="l02777"></a>02777             <span class="keyword">this</span>.Pen = aPen;
<a name="l02778"></a>02778             <span class="keyword">this</span>.Brush = aBrush;
<a name="l02779"></a>02779             <span class="keyword">this</span>.UseStandardBar = <span class="keyword">false</span>;
<a name="l02780"></a>02780         }
<a name="l02781"></a>02781 
<a name="l02785"></a><a class="code" href="class_bright_ideas_software_1_1_bar_renderer.html#5d0d2f9c7f962e55e6a87497ccf5e4aa">02785</a>         <span class="keyword">public</span> <a class="code" href="class_bright_ideas_software_1_1_bar_renderer.html" title="Render our Aspect as a progress bar.">BarRenderer</a>(<span class="keywordtype">int</span> minimum, <span class="keywordtype">int</span> maximum, Pen aPen, Brush aBrush)
<a name="l02786"></a>02786             : this(minimum, maximum)
<a name="l02787"></a>02787         {
<a name="l02788"></a>02788             <span class="keyword">this</span>.Pen = aPen;
<a name="l02789"></a>02789             <span class="keyword">this</span>.Brush = aBrush;
<a name="l02790"></a>02790             <span class="keyword">this</span>.UseStandardBar = <span class="keyword">false</span>;
<a name="l02791"></a>02791         }
<a name="l02792"></a>02792 
<a name="l02796"></a><a class="code" href="class_bright_ideas_software_1_1_bar_renderer.html#71369a7601d7faccb83d29f3c3119f25">02796</a>         <span class="keyword">public</span> <a class="code" href="class_bright_ideas_software_1_1_bar_renderer.html" title="Render our Aspect as a progress bar.">BarRenderer</a>(Pen aPen, Color start, Color end)
<a name="l02797"></a>02797             : this()
<a name="l02798"></a>02798         {
<a name="l02799"></a>02799             <span class="keyword">this</span>.Pen = aPen;
<a name="l02800"></a>02800             <span class="keyword">this</span>.SetGradient(start, end);
<a name="l02801"></a>02801         }
<a name="l02802"></a>02802 
<a name="l02806"></a><a class="code" href="class_bright_ideas_software_1_1_bar_renderer.html#0b6480fdb9d6160f3a07aaaa71e6b964">02806</a>         <span class="keyword">public</span> <a class="code" href="class_bright_ideas_software_1_1_bar_renderer.html" title="Render our Aspect as a progress bar.">BarRenderer</a>(<span class="keywordtype">int</span> minimum, <span class="keywordtype">int</span> maximum, Pen aPen, Color start, Color end)
<a name="l02807"></a>02807             : this(minimum, maximum)
<a name="l02808"></a>02808         {
<a name="l02809"></a>02809             <span class="keyword">this</span>.Pen = aPen;
<a name="l02810"></a>02810             <span class="keyword">this</span>.SetGradient(start, end);
<a name="l02811"></a>02811         }
<a name="l02812"></a>02812 
<a name="l02813"></a>02813 <span class="preprocessor">        #endregion</span>
<a name="l02814"></a>02814 <span class="preprocessor"></span>
<a name="l02815"></a>02815 <span class="preprocessor">        #region Public variables</span>
<a name="l02816"></a>02816 <span class="preprocessor"></span>
<a name="l02820"></a><a class="code" href="class_bright_ideas_software_1_1_bar_renderer.html#8595a4658741d1ed2f9c8d9690329a1d">02820</a>         <span class="keyword">public</span> <span class="keywordtype">bool</span> UseStandardBar = <span class="keyword">true</span>;
<a name="l02821"></a>02821 
<a name="l02825"></a><a class="code" href="class_bright_ideas_software_1_1_bar_renderer.html#4d30411ebc97b70ef6f00f71aaf47adb">02825</a>         <span class="keyword">public</span> <span class="keywordtype">int</span> Padding = 2;
<a name="l02826"></a>02826 
<a name="l02830"></a><a class="code" href="class_bright_ideas_software_1_1_bar_renderer.html#9a8a43b5183690726730cfa69fdff871">02830</a>         <span class="keyword">public</span> Pen Pen;
<a name="l02831"></a>02831 
<a name="l02835"></a><a class="code" href="class_bright_ideas_software_1_1_bar_renderer.html#8d8c533a7c0df9b30e06f881f41bd9fe">02835</a>         <span class="keyword">public</span> Brush Brush;
<a name="l02836"></a>02836 
<a name="l02840"></a><a class="code" href="class_bright_ideas_software_1_1_bar_renderer.html#51a2f15a8a2dd55b8f41af6327a6358e">02840</a>         <span class="keyword">public</span> Brush BackgroundBrush;
<a name="l02841"></a>02841 
<a name="l02845"></a><a class="code" href="class_bright_ideas_software_1_1_bar_renderer.html#5486cca483de7e768de39b6b21d8f6be">02845</a>         <span class="keyword">public</span> Color StartColor;
<a name="l02846"></a>02846 
<a name="l02850"></a><a class="code" href="class_bright_ideas_software_1_1_bar_renderer.html#c8368feba5413183e6a6b2fd1be6f0e4">02850</a>         <span class="keyword">public</span> Color EndColor;
<a name="l02851"></a>02851 
<a name="l02855"></a><a class="code" href="class_bright_ideas_software_1_1_bar_renderer.html#4c668460191fea7f06129809ae1530e3">02855</a>         <span class="keyword">public</span> <span class="keywordtype">int</span> MaximumWidth = 100;
<a name="l02856"></a>02856 
<a name="l02860"></a><a class="code" href="class_bright_ideas_software_1_1_bar_renderer.html#560aca31d2b8dfca7ea69feb4b27bee0">02860</a>         <span class="keyword">public</span> <span class="keywordtype">int</span> MaximumHeight = 16;
<a name="l02861"></a>02861 
<a name="l02865"></a><a class="code" href="class_bright_ideas_software_1_1_bar_renderer.html#32665bdf6b595f4a30e5058aef5ecca1">02865</a>         <span class="keyword">public</span> <span class="keywordtype">int</span> MinimumValue = 0;
<a name="l02866"></a>02866 
<a name="l02870"></a><a class="code" href="class_bright_ideas_software_1_1_bar_renderer.html#2b36d9384d52ec0f67bbc0c4bf853627">02870</a>         <span class="keyword">public</span> <span class="keywordtype">int</span> MaximumValue = 100;
<a name="l02871"></a>02871         
<a name="l02872"></a>02872 <span class="preprocessor">        #endregion</span>
<a name="l02873"></a>02873 <span class="preprocessor"></span>
<a name="l02879"></a><a class="code" href="class_bright_ideas_software_1_1_bar_renderer.html#b4f81c0c6cb79ef1847adfd3ac6788c5">02879</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> SetGradient(Color start, Color end)
<a name="l02880"></a>02880         {
<a name="l02881"></a>02881             <span class="keyword">this</span>.StartColor = start;
<a name="l02882"></a>02882             <span class="keyword">this</span>.EndColor = end;
<a name="l02883"></a>02883             <span class="keyword">this</span>.UseStandardBar = <span class="keyword">false</span>;
<a name="l02884"></a>02884         }
<a name="l02885"></a>02885 
<a name="l02891"></a><a class="code" href="class_bright_ideas_software_1_1_bar_renderer.html#ad8b6d15c78e059e604ee617ffd3a362">02891</a>                 <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> Render(Graphics g, Rectangle r)
<a name="l02892"></a>02892                 {
<a name="l02893"></a>02893                         <span class="keyword">this</span>.DrawBackground(g, r);
<a name="l02894"></a>02894 
<a name="l02895"></a>02895             Rectangle frameRect = Rectangle.Inflate(r, 0 - <span class="keyword">this</span>.Padding, 0 - <span class="keyword">this</span>.Padding);
<a name="l02896"></a>02896             <span class="keywordflow">if</span> (frameRect.Width &gt; <span class="keyword">this</span>.MaximumWidth)
<a name="l02897"></a>02897                 frameRect.Width = <span class="keyword">this</span>.MaximumWidth;
<a name="l02898"></a>02898             <span class="keywordflow">if</span> (frameRect.Height &gt; <span class="keyword">this</span>.MaximumHeight)
<a name="l02899"></a>02899                 frameRect.Height = <span class="keyword">this</span>.MaximumHeight;
<a name="l02900"></a>02900             frameRect = <span class="keyword">this</span>.AlignRectangle(r, frameRect);
<a name="l02901"></a>02901 
<a name="l02902"></a>02902             <span class="comment">// Convert our aspect to a numeric value</span>
<a name="l02903"></a>02903             <span class="comment">// CONSIDER: Is this the best way to do this?</span>
<a name="l02904"></a>02904             <span class="keywordflow">if</span> (!(<span class="keyword">this</span>.Aspect is IConvertible))
<a name="l02905"></a>02905                 <span class="keywordflow">return</span>;
<a name="l02906"></a>02906             <span class="keywordtype">double</span> aspectValue = ((IConvertible)<span class="keyword">this</span>.Aspect).ToDouble(NumberFormatInfo.InvariantInfo);
<a name="l02907"></a>02907 
<a name="l02908"></a>02908             Rectangle fillRect = Rectangle.Inflate(frameRect, -1, -1);
<a name="l02909"></a>02909             <span class="keywordflow">if</span> (aspectValue &lt;= <span class="keyword">this</span>.MinimumValue)
<a name="l02910"></a>02910                 fillRect.Width = 0;
<a name="l02911"></a>02911             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (aspectValue &lt; <span class="keyword">this</span>.MaximumValue)
<a name="l02912"></a>02912                 fillRect.Width = (int)(fillRect.Width * (aspectValue - <span class="keyword">this</span>.MinimumValue) / <span class="keyword">this</span>.MaximumValue);
<a name="l02913"></a>02913 
<a name="l02914"></a>02914             <span class="keywordflow">if</span> (<span class="keyword">this</span>.UseStandardBar &amp;&amp; ProgressBarRenderer.IsSupported) {
<a name="l02915"></a>02915                 ProgressBarRenderer.DrawHorizontalBar(g, frameRect);
<a name="l02916"></a>02916                 ProgressBarRenderer.DrawHorizontalChunks(g, fillRect);
<a name="l02917"></a>02917             } <span class="keywordflow">else</span> {
<a name="l02918"></a>02918                 g.FillRectangle(<span class="keyword">this</span>.BackgroundBrush, frameRect);
<a name="l02919"></a>02919                 g.DrawRectangle(<span class="keyword">this</span>.Pen, frameRect);
<a name="l02920"></a>02920                 <span class="keywordflow">if</span> (fillRect.Width &gt; 0) {
<a name="l02921"></a>02921                     fillRect.Height++;
<a name="l02922"></a>02922                     <span class="keywordflow">if</span> (<span class="keyword">this</span>.StartColor == Color.Empty)
<a name="l02923"></a>02923                         g.FillRectangle(<span class="keyword">this</span>.Brush, fillRect);
<a name="l02924"></a>02924                     <span class="keywordflow">else</span> {
<a name="l02925"></a>02925                         <span class="keyword">using</span> (LinearGradientBrush gradient = <span class="keyword">new</span> LinearGradientBrush(frameRect, <span class="keyword">this</span>.StartColor, <span class="keyword">this</span>.EndColor, LinearGradientMode.Horizontal)) {
<a name="l02926"></a>02926                             g.FillRectangle(gradient, fillRect);
<a name="l02927"></a>02927                         }
<a name="l02928"></a>02928                     }
<a name="l02929"></a>02929                 }
<a name="l02930"></a>02930             }
<a name="l02931"></a>02931                 }
<a name="l02932"></a>02932     }
<a name="l02933"></a>02933 
<a name="l02938"></a><a class="code" href="class_bright_ideas_software_1_1_multi_image_renderer.html">02938</a>     <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="class_bright_ideas_software_1_1_multi_image_renderer.html" title="A MultiImageRenderer draws the same image a number of times based on our data value...">MultiImageRenderer</a> : <a class="code" href="class_bright_ideas_software_1_1_base_renderer.html" title="Renderers are responsible for drawing a single cell within an owner drawn ObjectListView...">BaseRenderer</a>
<a name="l02939"></a>02939     {
<a name="l02943"></a><a class="code" href="class_bright_ideas_software_1_1_multi_image_renderer.html#c4ae061314ecedbe81802a4ab495f943">02943</a>         <span class="keyword">public</span> <a class="code" href="class_bright_ideas_software_1_1_multi_image_renderer.html" title="A MultiImageRenderer draws the same image a number of times based on our data value...">MultiImageRenderer</a>()
<a name="l02944"></a>02944             : base()
<a name="l02945"></a>02945         {
<a name="l02946"></a>02946 
<a name="l02947"></a>02947         }
<a name="l02948"></a>02948 
<a name="l02956"></a><a class="code" href="class_bright_ideas_software_1_1_multi_image_renderer.html#18df334ce96af3aa3191436eff791f73">02956</a>         <span class="keyword">public</span> <a class="code" href="class_bright_ideas_software_1_1_multi_image_renderer.html" title="A MultiImageRenderer draws the same image a number of times based on our data value...">MultiImageRenderer</a>(Object imageSelector, <span class="keywordtype">int</span> maxImages, <span class="keywordtype">int</span> minValue, <span class="keywordtype">int</span> maxValue)
<a name="l02957"></a>02957             : this()
<a name="l02958"></a>02958         {
<a name="l02959"></a>02959             <span class="keyword">this</span>.ImageSelector = imageSelector;
<a name="l02960"></a>02960             <span class="keyword">this</span>.MaxNumberImages = maxImages;
<a name="l02961"></a>02961             <span class="keyword">this</span>.MinimumValue = minValue;
<a name="l02962"></a>02962             <span class="keyword">this</span>.MaximumValue = maxValue;
<a name="l02963"></a>02963         }
<a name="l02964"></a>02964 
<a name="l02968"></a>02968         <span class="keyword">public</span> Object ImageSelector
<a name="l02969"></a><a class="code" href="class_bright_ideas_software_1_1_multi_image_renderer.html#14e004005079d39a3e850aa1128c4be1">02969</a>         {
<a name="l02970"></a>02970             <span class="keyword">get</span> { <span class="keywordflow">return</span> imageSelector; }
<a name="l02971"></a>02971             <span class="keyword">set</span> { imageSelector = value; }
<a name="l02972"></a>02972         }
<a name="l02973"></a>02973         <span class="keyword">private</span> Object imageSelector;
<a name="l02974"></a>02974 
<a name="l02978"></a>02978         <span class="keyword">public</span> <span class="keywordtype">int</span> Spacing
<a name="l02979"></a><a class="code" href="class_bright_ideas_software_1_1_multi_image_renderer.html#5b3df9b578ca61a788644c4c66572e5c">02979</a>         {
<a name="l02980"></a>02980             <span class="keyword">get</span> { <span class="keywordflow">return</span> spacing; }
<a name="l02981"></a>02981             <span class="keyword">set</span> { spacing = value; }
<a name="l02982"></a>02982         }
<a name="l02983"></a>02983         <span class="keyword">private</span> <span class="keywordtype">int</span> spacing = 1;
<a name="l02984"></a>02984 
<a name="l02988"></a>02988         <span class="keyword">public</span> <span class="keywordtype">int</span> MaxNumberImages
<a name="l02989"></a><a class="code" href="class_bright_ideas_software_1_1_multi_image_renderer.html#e879ce26a7d5a71397d2c94368206f8c">02989</a>         {
<a name="l02990"></a>02990             <span class="keyword">get</span> { <span class="keywordflow">return</span> maxNumberImage; }
<a name="l02991"></a>02991             <span class="keyword">set</span> { maxNumberImage = value; }
<a name="l02992"></a>02992         }
<a name="l02993"></a>02993         <span class="keyword">private</span> <span class="keywordtype">int</span> maxNumberImage;
<a name="l02994"></a>02994 
<a name="l02998"></a><a class="code" href="class_bright_ideas_software_1_1_multi_image_renderer.html#38faaeb7ec13ed69a634173055f045fe">02998</a>         <span class="keyword">public</span> <span class="keywordtype">int</span> MinimumValue = 0;
<a name="l02999"></a>02999 
<a name="l03003"></a><a class="code" href="class_bright_ideas_software_1_1_multi_image_renderer.html#d6ccf51b92c2e5f1e22925911495d061">03003</a>         <span class="keyword">public</span> <span class="keywordtype">int</span> MaximumValue = 100;
<a name="l03004"></a>03004 
<a name="l03010"></a><a class="code" href="class_bright_ideas_software_1_1_multi_image_renderer.html#edad57dd16245ddf0b2ed34af20d69f0">03010</a>         <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> Render(Graphics g, Rectangle r)
<a name="l03011"></a>03011         {
<a name="l03012"></a>03012             <span class="keyword">this</span>.DrawBackground(g, r);
<a name="l03013"></a>03013 
<a name="l03014"></a>03014             Image image = <span class="keyword">this</span>.GetImage(<span class="keyword">this</span>.ImageSelector);
<a name="l03015"></a>03015             <span class="keywordflow">if</span> (image == null)
<a name="l03016"></a>03016                 <span class="keywordflow">return</span>;
<a name="l03017"></a>03017 
<a name="l03018"></a>03018             <span class="comment">// Convert our aspect to a numeric value</span>
<a name="l03019"></a>03019             <span class="comment">// CONSIDER: Is this the best way to do this?</span>
<a name="l03020"></a>03020             <span class="keywordflow">if</span> (!(<span class="keyword">this</span>.Aspect is IConvertible))
<a name="l03021"></a>03021                 <span class="keywordflow">return</span>;
<a name="l03022"></a>03022             <span class="keywordtype">double</span> aspectValue = ((IConvertible)<span class="keyword">this</span>.Aspect).ToDouble(NumberFormatInfo.InvariantInfo);
<a name="l03023"></a>03023 
<a name="l03024"></a>03024             <span class="comment">// Calculate how many images we need to draw to represent our aspect value</span>
<a name="l03025"></a>03025             <span class="keywordtype">int</span> numberOfImages;
<a name="l03026"></a>03026             <span class="keywordflow">if</span> (aspectValue &lt;= <span class="keyword">this</span>.MinimumValue)
<a name="l03027"></a>03027                 numberOfImages = 0;
<a name="l03028"></a>03028             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (aspectValue &lt; <span class="keyword">this</span>.MaximumValue)
<a name="l03029"></a>03029                 numberOfImages = (int)(<span class="keyword">this</span>.MaxNumberImages * (aspectValue - <span class="keyword">this</span>.MinimumValue) / <span class="keyword">this</span>.MaximumValue);
<a name="l03030"></a>03030             <span class="keywordflow">else</span>
<a name="l03031"></a>03031                 numberOfImages = <span class="keyword">this</span>.MaxNumberImages;
<a name="l03032"></a>03032 
<a name="l03033"></a>03033             <span class="comment">// If we need to shrink the image, what will its on-screen dimensions be?</span>
<a name="l03034"></a>03034             <span class="keywordtype">int</span> imageScaledWidth = image.Width;
<a name="l03035"></a>03035             <span class="keywordtype">int</span> imageScaledHeight = image.Height;
<a name="l03036"></a>03036             <span class="keywordflow">if</span> (r.Height &lt; image.Height) {
<a name="l03037"></a>03037                 imageScaledWidth = (int)((<span class="keywordtype">float</span>)image.Width * (<span class="keywordtype">float</span>)r.Height / (<span class="keywordtype">float</span>)image.Height);
<a name="l03038"></a>03038                 imageScaledHeight = r.Height;
<a name="l03039"></a>03039             }
<a name="l03040"></a>03040             <span class="comment">// Calculate where the images should be drawn</span>
<a name="l03041"></a>03041             Rectangle imageBounds = r;
<a name="l03042"></a>03042             imageBounds.Width = (<span class="keyword">this</span>.MaxNumberImages * (imageScaledWidth + <span class="keyword">this</span>.Spacing)) - <span class="keyword">this</span>.Spacing;
<a name="l03043"></a>03043             imageBounds.Height = imageScaledHeight;
<a name="l03044"></a>03044             imageBounds = <span class="keyword">this</span>.AlignRectangle(r, imageBounds);
<a name="l03045"></a>03045 
<a name="l03046"></a>03046             <span class="comment">// Finally, draw the images</span>
<a name="l03047"></a>03047             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; numberOfImages; i++) {
<a name="l03048"></a>03048                 g.DrawImage(image, imageBounds.X, imageBounds.Y, imageScaledWidth, imageScaledHeight);
<a name="l03049"></a>03049                 imageBounds.X += (imageScaledWidth + <span class="keyword">this</span>.Spacing);
<a name="l03050"></a>03050             }
<a name="l03051"></a>03051         }
<a name="l03052"></a>03052     }
<a name="l03053"></a>03053 <span class="preprocessor">    #endregion</span>
<a name="l03054"></a>03054 <span class="preprocessor"></span>
<a name="l03055"></a>03055 }
</pre></div><hr size="1"><address style="text-align: right;"><small>Generated on Wed Jul 18 04:01:22 2007 for Crossfade by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.2 </small></address>
</body>
</html>
